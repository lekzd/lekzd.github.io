(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))x(_);new MutationObserver(_=>{for(const T of _)if(T.type==="childList")for(const C of T.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&x(C)}).observe(document,{childList:!0,subtree:!0});function t(_){const T={};return _.integrity&&(T.integrity=_.integrity),_.referrerPolicy&&(T.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?T.credentials="include":_.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function x(_){if(_.ep)return;_.ep=!0;const T=t(_);fetch(_.href,T)}})();function jt(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}var Ln={exports:{}},zu=Ln.exports,To;function Uu(){return To||(To=1,function(L,e){(function(t,x){L.exports=x()})(zu,function(){var t=function(r){return r instanceof Uint8Array||r instanceof Uint16Array||r instanceof Uint32Array||r instanceof Int8Array||r instanceof Int16Array||r instanceof Int32Array||r instanceof Float32Array||r instanceof Float64Array||r instanceof Uint8ClampedArray},x=function(r,a){for(var u=Object.keys(a),w=0;w<u.length;++w)r[u[w]]=a[u[w]];return r},_=`
`;function T(r){return typeof atob<"u"?atob(r):"base64:"+r}function C(r){var a=new Error("(regl) "+r);throw console.error(a),a}function D(r,a){r||C(a)}function Z(r){return r?": "+r:""}function Y(r,a,u){r in a||C("unknown parameter ("+r+")"+Z(u)+". possible values: "+Object.keys(a).join())}function ne(r,a){t(r)||C("invalid parameter type"+Z(a)+". must be a typed array")}function he(r,a){switch(a){case"number":return typeof r=="number";case"object":return typeof r=="object";case"string":return typeof r=="string";case"boolean":return typeof r=="boolean";case"function":return typeof r=="function";case"undefined":return typeof r>"u";case"symbol":return typeof r=="symbol"}}function me(r,a,u){he(r,a)||C("invalid parameter type"+Z(u)+". expected "+a+", got "+typeof r)}function pe(r,a){r>=0&&(r|0)===r||C("invalid parameter type, ("+r+")"+Z(a)+". must be a nonnegative integer")}function be(r,a,u){a.indexOf(r)<0&&C("invalid value"+Z(u)+". must be one of: "+a)}var ye=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Re(r){Object.keys(r).forEach(function(a){ye.indexOf(a)<0&&C('invalid regl constructor argument "'+a+'". must be one of '+ye)})}function xe(r,a){for(r=r+"";r.length<a;)r=" "+r;return r}function Se(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ve(r,a){this.number=r,this.line=a,this.errors=[]}function ke(r,a,u){this.file=r,this.line=a,this.message=u}function Fe(){var r=new Error,a=(r.stack||r).toString(),u=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);if(u)return u[1];var w=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a);return w?w[1]:"unknown"}function Me(){var r=new Error,a=(r.stack||r).toString(),u=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);if(u)return u[1];var w=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a);return w?w[1]:"unknown"}function Be(r,a){var u=r.split(`
`),w=1,N=0,S={unknown:new Se,0:new Se};S.unknown.name=S[0].name=a||Fe(),S.unknown.lines.push(new Ve(0,""));for(var P=0;P<u.length;++P){var $=u[P],U=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec($);if(U)switch(U[1]){case"line":var X=/(\d+)(\s+\d+)?/.exec(U[2]);X&&(w=X[1]|0,X[2]&&(N=X[2]|0,N in S||(S[N]=new Se)));break;case"define":var Q=/SHADER_NAME(_B64)?\s+(.*)$/.exec(U[2]);Q&&(S[N].name=Q[1]?T(Q[2]):Q[2]);break}S[N].lines.push(new Ve(w++,$))}return Object.keys(S).forEach(function(W){var J=S[W];J.lines.forEach(function(V){J.index[V.number]=V})}),S}function rr(r){var a=[];return r.split(`
`).forEach(function(u){if(!(u.length<5)){var w=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(u);w?a.push(new ke(w[1]|0,w[2]|0,w[3].trim())):u.length>0&&a.push(new ke("unknown",0,u))}}),a}function dr(r,a){a.forEach(function(u){var w=r[u.file];if(w){var N=w.index[u.line];if(N){N.errors.push(u),w.hasErrors=!0;return}}r.unknown.hasErrors=!0,r.unknown.lines[0].errors.push(u)})}function or(r,a,u,w,N){if(!r.getShaderParameter(a,r.COMPILE_STATUS)){var S=r.getShaderInfoLog(a),P=w===r.FRAGMENT_SHADER?"fragment":"vertex";pi(u,"string",P+" shader source must be a string",N);var $=Be(u,N),U=rr(S);dr($,U),Object.keys($).forEach(function(X){var Q=$[X];if(!Q.hasErrors)return;var W=[""],J=[""];function V(H,y){W.push(H),J.push(y||"")}V("file number "+X+": "+Q.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Q.lines.forEach(function(H){if(H.errors.length>0){V(xe(H.number,4)+"|  ","background-color:yellow; font-weight:bold"),V(H.line+_,"color:red; background-color:yellow; font-weight:bold");var y=0;H.errors.forEach(function(O){var j=O.message,se=/^\s*'(.*)'\s*:\s*(.*)$/.exec(j);if(se){var z=se[1];switch(j=se[2],z){case"assign":z="=";break}y=Math.max(H.line.indexOf(z,y),0)}else y=0;V(xe("| ",6)),V(xe("^^^",y+3)+_,"font-weight:bold"),V(xe("| ",6)),V(j+_,"font-weight:bold")}),V(xe("| ",6)+_)}else V(xe(H.number,4)+"|  "),V(H.line+_,"color:red")}),typeof document<"u"&&!window.chrome?(J[0]=W.join("%c"),console.log.apply(console,J)):console.log(W.join(""))}),D.raise("Error compiling "+P+" shader, "+$[0].name)}}function Ye(r,a,u,w,N){if(!r.getProgramParameter(a,r.LINK_STATUS)){var S=r.getProgramInfoLog(a),P=Be(u,N),$=Be(w,N),U='Error linking program with vertex shader, "'+$[0].name+'", and fragment shader "'+P[0].name+'"';typeof document<"u"?console.log("%c"+U+_+"%c"+S,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(U+_+S),D.raise(U)}}function mr(r){r._commandRef=Fe()}function hr(r,a,u,w){mr(r);function N(U){return U?w.id(U):0}r._fragId=N(r.static.frag),r._vertId=N(r.static.vert);function S(U,X){Object.keys(X).forEach(function(Q){U[w.id(Q)]=!0})}var P=r._uniformSet={};S(P,a.static),S(P,a.dynamic);var $=r._attributeSet={};S($,u.static),S($,u.dynamic),r._hasCount="count"in r.static||"count"in r.dynamic||"elements"in r.static||"elements"in r.dynamic}function vr(r,a){var u=Me();C(r+" in command "+(a||Fe())+(u==="unknown"?"":" called from "+u))}function je(r,a,u){r||vr(a,u||Fe())}function jr(r,a,u,w){r in a||vr("unknown parameter ("+r+")"+Z(u)+". possible values: "+Object.keys(a).join(),w||Fe())}function pi(r,a,u,w){he(r,a)||vr("invalid parameter type"+Z(u)+". expected "+a+", got "+typeof r,w||Fe())}function us(r){r()}function ds(r,a,u){r.texture?be(r.texture._texture.internalformat,a,"unsupported texture format for attachment"):be(r.renderbuffer._renderbuffer.format,u,"unsupported renderbuffer format for attachment")}var Ht=33071,yi=9728,ms=9984,vs=9985,hs=9986,ps=9987,ys=5120,bs=5121,gs=5122,_s=5123,xs=5124,Es=5125,bi=5126,gi=32819,_i=32820,xi=33635,Ei=34042,As=36193,gr={};gr[ys]=gr[bs]=1,gr[gs]=gr[_s]=gr[As]=gr[xi]=gr[gi]=gr[_i]=2,gr[xs]=gr[Es]=gr[bi]=gr[Ei]=4;function Ai(r,a){return r===_i||r===gi||r===xi?2:r===Ei?4:gr[r]*a}function Xt(r){return!(r&r-1)&&!!r}function Ts(r,a,u){var w,N=a.width,S=a.height,P=a.channels;D(N>0&&N<=u.maxTextureSize&&S>0&&S<=u.maxTextureSize,"invalid texture shape"),(r.wrapS!==Ht||r.wrapT!==Ht)&&D(Xt(N)&&Xt(S),"incompatible wrap mode for texture, both width and height must be power of 2"),a.mipmask===1?N!==1&&S!==1&&D(r.minFilter!==ms&&r.minFilter!==hs&&r.minFilter!==vs&&r.minFilter!==ps,"min filter requires mipmap"):(D(Xt(N)&&Xt(S),"texture must be a square power of 2 to support mipmapping"),D(a.mipmask===(N<<1)-1,"missing or incomplete mipmap data")),a.type===bi&&(u.extensions.indexOf("oes_texture_float_linear")<0&&D(r.minFilter===yi&&r.magFilter===yi,"filter not supported, must enable oes_texture_float_linear"),D(!r.genMipmaps,"mipmap generation not supported with float textures"));var $=a.images;for(w=0;w<16;++w)if($[w]){var U=N>>w,X=S>>w;D(a.mipmask&1<<w,"missing mipmap data");var Q=$[w];if(D(Q.width===U&&Q.height===X,"invalid shape for mip images"),D(Q.format===a.format&&Q.internalformat===a.internalformat&&Q.type===a.type,"incompatible type for mip image"),!Q.compressed)if(Q.data){var W=Math.ceil(Ai(Q.type,P)*U/Q.unpackAlignment)*Q.unpackAlignment;D(Q.data.byteLength===W*X,"invalid data for image, buffer size is inconsistent with image format")}else Q.element||Q.copy}else r.genMipmaps||D((a.mipmask&1<<w)===0,"extra mipmap data");a.compressed&&D(!r.genMipmaps,"mipmap generation for compressed images not supported")}function Ss(r,a,u,w){var N=r.width,S=r.height,P=r.channels;D(N>0&&N<=w.maxTextureSize&&S>0&&S<=w.maxTextureSize,"invalid texture shape"),D(N===S,"cube map must be square"),D(a.wrapS===Ht&&a.wrapT===Ht,"wrap mode not supported by cube map");for(var $=0;$<u.length;++$){var U=u[$];D(U.width===N&&U.height===S,"inconsistent cube map face shape"),a.genMipmaps&&(D(!U.compressed,"can not generate mipmap for compressed textures"),D(U.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var X=U.images,Q=0;Q<16;++Q){var W=X[Q];if(W){var J=N>>Q,V=S>>Q;D(U.mipmask&1<<Q,"missing mipmap data"),D(W.width===J&&W.height===V,"invalid shape for mip images"),D(W.format===r.format&&W.internalformat===r.internalformat&&W.type===r.type,"incompatible type for mip image"),W.compressed||(W.data?D(W.data.byteLength===J*V*Math.max(Ai(W.type,P),W.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):W.element||W.copy)}}}}var i=x(D,{optional:us,raise:C,commandRaise:vr,command:je,parameter:Y,commandParameter:jr,constructor:Re,type:me,commandType:pi,isTypedArray:ne,nni:pe,oneOf:be,shaderError:or,linkError:Ye,callSite:Me,saveCommandRef:mr,saveDrawInfo:hr,framebufferFormat:ds,guessCommand:Fe,texture2D:Ts,textureCube:Ss}),ws=0,Rs=0,Ls=5,Cs=6;function Hr(r,a){this.id=ws++,this.type=r,this.data=a}function Ti(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function wt(r){if(r.length===0)return[];var a=r.charAt(0),u=r.charAt(r.length-1);if(r.length>1&&a===u&&(a==='"'||a==="'"))return['"'+Ti(r.substr(1,r.length-2))+'"'];var w=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(r);if(w)return wt(r.substr(0,w.index)).concat(wt(w[1])).concat(wt(r.substr(w.index+w[0].length)));var N=r.split(".");if(N.length===1)return['"'+Ti(r)+'"'];for(var S=[],P=0;P<N.length;++P)S=S.concat(wt(N[P]));return S}function Si(r){return"["+wt(r).join("][")+"]"}function Os(r,a){return new Hr(r,Si(a+""))}function Ps(r){return typeof r=="function"&&!r._reglType||r instanceof Hr}function wi(r,a){if(typeof r=="function")return new Hr(Rs,r);if(typeof r=="number"||typeof r=="boolean")return new Hr(Ls,r);if(Array.isArray(r))return new Hr(Cs,r.map(function(u,w){return wi(u,a+"["+w+"]")}));if(r instanceof Hr)return r;i(!1,"invalid option type in uniform "+a)}var _r={DynamicVariable:Hr,define:Os,isDynamic:Ps,unbox:wi,accessor:Si},On={next:typeof requestAnimationFrame=="function"?function(r){return requestAnimationFrame(r)}:function(r){return setTimeout(r,16)},cancel:typeof cancelAnimationFrame=="function"?function(r){return cancelAnimationFrame(r)}:clearTimeout},Ri=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Fs(){var r={"":0},a=[""];return{id:function(u){var w=r[u];return w||(w=r[u]=a.length,a.push(u),w)},str:function(u){return a[u]}}}function Gs(r,a,u){var w=document.createElement("canvas");x(w.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),r.appendChild(w),r===document.body&&(w.style.position="absolute",x(r.style,{margin:0,padding:0}));function N(){var $=window.innerWidth,U=window.innerHeight;if(r!==document.body){var X=w.getBoundingClientRect();$=X.right-X.left,U=X.bottom-X.top}w.width=u*$,w.height=u*U}var S;r!==document.body&&typeof ResizeObserver=="function"?(S=new ResizeObserver(function(){setTimeout(N)}),S.observe(r)):window.addEventListener("resize",N,!1);function P(){S?S.disconnect():window.removeEventListener("resize",N),r.removeChild(w)}return N(),{canvas:w,onDestroy:P}}function Ds(r,a){function u(w){try{return r.getContext(w,a)}catch{return null}}return u("webgl")||u("experimental-webgl")||u("webgl-experimental")}function Is(r){return typeof r.nodeName=="string"&&typeof r.appendChild=="function"&&typeof r.getBoundingClientRect=="function"}function Ns(r){return typeof r.drawArrays=="function"||typeof r.drawElements=="function"}function Li(r){return typeof r=="string"?r.split():(i(Array.isArray(r),"invalid extension array"),r)}function Ci(r){return typeof r=="string"?(i(typeof document<"u","not supported outside of DOM"),document.querySelector(r)):r}function ks(r){var a=r||{},u,w,N,S,P={},$=[],U=[],X=typeof window>"u"?1:window.devicePixelRatio,Q=!1,W=function(H){H&&i.raise(H)},J=function(){};if(typeof a=="string"?(i(typeof document<"u","selector queries only supported in DOM enviroments"),u=document.querySelector(a),i(u,"invalid query string for element")):typeof a=="object"?Is(a)?u=a:Ns(a)?(S=a,N=S.canvas):(i.constructor(a),"gl"in a?S=a.gl:"canvas"in a?N=Ci(a.canvas):"container"in a&&(w=Ci(a.container)),"attributes"in a&&(P=a.attributes,i.type(P,"object","invalid context attributes")),"extensions"in a&&($=Li(a.extensions)),"optionalExtensions"in a&&(U=Li(a.optionalExtensions)),"onDone"in a&&(i.type(a.onDone,"function","invalid or missing onDone callback"),W=a.onDone),"profile"in a&&(Q=!!a.profile),"pixelRatio"in a&&(X=+a.pixelRatio,i(X>0,"invalid pixel ratio"))):i.raise("invalid arguments to regl"),u&&(u.nodeName.toLowerCase()==="canvas"?N=u:w=u),!S){if(!N){i(typeof document<"u","must manually specify webgl context outside of DOM environments");var V=Gs(w||document.body,W,X);if(!V)return null;N=V.canvas,J=V.onDestroy}P.premultipliedAlpha===void 0&&(P.premultipliedAlpha=!0),S=Ds(N,P)}return S?{gl:S,canvas:N,container:w,extensions:$,optionalExtensions:U,pixelRatio:X,profile:Q,onDone:W,onDestroy:J}:(J(),W("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Bs(r,a){var u={};function w(P){i.type(P,"string","extension name must be string");var $=P.toLowerCase(),U;try{U=u[$]=r.getExtension($)}catch{}return!!U}for(var N=0;N<a.extensions.length;++N){var S=a.extensions[N];if(!w(S))return a.onDestroy(),a.onDone('"'+S+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return a.optionalExtensions.forEach(w),{extensions:u,restore:function(){Object.keys(u).forEach(function(P){if(u[P]&&!w(P))throw new Error("(regl): error restoring extension "+P)})}}}function xr(r,a){for(var u=Array(r),w=0;w<r;++w)u[w]=a(w);return u}var Ms=5120,zs=5121,Us=5122,$s=5123,Vs=5124,qs=5125,js=5126;function Hs(r){for(var a=16;a<=1<<28;a*=16)if(r<=a)return a;return 0}function Oi(r){var a,u;return a=(r>65535)<<4,r>>>=a,u=(r>255)<<3,r>>>=u,a|=u,u=(r>15)<<2,r>>>=u,a|=u,u=(r>3)<<1,r>>>=u,a|=u,a|r>>1}function Pi(){var r=xr(8,function(){return[]});function a(S){var P=Hs(S),$=r[Oi(P)>>2];return $.length>0?$.pop():new ArrayBuffer(P)}function u(S){r[Oi(S.byteLength)>>2].push(S)}function w(S,P){var $=null;switch(S){case Ms:$=new Int8Array(a(P),0,P);break;case zs:$=new Uint8Array(a(P),0,P);break;case Us:$=new Int16Array(a(2*P),0,P);break;case $s:$=new Uint16Array(a(2*P),0,P);break;case Vs:$=new Int32Array(a(4*P),0,P);break;case qs:$=new Uint32Array(a(4*P),0,P);break;case js:$=new Float32Array(a(4*P),0,P);break;default:return null}return $.length!==P?$.subarray(0,P):$}function N(S){u(S.buffer)}return{alloc:a,free:u,allocType:w,freeType:N}}var Ke=Pi();Ke.zero=Pi();var Xs=3408,Ws=3410,Ys=3411,Qs=3412,Zs=3413,Ks=3414,Js=3415,ec=33901,rc=33902,tc=3379,nc=3386,ac=34921,ic=36347,fc=36348,oc=35661,sc=35660,cc=34930,lc=36349,uc=34076,dc=34024,mc=7936,vc=7937,hc=7938,pc=35724,yc=34047,bc=36063,gc=34852,Wt=3553,Fi=34067,_c=34069,xc=33984,Rt=6408,Pn=5126,Gi=5121,Fn=36160,Ec=36053,Ac=36064,Tc=16384,Sc=function(r,a){var u=1;a.ext_texture_filter_anisotropic&&(u=r.getParameter(yc));var w=1,N=1;a.webgl_draw_buffers&&(w=r.getParameter(gc),N=r.getParameter(bc));var S=!!a.oes_texture_float;if(S){var P=r.createTexture();r.bindTexture(Wt,P),r.texImage2D(Wt,0,Rt,1,1,0,Rt,Pn,null);var $=r.createFramebuffer();if(r.bindFramebuffer(Fn,$),r.framebufferTexture2D(Fn,Ac,Wt,P,0),r.bindTexture(Wt,null),r.checkFramebufferStatus(Fn)!==Ec)S=!1;else{r.viewport(0,0,1,1),r.clearColor(1,0,0,1),r.clear(Tc);var U=Ke.allocType(Pn,4);r.readPixels(0,0,1,1,Rt,Pn,U),r.getError()?S=!1:(r.deleteFramebuffer($),r.deleteTexture(P),S=U[0]===1),Ke.freeType(U)}}var X=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Q=!0;if(!X){var W=r.createTexture(),J=Ke.allocType(Gi,36);r.activeTexture(xc),r.bindTexture(Fi,W),r.texImage2D(_c,0,Rt,3,3,0,Rt,Gi,J),Ke.freeType(J),r.bindTexture(Fi,null),r.deleteTexture(W),Q=!r.getError()}return{colorBits:[r.getParameter(Ws),r.getParameter(Ys),r.getParameter(Qs),r.getParameter(Zs)],depthBits:r.getParameter(Ks),stencilBits:r.getParameter(Js),subpixelBits:r.getParameter(Xs),extensions:Object.keys(a).filter(function(V){return!!a[V]}),maxAnisotropic:u,maxDrawbuffers:w,maxColorAttachments:N,pointSizeDims:r.getParameter(ec),lineWidthDims:r.getParameter(rc),maxViewportDims:r.getParameter(nc),maxCombinedTextureUnits:r.getParameter(oc),maxCubeMapSize:r.getParameter(uc),maxRenderbufferSize:r.getParameter(dc),maxTextureUnits:r.getParameter(cc),maxTextureSize:r.getParameter(tc),maxAttributes:r.getParameter(ac),maxVertexUniforms:r.getParameter(ic),maxVertexTextureUnits:r.getParameter(sc),maxVaryingVectors:r.getParameter(fc),maxFragmentUniforms:r.getParameter(lc),glsl:r.getParameter(pc),renderer:r.getParameter(vc),vendor:r.getParameter(mc),version:r.getParameter(hc),readFloat:S,npotTextureCube:Q}};function wr(r){return!!r&&typeof r=="object"&&Array.isArray(r.shape)&&Array.isArray(r.stride)&&typeof r.offset=="number"&&r.shape.length===r.stride.length&&(Array.isArray(r.data)||t(r.data))}var Er=function(r){return Object.keys(r).map(function(a){return r[a]})},Yt={shape:Cc,flatten:Lc};function wc(r,a,u){for(var w=0;w<a;++w)u[w]=r[w]}function Rc(r,a,u,w){for(var N=0,S=0;S<a;++S)for(var P=r[S],$=0;$<u;++$)w[N++]=P[$]}function Di(r,a,u,w,N,S){for(var P=S,$=0;$<a;++$)for(var U=r[$],X=0;X<u;++X)for(var Q=U[X],W=0;W<w;++W)N[P++]=Q[W]}function Ii(r,a,u,w,N){for(var S=1,P=u+1;P<a.length;++P)S*=a[P];var $=a[u];if(a.length-u===4){var U=a[u+1],X=a[u+2],Q=a[u+3];for(P=0;P<$;++P)Di(r[P],U,X,Q,w,N),N+=S}else for(P=0;P<$;++P)Ii(r[P],a,u+1,w,N),N+=S}function Lc(r,a,u,w){var N=1;if(a.length)for(var S=0;S<a.length;++S)N*=a[S];else N=0;var P=w||Ke.allocType(u,N);switch(a.length){case 0:break;case 1:wc(r,a[0],P);break;case 2:Rc(r,a[0],a[1],P);break;case 3:Di(r,a[0],a[1],a[2],P,0);break;default:Ii(r,a,0,P,0)}return P}function Cc(r){for(var a=[],u=r;u.length;u=u[0])a.push(u.length);return a}var Gn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Oc=5120,Pc=5122,Fc=5124,Gc=5121,Dc=5123,Ic=5125,Nc=5126,kc=5126,Xr={int8:Oc,int16:Pc,int32:Fc,uint8:Gc,uint16:Dc,uint32:Ic,float:Nc,float32:kc},Bc=35048,Mc=35040,Qt={dynamic:Bc,stream:Mc,static:35044},Dn=Yt.flatten,Ni=Yt.shape,ki=35044,zc=35040,In=5121,Nn=5126,kr=[];kr[5120]=1,kr[5122]=2,kr[5124]=4,kr[5121]=1,kr[5123]=2,kr[5125]=4,kr[5126]=4;function Zt(r){return Gn[Object.prototype.toString.call(r)]|0}function Bi(r,a){for(var u=0;u<a.length;++u)r[u]=a[u]}function Mi(r,a,u,w,N,S,P){for(var $=0,U=0;U<u;++U)for(var X=0;X<w;++X)r[$++]=a[N*U+S*X+P]}function Uc(r,a,u,w){var N=0,S={};function P(y){this.id=N++,this.buffer=r.createBuffer(),this.type=y,this.usage=ki,this.byteLength=0,this.dimension=1,this.dtype=In,this.persistentData=null,u.profile&&(this.stats={size:0})}P.prototype.bind=function(){r.bindBuffer(this.type,this.buffer)},P.prototype.destroy=function(){J(this)};var $=[];function U(y,O){var j=$.pop();return j||(j=new P(y)),j.bind(),W(j,O,zc,0,1,!1),j}function X(y){$.push(y)}function Q(y,O,j){y.byteLength=O.byteLength,r.bufferData(y.type,O,j)}function W(y,O,j,se,z,fe){var ae;if(y.usage=j,Array.isArray(O)){if(y.dtype=se||Nn,O.length>0){var _e;if(Array.isArray(O[0])){ae=Ni(O);for(var k=1,I=1;I<ae.length;++I)k*=ae[I];y.dimension=k,_e=Dn(O,ae,y.dtype),Q(y,_e,j),fe?y.persistentData=_e:Ke.freeType(_e)}else if(typeof O[0]=="number"){y.dimension=z;var ue=Ke.allocType(y.dtype,O.length);Bi(ue,O),Q(y,ue,j),fe?y.persistentData=ue:Ke.freeType(ue)}else t(O[0])?(y.dimension=O[0].length,y.dtype=se||Zt(O[0])||Nn,_e=Dn(O,[O.length,O[0].length],y.dtype),Q(y,_e,j),fe?y.persistentData=_e:Ke.freeType(_e)):i.raise("invalid buffer data")}}else if(t(O))y.dtype=se||Zt(O),y.dimension=z,Q(y,O,j),fe&&(y.persistentData=new Uint8Array(new Uint8Array(O.buffer)));else if(wr(O)){ae=O.shape;var ee=O.stride,q=O.offset,re=0,te=0,Ce=0,Le=0;ae.length===1?(re=ae[0],te=1,Ce=ee[0],Le=0):ae.length===2?(re=ae[0],te=ae[1],Ce=ee[0],Le=ee[1]):i.raise("invalid shape"),y.dtype=se||Zt(O.data)||Nn,y.dimension=te;var ie=Ke.allocType(y.dtype,re*te);Mi(ie,O.data,re,te,Ce,Le,q),Q(y,ie,j),fe?y.persistentData=ie:Ke.freeType(ie)}else O instanceof ArrayBuffer?(y.dtype=In,y.dimension=z,Q(y,O,j),fe&&(y.persistentData=new Uint8Array(new Uint8Array(O)))):i.raise("invalid buffer data")}function J(y){a.bufferCount--,w(y);var O=y.buffer;i(O,"buffer must not be deleted already"),r.deleteBuffer(O),y.buffer=null,delete S[y.id]}function V(y,O,j,se){a.bufferCount++;var z=new P(O);S[z.id]=z;function fe(k){var I=ki,ue=null,ee=0,q=0,re=1;return Array.isArray(k)||t(k)||wr(k)||k instanceof ArrayBuffer?ue=k:typeof k=="number"?ee=k|0:k&&(i.type(k,"object","buffer arguments must be an object, a number or an array"),"data"in k&&(i(ue===null||Array.isArray(ue)||t(ue)||wr(ue),"invalid data for buffer"),ue=k.data),"usage"in k&&(i.parameter(k.usage,Qt,"invalid buffer usage"),I=Qt[k.usage]),"type"in k&&(i.parameter(k.type,Xr,"invalid buffer type"),q=Xr[k.type]),"dimension"in k&&(i.type(k.dimension,"number","invalid dimension"),re=k.dimension|0),"length"in k&&(i.nni(ee,"buffer length must be a nonnegative integer"),ee=k.length|0)),z.bind(),ue?W(z,ue,I,q,re,se):(ee&&r.bufferData(z.type,ee,I),z.dtype=q||In,z.usage=I,z.dimension=re,z.byteLength=ee),u.profile&&(z.stats.size=z.byteLength*kr[z.dtype]),fe}function ae(k,I){i(I+k.byteLength<=z.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+k.byteLength+" starting from offset "+I+" to a buffer of size "+z.byteLength),r.bufferSubData(z.type,I,k)}function _e(k,I){var ue=(I||0)|0,ee;if(z.bind(),t(k)||k instanceof ArrayBuffer)ae(k,ue);else if(Array.isArray(k)){if(k.length>0)if(typeof k[0]=="number"){var q=Ke.allocType(z.dtype,k.length);Bi(q,k),ae(q,ue),Ke.freeType(q)}else if(Array.isArray(k[0])||t(k[0])){ee=Ni(k);var re=Dn(k,ee,z.dtype);ae(re,ue),Ke.freeType(re)}else i.raise("invalid buffer data")}else if(wr(k)){ee=k.shape;var te=k.stride,Ce=0,Le=0,ie=0,oe=0;ee.length===1?(Ce=ee[0],Le=1,ie=te[0],oe=0):ee.length===2?(Ce=ee[0],Le=ee[1],ie=te[0],oe=te[1]):i.raise("invalid shape");var Ae=Array.isArray(k.data)?z.dtype:Zt(k.data),Oe=Ke.allocType(Ae,Ce*Le);Mi(Oe,k.data,Ce,Le,ie,oe,k.offset),ae(Oe,ue),Ke.freeType(Oe)}else i.raise("invalid data for buffer subdata");return fe}return j||fe(y),fe._reglType="buffer",fe._buffer=z,fe.subdata=_e,u.profile&&(fe.stats=z.stats),fe.destroy=function(){J(z)},fe}function H(){Er(S).forEach(function(y){y.buffer=r.createBuffer(),r.bindBuffer(y.type,y.buffer),r.bufferData(y.type,y.persistentData||y.byteLength,y.usage)})}return u.profile&&(a.getTotalBufferSize=function(){var y=0;return Object.keys(S).forEach(function(O){y+=S[O].stats.size}),y}),{create:V,createStream:U,destroyStream:X,clear:function(){Er(S).forEach(J),$.forEach(J)},getBuffer:function(y){return y&&y._buffer instanceof P?y._buffer:null},restore:H,_initBuffer:W}}var $c=0,Vc=0,qc=1,jc=1,Hc=4,Xc=4,Br={points:$c,point:Vc,lines:qc,line:jc,triangles:Hc,triangle:Xc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Wc=0,Yc=1,Lt=4,Qc=5120,ct=5121,zi=5122,lt=5123,Ui=5124,Wr=5125,kn=34963,Zc=35040,Kc=35044;function Jc(r,a,u,w){var N={},S=0,P={uint8:ct,uint16:lt};a.oes_element_index_uint&&(P.uint32=Wr);function $(H){this.id=S++,N[this.id]=this,this.buffer=H,this.primType=Lt,this.vertCount=0,this.type=0}$.prototype.bind=function(){this.buffer.bind()};var U=[];function X(H){var y=U.pop();return y||(y=new $(u.create(null,kn,!0,!1)._buffer)),W(y,H,Zc,-1,-1,0,0),y}function Q(H){U.push(H)}function W(H,y,O,j,se,z,fe){H.buffer.bind();var ae;if(y){var _e=fe;!fe&&(!t(y)||wr(y)&&!t(y.data))&&(_e=a.oes_element_index_uint?Wr:lt),u._initBuffer(H.buffer,y,O,_e,3)}else r.bufferData(kn,z,O),H.buffer.dtype=ae||ct,H.buffer.usage=O,H.buffer.dimension=3,H.buffer.byteLength=z;if(ae=fe,!fe){switch(H.buffer.dtype){case ct:case Qc:ae=ct;break;case lt:case zi:ae=lt;break;case Wr:case Ui:ae=Wr;break;default:i.raise("unsupported type for element array")}H.buffer.dtype=ae}H.type=ae,i(ae!==Wr||!!a.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var k=se;k<0&&(k=H.buffer.byteLength,ae===lt?k>>=1:ae===Wr&&(k>>=2)),H.vertCount=k;var I=j;if(j<0){I=Lt;var ue=H.buffer.dimension;ue===1&&(I=Wc),ue===2&&(I=Yc),ue===3&&(I=Lt)}H.primType=I}function J(H){w.elementsCount--,i(H.buffer!==null,"must not double destroy elements"),delete N[H.id],H.buffer.destroy(),H.buffer=null}function V(H,y){var O=u.create(null,kn,!0),j=new $(O._buffer);w.elementsCount++;function se(z){if(!z)O(),j.primType=Lt,j.vertCount=0,j.type=ct;else if(typeof z=="number")O(z),j.primType=Lt,j.vertCount=z|0,j.type=ct;else{var fe=null,ae=Kc,_e=-1,k=-1,I=0,ue=0;Array.isArray(z)||t(z)||wr(z)?fe=z:(i.type(z,"object","invalid arguments for elements"),"data"in z&&(fe=z.data,i(Array.isArray(fe)||t(fe)||wr(fe),"invalid data for element buffer")),"usage"in z&&(i.parameter(z.usage,Qt,"invalid element buffer usage"),ae=Qt[z.usage]),"primitive"in z&&(i.parameter(z.primitive,Br,"invalid element buffer primitive"),_e=Br[z.primitive]),"count"in z&&(i(typeof z.count=="number"&&z.count>=0,"invalid vertex count for elements"),k=z.count|0),"type"in z&&(i.parameter(z.type,P,"invalid buffer type"),ue=P[z.type]),"length"in z?I=z.length|0:(I=k,ue===lt||ue===zi?I*=2:(ue===Wr||ue===Ui)&&(I*=4))),W(j,fe,ae,_e,k,I,ue)}return se}return se(H),se._reglType="elements",se._elements=j,se.subdata=function(z,fe){return O.subdata(z,fe),se},se.destroy=function(){J(j)},se}return{create:V,createStream:X,destroyStream:Q,getElements:function(H){return typeof H=="function"&&H._elements instanceof $?H._elements:null},clear:function(){Er(N).forEach(J)}}}var $i=new Float32Array(1),el=new Uint32Array($i.buffer),rl=5123;function Vi(r){for(var a=Ke.allocType(rl,r.length),u=0;u<r.length;++u)if(isNaN(r[u]))a[u]=65535;else if(r[u]===1/0)a[u]=31744;else if(r[u]===-1/0)a[u]=64512;else{$i[0]=r[u];var w=el[0],N=w>>>31<<15,S=(w<<1>>>24)-127,P=w>>13&1023;if(S<-24)a[u]=N;else if(S<-14){var $=-14-S;a[u]=N+(P+1024>>$)}else S>15?a[u]=N+31744:a[u]=N+(S+15<<10)+P}return a}function He(r){return Array.isArray(r)||t(r)}var qi=function(r){return!(r&r-1)&&!!r},tl=34467,Cr=3553,Bn=34067,Kt=34069,Yr=6408,Mn=6406,Jt=6407,Ct=6409,en=6410,ji=32854,zn=32855,Hi=36194,nl=32819,al=32820,il=33635,fl=34042,Un=6402,rn=34041,$n=35904,Vn=35906,ut=36193,qn=33776,jn=33777,Hn=33778,Xn=33779,Xi=35986,Wi=35987,Yi=34798,Qi=35840,Zi=35841,Ki=35842,Ji=35843,ef=36196,dt=5121,Wn=5123,Yn=5125,Ot=5126,ol=10242,sl=10243,cl=10497,Qn=33071,ll=33648,ul=10240,dl=10241,Zn=9728,ml=9729,Kn=9984,rf=9985,tf=9986,Jn=9987,vl=33170,tn=4352,hl=4353,pl=4354,yl=34046,bl=3317,gl=37440,_l=37441,xl=37443,nf=37444,Pt=33984,El=[Kn,tf,rf,Jn],nn=[0,Ct,en,Jt,Yr],Tr={};Tr[Ct]=Tr[Mn]=Tr[Un]=1,Tr[rn]=Tr[en]=2,Tr[Jt]=Tr[$n]=3,Tr[Yr]=Tr[Vn]=4;function mt(r){return"[object "+r+"]"}var af=mt("HTMLCanvasElement"),ff=mt("OffscreenCanvas"),of=mt("CanvasRenderingContext2D"),sf=mt("ImageBitmap"),cf=mt("HTMLImageElement"),lf=mt("HTMLVideoElement"),Al=Object.keys(Gn).concat([af,ff,of,sf,cf,lf]),vt=[];vt[dt]=1,vt[Ot]=4,vt[ut]=2,vt[Wn]=2,vt[Yn]=4;var sr=[];sr[ji]=2,sr[zn]=2,sr[Hi]=2,sr[rn]=4,sr[qn]=.5,sr[jn]=.5,sr[Hn]=1,sr[Xn]=1,sr[Xi]=.5,sr[Wi]=1,sr[Yi]=1,sr[Qi]=.5,sr[Zi]=.25,sr[Ki]=.5,sr[Ji]=.25,sr[ef]=.5;function uf(r){return Array.isArray(r)&&(r.length===0||typeof r[0]=="number")}function df(r){if(!Array.isArray(r))return!1;var a=r.length;return!(a===0||!He(r[0]))}function Qr(r){return Object.prototype.toString.call(r)}function mf(r){return Qr(r)===af}function vf(r){return Qr(r)===ff}function Tl(r){return Qr(r)===of}function Sl(r){return Qr(r)===sf}function wl(r){return Qr(r)===cf}function Rl(r){return Qr(r)===lf}function ea(r){if(!r)return!1;var a=Qr(r);return Al.indexOf(a)>=0?!0:uf(r)||df(r)||wr(r)}function hf(r){return Gn[Object.prototype.toString.call(r)]|0}function Ll(r,a){var u=a.length;switch(r.type){case dt:case Wn:case Yn:case Ot:var w=Ke.allocType(r.type,u);w.set(a),r.data=w;break;case ut:r.data=Vi(a);break;default:i.raise("unsupported texture type, must specify a typed array")}}function pf(r,a){return Ke.allocType(r.type===ut?Ot:r.type,a)}function yf(r,a){r.type===ut?(r.data=Vi(a),Ke.freeType(a)):r.data=a}function Cl(r,a,u,w,N,S){for(var P=r.width,$=r.height,U=r.channels,X=P*$*U,Q=pf(r,X),W=0,J=0;J<$;++J)for(var V=0;V<P;++V)for(var H=0;H<U;++H)Q[W++]=a[u*V+w*J+N*H+S];yf(r,Q)}function an(r,a,u,w,N,S){var P;if(typeof sr[r]<"u"?P=sr[r]:P=Tr[r]*vt[a],S&&(P*=6),N){for(var $=0,U=u;U>=1;)$+=P*U*U,U/=2;return $}else return P*u*w}function Ol(r,a,u,w,N,S,P){var $={"don't care":tn,"dont care":tn,nice:pl,fast:hl},U={repeat:cl,clamp:Qn,mirror:ll},X={nearest:Zn,linear:ml},Q=x({mipmap:Jn,"nearest mipmap nearest":Kn,"linear mipmap nearest":rf,"nearest mipmap linear":tf,"linear mipmap linear":Jn},X),W={none:0,browser:nf},J={uint8:dt,rgba4:nl,rgb565:il,"rgb5 a1":al},V={alpha:Mn,luminance:Ct,"luminance alpha":en,rgb:Jt,rgba:Yr,rgba4:ji,"rgb5 a1":zn,rgb565:Hi},H={};a.ext_srgb&&(V.srgb=$n,V.srgba=Vn),a.oes_texture_float&&(J.float32=J.float=Ot),a.oes_texture_half_float&&(J.float16=J["half float"]=ut),a.webgl_depth_texture&&(x(V,{depth:Un,"depth stencil":rn}),x(J,{uint16:Wn,uint32:Yn,"depth stencil":fl})),a.webgl_compressed_texture_s3tc&&x(H,{"rgb s3tc dxt1":qn,"rgba s3tc dxt1":jn,"rgba s3tc dxt3":Hn,"rgba s3tc dxt5":Xn}),a.webgl_compressed_texture_atc&&x(H,{"rgb atc":Xi,"rgba atc explicit alpha":Wi,"rgba atc interpolated alpha":Yi}),a.webgl_compressed_texture_pvrtc&&x(H,{"rgb pvrtc 4bppv1":Qi,"rgb pvrtc 2bppv1":Zi,"rgba pvrtc 4bppv1":Ki,"rgba pvrtc 2bppv1":Ji}),a.webgl_compressed_texture_etc1&&(H["rgb etc1"]=ef);var y=Array.prototype.slice.call(r.getParameter(tl));Object.keys(H).forEach(function(c){var R=H[c];y.indexOf(R)>=0&&(V[c]=R)});var O=Object.keys(V);u.textureFormats=O;var j=[];Object.keys(V).forEach(function(c){var R=V[c];j[R]=c});var se=[];Object.keys(J).forEach(function(c){var R=J[c];se[R]=c});var z=[];Object.keys(X).forEach(function(c){var R=X[c];z[R]=c});var fe=[];Object.keys(Q).forEach(function(c){var R=Q[c];fe[R]=c});var ae=[];Object.keys(U).forEach(function(c){var R=U[c];ae[R]=c});var _e=O.reduce(function(c,R){var A=V[R];return A===Ct||A===Mn||A===Ct||A===en||A===Un||A===rn||a.ext_srgb&&(A===$n||A===Vn)?c[A]=A:A===zn||R.indexOf("rgba")>=0?c[A]=Yr:c[A]=Jt,c},{});function k(){this.internalformat=Yr,this.format=Yr,this.type=dt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=nf,this.width=0,this.height=0,this.channels=0}function I(c,R){c.internalformat=R.internalformat,c.format=R.format,c.type=R.type,c.compressed=R.compressed,c.premultiplyAlpha=R.premultiplyAlpha,c.flipY=R.flipY,c.unpackAlignment=R.unpackAlignment,c.colorSpace=R.colorSpace,c.width=R.width,c.height=R.height,c.channels=R.channels}function ue(c,R){if(!(typeof R!="object"||!R)){if("premultiplyAlpha"in R&&(i.type(R.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),c.premultiplyAlpha=R.premultiplyAlpha),"flipY"in R&&(i.type(R.flipY,"boolean","invalid texture flip"),c.flipY=R.flipY),"alignment"in R&&(i.oneOf(R.alignment,[1,2,4,8],"invalid texture unpack alignment"),c.unpackAlignment=R.alignment),"colorSpace"in R&&(i.parameter(R.colorSpace,W,"invalid colorSpace"),c.colorSpace=W[R.colorSpace]),"type"in R){var A=R.type;i(a.oes_texture_float||!(A==="float"||A==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),i(a.oes_texture_half_float||!(A==="half float"||A==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),i(a.webgl_depth_texture||!(A==="uint16"||A==="uint32"||A==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),i.parameter(A,J,"invalid texture type"),c.type=J[A]}var le=c.width,Ge=c.height,f=c.channels,n=!1;"shape"in R?(i(Array.isArray(R.shape)&&R.shape.length>=2,"shape must be an array"),le=R.shape[0],Ge=R.shape[1],R.shape.length===3&&(f=R.shape[2],i(f>0&&f<=4,"invalid number of channels"),n=!0),i(le>=0&&le<=u.maxTextureSize,"invalid width"),i(Ge>=0&&Ge<=u.maxTextureSize,"invalid height")):("radius"in R&&(le=Ge=R.radius,i(le>=0&&le<=u.maxTextureSize,"invalid radius")),"width"in R&&(le=R.width,i(le>=0&&le<=u.maxTextureSize,"invalid width")),"height"in R&&(Ge=R.height,i(Ge>=0&&Ge<=u.maxTextureSize,"invalid height")),"channels"in R&&(f=R.channels,i(f>0&&f<=4,"invalid number of channels"),n=!0)),c.width=le|0,c.height=Ge|0,c.channels=f|0;var d=!1;if("format"in R){var p=R.format;i(a.webgl_depth_texture||!(p==="depth"||p==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),i.parameter(p,V,"invalid texture format");var b=c.internalformat=V[p];c.format=_e[b],p in J&&("type"in R||(c.type=J[p])),p in H&&(c.compressed=!0),d=!0}!n&&d?c.channels=Tr[c.format]:n&&!d?c.channels!==nn[c.format]&&(c.format=c.internalformat=nn[c.channels]):d&&n&&i(c.channels===Tr[c.format],"number of channels inconsistent with specified format")}}function ee(c){r.pixelStorei(gl,c.flipY),r.pixelStorei(_l,c.premultiplyAlpha),r.pixelStorei(xl,c.colorSpace),r.pixelStorei(bl,c.unpackAlignment)}function q(){k.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function re(c,R){var A=null;if(ea(R)?A=R:R&&(i.type(R,"object","invalid pixel data type"),ue(c,R),"x"in R&&(c.xOffset=R.x|0),"y"in R&&(c.yOffset=R.y|0),ea(R.data)&&(A=R.data)),i(!c.compressed||A instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),R.copy){i(!A,"can not specify copy and data field for the same texture");var le=N.viewportWidth,Ge=N.viewportHeight;c.width=c.width||le-c.xOffset,c.height=c.height||Ge-c.yOffset,c.needsCopy=!0,i(c.xOffset>=0&&c.xOffset<le&&c.yOffset>=0&&c.yOffset<Ge&&c.width>0&&c.width<=le&&c.height>0&&c.height<=Ge,"copy texture read out of bounds")}else if(!A)c.width=c.width||1,c.height=c.height||1,c.channels=c.channels||4;else if(t(A))c.channels=c.channels||4,c.data=A,!("type"in R)&&c.type===dt&&(c.type=hf(A));else if(uf(A))c.channels=c.channels||4,Ll(c,A),c.alignment=1,c.needsFree=!0;else if(wr(A)){var f=A.data;!Array.isArray(f)&&c.type===dt&&(c.type=hf(f));var n=A.shape,d=A.stride,p,b,v,m,h,o;n.length===3?(v=n[2],o=d[2]):(i(n.length===2,"invalid ndarray pixel data, must be 2 or 3D"),v=1,o=1),p=n[0],b=n[1],m=d[0],h=d[1],c.alignment=1,c.width=p,c.height=b,c.channels=v,c.format=c.internalformat=nn[v],c.needsFree=!0,Cl(c,f,m,h,o,A.offset)}else if(mf(A)||vf(A)||Tl(A))mf(A)||vf(A)?c.element=A:c.element=A.canvas,c.width=c.element.width,c.height=c.element.height,c.channels=4;else if(Sl(A))c.element=A,c.width=A.width,c.height=A.height,c.channels=4;else if(wl(A))c.element=A,c.width=A.naturalWidth,c.height=A.naturalHeight,c.channels=4;else if(Rl(A))c.element=A,c.width=A.videoWidth,c.height=A.videoHeight,c.channels=4;else if(df(A)){var l=c.width||A[0].length,s=c.height||A.length,E=c.channels;He(A[0][0])?E=E||A[0][0].length:E=E||1;for(var g=Yt.shape(A),G=1,B=0;B<g.length;++B)G*=g[B];var K=pf(c,G);Yt.flatten(A,g,"",K),yf(c,K),c.alignment=1,c.width=l,c.height=s,c.channels=E,c.format=c.internalformat=nn[E],c.needsFree=!0}c.type===Ot?i(u.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):c.type===ut&&i(u.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function te(c,R,A){var le=c.element,Ge=c.data,f=c.internalformat,n=c.format,d=c.type,p=c.width,b=c.height;ee(c),le?r.texImage2D(R,A,n,n,d,le):c.compressed?r.compressedTexImage2D(R,A,f,p,b,0,Ge):c.needsCopy?(w(),r.copyTexImage2D(R,A,n,c.xOffset,c.yOffset,p,b,0)):r.texImage2D(R,A,n,p,b,0,n,d,Ge||null)}function Ce(c,R,A,le,Ge){var f=c.element,n=c.data,d=c.internalformat,p=c.format,b=c.type,v=c.width,m=c.height;ee(c),f?r.texSubImage2D(R,Ge,A,le,p,b,f):c.compressed?r.compressedTexSubImage2D(R,Ge,A,le,d,v,m,n):c.needsCopy?(w(),r.copyTexSubImage2D(R,Ge,A,le,c.xOffset,c.yOffset,v,m)):r.texSubImage2D(R,Ge,A,le,v,m,p,b,n)}var Le=[];function ie(){return Le.pop()||new q}function oe(c){c.needsFree&&Ke.freeType(c.data),q.call(c),Le.push(c)}function Ae(){k.call(this),this.genMipmaps=!1,this.mipmapHint=tn,this.mipmask=0,this.images=Array(16)}function Oe(c,R,A){var le=c.images[0]=ie();c.mipmask=1,le.width=c.width=R,le.height=c.height=A,le.channels=c.channels=4}function De(c,R){var A=null;if(ea(R))A=c.images[0]=ie(),I(A,c),re(A,R),c.mipmask=1;else if(ue(c,R),Array.isArray(R.mipmap))for(var le=R.mipmap,Ge=0;Ge<le.length;++Ge)A=c.images[Ge]=ie(),I(A,c),A.width>>=Ge,A.height>>=Ge,re(A,le[Ge]),c.mipmask|=1<<Ge;else A=c.images[0]=ie(),I(A,c),re(A,R),c.mipmask=1;I(c,c.images[0]),c.compressed&&(c.internalformat===qn||c.internalformat===jn||c.internalformat===Hn||c.internalformat===Xn)&&i(c.width%4===0&&c.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Xe(c,R){for(var A=c.images,le=0;le<A.length;++le){if(!A[le])return;te(A[le],R,le)}}var We=[];function Ne(){var c=We.pop()||new Ae;k.call(c),c.mipmask=0;for(var R=0;R<16;++R)c.images[R]=null;return c}function tr(c){for(var R=c.images,A=0;A<R.length;++A)R[A]&&oe(R[A]),R[A]=null;We.push(c)}function qe(){this.minFilter=Zn,this.magFilter=Zn,this.wrapS=Qn,this.wrapT=Qn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=tn}function er(c,R){if("min"in R){var A=R.min;i.parameter(A,Q),c.minFilter=Q[A],El.indexOf(c.minFilter)>=0&&!("faces"in R)&&(c.genMipmaps=!0)}if("mag"in R){var le=R.mag;i.parameter(le,X),c.magFilter=X[le]}var Ge=c.wrapS,f=c.wrapT;if("wrap"in R){var n=R.wrap;typeof n=="string"?(i.parameter(n,U),Ge=f=U[n]):Array.isArray(n)&&(i.parameter(n[0],U),i.parameter(n[1],U),Ge=U[n[0]],f=U[n[1]])}else{if("wrapS"in R){var d=R.wrapS;i.parameter(d,U),Ge=U[d]}if("wrapT"in R){var p=R.wrapT;i.parameter(p,U),f=U[p]}}if(c.wrapS=Ge,c.wrapT=f,"anisotropic"in R){var b=R.anisotropic;i(typeof b=="number"&&b>=1&&b<=u.maxAnisotropic,"aniso samples must be between 1 and "),c.anisotropic=R.anisotropic}if("mipmap"in R){var v=!1;switch(typeof R.mipmap){case"string":i.parameter(R.mipmap,$,"invalid mipmap hint"),c.mipmapHint=$[R.mipmap],c.genMipmaps=!0,v=!0;break;case"boolean":v=c.genMipmaps=R.mipmap;break;case"object":i(Array.isArray(R.mipmap),"invalid mipmap type"),c.genMipmaps=!1,v=!0;break;default:i.raise("invalid mipmap type")}v&&!("min"in R)&&(c.minFilter=Kn)}}function nr(c,R){r.texParameteri(R,dl,c.minFilter),r.texParameteri(R,ul,c.magFilter),r.texParameteri(R,ol,c.wrapS),r.texParameteri(R,sl,c.wrapT),a.ext_texture_filter_anisotropic&&r.texParameteri(R,yl,c.anisotropic),c.genMipmaps&&(r.hint(vl,c.mipmapHint),r.generateMipmap(R))}var ar=0,fr={},cr=u.maxTextureUnits,Qe=Array(cr).map(function(){return null});function Pe(c){k.call(this),this.mipmask=0,this.internalformat=Yr,this.id=ar++,this.refCount=1,this.target=c,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new qe,P.profile&&(this.stats={size:0})}function lr(c){r.activeTexture(Pt),r.bindTexture(c.target,c.texture)}function Ue(){var c=Qe[0];c?r.bindTexture(c.target,c.texture):r.bindTexture(Cr,null)}function Ee(c){var R=c.texture;i(R,"must not double destroy texture");var A=c.unit,le=c.target;A>=0&&(r.activeTexture(Pt+A),r.bindTexture(le,null),Qe[A]=null),r.deleteTexture(R),c.texture=null,c.params=null,c.pixels=null,c.refCount=0,delete fr[c.id],S.textureCount--}x(Pe.prototype,{bind:function(){var c=this;c.bindCount+=1;var R=c.unit;if(R<0){for(var A=0;A<cr;++A){var le=Qe[A];if(le){if(le.bindCount>0)continue;le.unit=-1}Qe[A]=c,R=A;break}R>=cr&&i.raise("insufficient number of texture units"),P.profile&&S.maxTextureUnits<R+1&&(S.maxTextureUnits=R+1),c.unit=R,r.activeTexture(Pt+R),r.bindTexture(c.target,c.texture)}return R},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ee(this)}});function Ie(c,R){var A=new Pe(Cr);fr[A.id]=A,S.textureCount++;function le(n,d){var p=A.texInfo;qe.call(p);var b=Ne();return typeof n=="number"?typeof d=="number"?Oe(b,n|0,d|0):Oe(b,n|0,n|0):n?(i.type(n,"object","invalid arguments to regl.texture"),er(p,n),De(b,n)):Oe(b,1,1),p.genMipmaps&&(b.mipmask=(b.width<<1)-1),A.mipmask=b.mipmask,I(A,b),i.texture2D(p,b,u),A.internalformat=b.internalformat,le.width=b.width,le.height=b.height,lr(A),Xe(b,Cr),nr(p,Cr),Ue(),tr(b),P.profile&&(A.stats.size=an(A.internalformat,A.type,b.width,b.height,p.genMipmaps,!1)),le.format=j[A.internalformat],le.type=se[A.type],le.mag=z[p.magFilter],le.min=fe[p.minFilter],le.wrapS=ae[p.wrapS],le.wrapT=ae[p.wrapT],le}function Ge(n,d,p,b){i(!!n,"must specify image data");var v=d|0,m=p|0,h=b|0,o=ie();return I(o,A),o.width=0,o.height=0,re(o,n),o.width=o.width||(A.width>>h)-v,o.height=o.height||(A.height>>h)-m,i(A.type===o.type&&A.format===o.format&&A.internalformat===o.internalformat,"incompatible format for texture.subimage"),i(v>=0&&m>=0&&v+o.width<=A.width&&m+o.height<=A.height,"texture.subimage write out of bounds"),i(A.mipmask&1<<h,"missing mipmap data"),i(o.data||o.element||o.needsCopy,"missing image data"),lr(A),Ce(o,Cr,v,m,h),Ue(),oe(o),le}function f(n,d){var p=n|0,b=d|0||p;if(p===A.width&&b===A.height)return le;le.width=A.width=p,le.height=A.height=b,lr(A);for(var v=0;A.mipmask>>v;++v){var m=p>>v,h=b>>v;if(!m||!h)break;r.texImage2D(Cr,v,A.format,m,h,0,A.format,A.type,null)}return Ue(),P.profile&&(A.stats.size=an(A.internalformat,A.type,p,b,!1,!1)),le}return le(c,R),le.subimage=Ge,le.resize=f,le._reglType="texture2d",le._texture=A,P.profile&&(le.stats=A.stats),le.destroy=function(){A.decRef()},le}function ze(c,R,A,le,Ge,f){var n=new Pe(Bn);fr[n.id]=n,S.cubeCount++;var d=new Array(6);function p(m,h,o,l,s,E){var g,G=n.texInfo;for(qe.call(G),g=0;g<6;++g)d[g]=Ne();if(typeof m=="number"||!m){var B=m|0||1;for(g=0;g<6;++g)Oe(d[g],B,B)}else if(typeof m=="object")if(h)De(d[0],m),De(d[1],h),De(d[2],o),De(d[3],l),De(d[4],s),De(d[5],E);else if(er(G,m),ue(n,m),"faces"in m){var K=m.faces;for(i(Array.isArray(K)&&K.length===6,"cube faces must be a length 6 array"),g=0;g<6;++g)i(typeof K[g]=="object"&&!!K[g],"invalid input for cube map face"),I(d[g],n),De(d[g],K[g])}else for(g=0;g<6;++g)De(d[g],m);else i.raise("invalid arguments to cube map");for(I(n,d[0]),i.optional(function(){u.npotTextureCube||i(qi(n.width)&&qi(n.height),"your browser does not support non power or two texture dimensions")}),G.genMipmaps?n.mipmask=(d[0].width<<1)-1:n.mipmask=d[0].mipmask,i.textureCube(n,G,d,u),n.internalformat=d[0].internalformat,p.width=d[0].width,p.height=d[0].height,lr(n),g=0;g<6;++g)Xe(d[g],Kt+g);for(nr(G,Bn),Ue(),P.profile&&(n.stats.size=an(n.internalformat,n.type,p.width,p.height,G.genMipmaps,!0)),p.format=j[n.internalformat],p.type=se[n.type],p.mag=z[G.magFilter],p.min=fe[G.minFilter],p.wrapS=ae[G.wrapS],p.wrapT=ae[G.wrapT],g=0;g<6;++g)tr(d[g]);return p}function b(m,h,o,l,s){i(!!h,"must specify image data"),i(typeof m=="number"&&m===(m|0)&&m>=0&&m<6,"invalid face");var E=o|0,g=l|0,G=s|0,B=ie();return I(B,n),B.width=0,B.height=0,re(B,h),B.width=B.width||(n.width>>G)-E,B.height=B.height||(n.height>>G)-g,i(n.type===B.type&&n.format===B.format&&n.internalformat===B.internalformat,"incompatible format for texture.subimage"),i(E>=0&&g>=0&&E+B.width<=n.width&&g+B.height<=n.height,"texture.subimage write out of bounds"),i(n.mipmask&1<<G,"missing mipmap data"),i(B.data||B.element||B.needsCopy,"missing image data"),lr(n),Ce(B,Kt+m,E,g,G),Ue(),oe(B),p}function v(m){var h=m|0;if(h!==n.width){p.width=n.width=h,p.height=n.height=h,lr(n);for(var o=0;o<6;++o)for(var l=0;n.mipmask>>l;++l)r.texImage2D(Kt+o,l,n.format,h>>l,h>>l,0,n.format,n.type,null);return Ue(),P.profile&&(n.stats.size=an(n.internalformat,n.type,p.width,p.height,!1,!0)),p}}return p(c,R,A,le,Ge,f),p.subimage=b,p.resize=v,p._reglType="textureCube",p._texture=n,P.profile&&(p.stats=n.stats),p.destroy=function(){n.decRef()},p}function Ze(){for(var c=0;c<cr;++c)r.activeTexture(Pt+c),r.bindTexture(Cr,null),Qe[c]=null;Er(fr).forEach(Ee),S.cubeCount=0,S.textureCount=0}P.profile&&(S.getTotalTextureSize=function(){var c=0;return Object.keys(fr).forEach(function(R){c+=fr[R].stats.size}),c});function Pr(){for(var c=0;c<cr;++c){var R=Qe[c];R&&(R.bindCount=0,R.unit=-1,Qe[c]=null)}Er(fr).forEach(function(A){A.texture=r.createTexture(),r.bindTexture(A.target,A.texture);for(var le=0;le<32;++le)if((A.mipmask&1<<le)!==0)if(A.target===Cr)r.texImage2D(Cr,le,A.internalformat,A.width>>le,A.height>>le,0,A.internalformat,A.type,null);else for(var Ge=0;Ge<6;++Ge)r.texImage2D(Kt+Ge,le,A.internalformat,A.width>>le,A.height>>le,0,A.internalformat,A.type,null);nr(A.texInfo,A.target)})}function nt(){for(var c=0;c<cr;++c){var R=Qe[c];R&&(R.bindCount=0,R.unit=-1,Qe[c]=null),r.activeTexture(Pt+c),r.bindTexture(Cr,null),r.bindTexture(Bn,null)}}return{create2D:Ie,createCube:ze,clear:Ze,getTexture:function(c){return null},restore:Pr,refresh:nt}}var Mr=36161,fn=32854,bf=32855,gf=36194,_f=33189,xf=36168,Ef=34041,Af=35907,Tf=34836,Sf=34842,wf=34843,Rr=[];Rr[fn]=2,Rr[bf]=2,Rr[gf]=2,Rr[_f]=2,Rr[xf]=1,Rr[Ef]=4,Rr[Af]=4,Rr[Tf]=16,Rr[Sf]=8,Rr[wf]=6;function Rf(r,a,u){return Rr[r]*a*u}var Pl=function(r,a,u,w,N){var S={rgba4:fn,rgb565:gf,"rgb5 a1":bf,depth:_f,stencil:xf,"depth stencil":Ef};a.ext_srgb&&(S.srgba=Af),a.ext_color_buffer_half_float&&(S.rgba16f=Sf,S.rgb16f=wf),a.webgl_color_buffer_float&&(S.rgba32f=Tf);var P=[];Object.keys(S).forEach(function(V){var H=S[V];P[H]=V});var $=0,U={};function X(V){this.id=$++,this.refCount=1,this.renderbuffer=V,this.format=fn,this.width=0,this.height=0,N.profile&&(this.stats={size:0})}X.prototype.decRef=function(){--this.refCount<=0&&Q(this)};function Q(V){var H=V.renderbuffer;i(H,"must not double destroy renderbuffer"),r.bindRenderbuffer(Mr,null),r.deleteRenderbuffer(H),V.renderbuffer=null,V.refCount=0,delete U[V.id],w.renderbufferCount--}function W(V,H){var y=new X(r.createRenderbuffer());U[y.id]=y,w.renderbufferCount++;function O(se,z){var fe=0,ae=0,_e=fn;if(typeof se=="object"&&se){var k=se;if("shape"in k){var I=k.shape;i(Array.isArray(I)&&I.length>=2,"invalid renderbuffer shape"),fe=I[0]|0,ae=I[1]|0}else"radius"in k&&(fe=ae=k.radius|0),"width"in k&&(fe=k.width|0),"height"in k&&(ae=k.height|0);"format"in k&&(i.parameter(k.format,S,"invalid renderbuffer format"),_e=S[k.format])}else typeof se=="number"?(fe=se|0,typeof z=="number"?ae=z|0:ae=fe):se?i.raise("invalid arguments to renderbuffer constructor"):fe=ae=1;if(i(fe>0&&ae>0&&fe<=u.maxRenderbufferSize&&ae<=u.maxRenderbufferSize,"invalid renderbuffer size"),!(fe===y.width&&ae===y.height&&_e===y.format))return O.width=y.width=fe,O.height=y.height=ae,y.format=_e,r.bindRenderbuffer(Mr,y.renderbuffer),r.renderbufferStorage(Mr,_e,fe,ae),i(r.getError()===0,"invalid render buffer format"),N.profile&&(y.stats.size=Rf(y.format,y.width,y.height)),O.format=P[y.format],O}function j(se,z){var fe=se|0,ae=z|0||fe;return fe===y.width&&ae===y.height||(i(fe>0&&ae>0&&fe<=u.maxRenderbufferSize&&ae<=u.maxRenderbufferSize,"invalid renderbuffer size"),O.width=y.width=fe,O.height=y.height=ae,r.bindRenderbuffer(Mr,y.renderbuffer),r.renderbufferStorage(Mr,y.format,fe,ae),i(r.getError()===0,"invalid render buffer format"),N.profile&&(y.stats.size=Rf(y.format,y.width,y.height))),O}return O(V,H),O.resize=j,O._reglType="renderbuffer",O._renderbuffer=y,N.profile&&(O.stats=y.stats),O.destroy=function(){y.decRef()},O}N.profile&&(w.getTotalRenderbufferSize=function(){var V=0;return Object.keys(U).forEach(function(H){V+=U[H].stats.size}),V});function J(){Er(U).forEach(function(V){V.renderbuffer=r.createRenderbuffer(),r.bindRenderbuffer(Mr,V.renderbuffer),r.renderbufferStorage(Mr,V.format,V.width,V.height)}),r.bindRenderbuffer(Mr,null)}return{create:W,clear:function(){Er(U).forEach(Q)},restore:J}},Dr=36160,ra=36161,Zr=3553,on=34069,Lf=36064,Cf=36096,Of=36128,Pf=33306,Ff=36053,Fl=36054,Gl=36055,Dl=36057,Il=36061,Nl=36193,kl=5121,Bl=5126,Gf=6407,Df=6408,Ml=6402,zl=[Gf,Df],ta=[];ta[Df]=4,ta[Gf]=3;var sn=[];sn[kl]=1,sn[Bl]=4,sn[Nl]=2;var Ul=32854,$l=32855,Vl=36194,ql=33189,jl=36168,If=34041,Hl=35907,Xl=34836,Wl=34842,Yl=34843,Ql=[Ul,$l,Vl,Hl,Wl,Yl,Xl],ht={};ht[Ff]="complete",ht[Fl]="incomplete attachment",ht[Dl]="incomplete dimensions",ht[Gl]="incomplete, missing attachment",ht[Il]="unsupported";function Zl(r,a,u,w,N,S){var P={cur:null,next:null,dirty:!1,setFBO:null},$=["rgba"],U=["rgba4","rgb565","rgb5 a1"];a.ext_srgb&&U.push("srgba"),a.ext_color_buffer_half_float&&U.push("rgba16f","rgb16f"),a.webgl_color_buffer_float&&U.push("rgba32f");var X=["uint8"];a.oes_texture_half_float&&X.push("half float","float16"),a.oes_texture_float&&X.push("float","float32");function Q(q,re,te){this.target=q,this.texture=re,this.renderbuffer=te;var Ce=0,Le=0;re?(Ce=re.width,Le=re.height):te&&(Ce=te.width,Le=te.height),this.width=Ce,this.height=Le}function W(q){q&&(q.texture&&q.texture._texture.decRef(),q.renderbuffer&&q.renderbuffer._renderbuffer.decRef())}function J(q,re,te){if(q)if(q.texture){var Ce=q.texture._texture,Le=Math.max(1,Ce.width),ie=Math.max(1,Ce.height);i(Le===re&&ie===te,"inconsistent width/height for supplied texture"),Ce.refCount+=1}else{var oe=q.renderbuffer._renderbuffer;i(oe.width===re&&oe.height===te,"inconsistent width/height for renderbuffer"),oe.refCount+=1}}function V(q,re){re&&(re.texture?r.framebufferTexture2D(Dr,q,re.target,re.texture._texture.texture,0):r.framebufferRenderbuffer(Dr,q,ra,re.renderbuffer._renderbuffer.renderbuffer))}function H(q){var re=Zr,te=null,Ce=null,Le=q;typeof q=="object"&&(Le=q.data,"target"in q&&(re=q.target|0)),i.type(Le,"function","invalid attachment data");var ie=Le._reglType;return ie==="texture2d"?(te=Le,i(re===Zr)):ie==="textureCube"?(te=Le,i(re>=on&&re<on+6,"invalid cube map target")):ie==="renderbuffer"?(Ce=Le,re=ra):i.raise("invalid regl object for attachment"),new Q(re,te,Ce)}function y(q,re,te,Ce,Le){if(te){var ie=w.create2D({width:q,height:re,format:Ce,type:Le});return ie._texture.refCount=0,new Q(Zr,ie,null)}else{var oe=N.create({width:q,height:re,format:Ce});return oe._renderbuffer.refCount=0,new Q(ra,null,oe)}}function O(q){return q&&(q.texture||q.renderbuffer)}function j(q,re,te){q&&(q.texture?q.texture.resize(re,te):q.renderbuffer&&q.renderbuffer.resize(re,te),q.width=re,q.height=te)}var se=0,z={};function fe(){this.id=se++,z[this.id]=this,this.framebuffer=r.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ae(q){q.colorAttachments.forEach(W),W(q.depthAttachment),W(q.stencilAttachment),W(q.depthStencilAttachment)}function _e(q){var re=q.framebuffer;i(re,"must not double destroy framebuffer"),r.deleteFramebuffer(re),q.framebuffer=null,S.framebufferCount--,delete z[q.id]}function k(q){var re;r.bindFramebuffer(Dr,q.framebuffer);var te=q.colorAttachments;for(re=0;re<te.length;++re)V(Lf+re,te[re]);for(re=te.length;re<u.maxColorAttachments;++re)r.framebufferTexture2D(Dr,Lf+re,Zr,null,0);r.framebufferTexture2D(Dr,Pf,Zr,null,0),r.framebufferTexture2D(Dr,Cf,Zr,null,0),r.framebufferTexture2D(Dr,Of,Zr,null,0),V(Cf,q.depthAttachment),V(Of,q.stencilAttachment),V(Pf,q.depthStencilAttachment);var Ce=r.checkFramebufferStatus(Dr);!r.isContextLost()&&Ce!==Ff&&i.raise("framebuffer configuration not supported, status = "+ht[Ce]),r.bindFramebuffer(Dr,P.next?P.next.framebuffer:null),P.cur=P.next,r.getError()}function I(q,re){var te=new fe;S.framebufferCount++;function Ce(ie,oe){var Ae;i(P.next!==te,"can not update framebuffer which is currently in use");var Oe=0,De=0,Xe=!0,We=!0,Ne=null,tr=!0,qe="rgba",er="uint8",nr=1,ar=null,fr=null,cr=null,Qe=!1;if(typeof ie=="number")Oe=ie|0,De=oe|0||Oe;else if(!ie)Oe=De=1;else{i.type(ie,"object","invalid arguments for framebuffer");var Pe=ie;if("shape"in Pe){var lr=Pe.shape;i(Array.isArray(lr)&&lr.length>=2,"invalid shape for framebuffer"),Oe=lr[0],De=lr[1]}else"radius"in Pe&&(Oe=De=Pe.radius),"width"in Pe&&(Oe=Pe.width),"height"in Pe&&(De=Pe.height);("color"in Pe||"colors"in Pe)&&(Ne=Pe.color||Pe.colors,Array.isArray(Ne)&&i(Ne.length===1||a.webgl_draw_buffers,"multiple render targets not supported")),Ne||("colorCount"in Pe&&(nr=Pe.colorCount|0,i(nr>0,"invalid color buffer count")),"colorTexture"in Pe&&(tr=!!Pe.colorTexture,qe="rgba4"),"colorType"in Pe&&(er=Pe.colorType,tr?(i(a.oes_texture_float||!(er==="float"||er==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),i(a.oes_texture_half_float||!(er==="half float"||er==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):er==="half float"||er==="float16"?(i(a.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),qe="rgba16f"):(er==="float"||er==="float32")&&(i(a.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),qe="rgba32f"),i.oneOf(er,X,"invalid color type")),"colorFormat"in Pe&&(qe=Pe.colorFormat,$.indexOf(qe)>=0?tr=!0:U.indexOf(qe)>=0?tr=!1:i.optional(function(){tr?i.oneOf(Pe.colorFormat,$,"invalid color format for texture"):i.oneOf(Pe.colorFormat,U,"invalid color format for renderbuffer")}))),("depthTexture"in Pe||"depthStencilTexture"in Pe)&&(Qe=!!(Pe.depthTexture||Pe.depthStencilTexture),i(!Qe||a.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Pe&&(typeof Pe.depth=="boolean"?Xe=Pe.depth:(ar=Pe.depth,We=!1)),"stencil"in Pe&&(typeof Pe.stencil=="boolean"?We=Pe.stencil:(fr=Pe.stencil,Xe=!1)),"depthStencil"in Pe&&(typeof Pe.depthStencil=="boolean"?Xe=We=Pe.depthStencil:(cr=Pe.depthStencil,Xe=!1,We=!1))}var Ue=null,Ee=null,Ie=null,ze=null;if(Array.isArray(Ne))Ue=Ne.map(H);else if(Ne)Ue=[H(Ne)];else for(Ue=new Array(nr),Ae=0;Ae<nr;++Ae)Ue[Ae]=y(Oe,De,tr,qe,er);i(a.webgl_draw_buffers||Ue.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),i(Ue.length<=u.maxColorAttachments,"too many color attachments, not supported"),Oe=Oe||Ue[0].width,De=De||Ue[0].height,ar?Ee=H(ar):Xe&&!We&&(Ee=y(Oe,De,Qe,"depth","uint32")),fr?Ie=H(fr):We&&!Xe&&(Ie=y(Oe,De,!1,"stencil","uint8")),cr?ze=H(cr):!ar&&!fr&&We&&Xe&&(ze=y(Oe,De,Qe,"depth stencil","depth stencil")),i(!!ar+!!fr+!!cr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ze=null;for(Ae=0;Ae<Ue.length;++Ae)if(J(Ue[Ae],Oe,De),i(!Ue[Ae]||Ue[Ae].texture&&zl.indexOf(Ue[Ae].texture._texture.format)>=0||Ue[Ae].renderbuffer&&Ql.indexOf(Ue[Ae].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ae+" is invalid"),Ue[Ae]&&Ue[Ae].texture){var Pr=ta[Ue[Ae].texture._texture.format]*sn[Ue[Ae].texture._texture.type];Ze===null?Ze=Pr:i(Ze===Pr,"all color attachments much have the same number of bits per pixel.")}return J(Ee,Oe,De),i(!Ee||Ee.texture&&Ee.texture._texture.format===Ml||Ee.renderbuffer&&Ee.renderbuffer._renderbuffer.format===ql,"invalid depth attachment for framebuffer object"),J(Ie,Oe,De),i(!Ie||Ie.renderbuffer&&Ie.renderbuffer._renderbuffer.format===jl,"invalid stencil attachment for framebuffer object"),J(ze,Oe,De),i(!ze||ze.texture&&ze.texture._texture.format===If||ze.renderbuffer&&ze.renderbuffer._renderbuffer.format===If,"invalid depth-stencil attachment for framebuffer object"),ae(te),te.width=Oe,te.height=De,te.colorAttachments=Ue,te.depthAttachment=Ee,te.stencilAttachment=Ie,te.depthStencilAttachment=ze,Ce.color=Ue.map(O),Ce.depth=O(Ee),Ce.stencil=O(Ie),Ce.depthStencil=O(ze),Ce.width=te.width,Ce.height=te.height,k(te),Ce}function Le(ie,oe){i(P.next!==te,"can not resize a framebuffer which is currently in use");var Ae=Math.max(ie|0,1),Oe=Math.max(oe|0||Ae,1);if(Ae===te.width&&Oe===te.height)return Ce;for(var De=te.colorAttachments,Xe=0;Xe<De.length;++Xe)j(De[Xe],Ae,Oe);return j(te.depthAttachment,Ae,Oe),j(te.stencilAttachment,Ae,Oe),j(te.depthStencilAttachment,Ae,Oe),te.width=Ce.width=Ae,te.height=Ce.height=Oe,k(te),Ce}return Ce(q,re),x(Ce,{resize:Le,_reglType:"framebuffer",_framebuffer:te,destroy:function(){_e(te),ae(te)},use:function(ie){P.setFBO({framebuffer:Ce},ie)}})}function ue(q){var re=Array(6);function te(Le){var ie;i(re.indexOf(P.next)<0,"can not update framebuffer which is currently in use");var oe={color:null},Ae=0,Oe=null,De="rgba",Xe="uint8",We=1;if(typeof Le=="number")Ae=Le|0;else if(!Le)Ae=1;else{i.type(Le,"object","invalid arguments for framebuffer");var Ne=Le;if("shape"in Ne){var tr=Ne.shape;i(Array.isArray(tr)&&tr.length>=2,"invalid shape for framebuffer"),i(tr[0]===tr[1],"cube framebuffer must be square"),Ae=tr[0]}else"radius"in Ne&&(Ae=Ne.radius|0),"width"in Ne?(Ae=Ne.width|0,"height"in Ne&&i(Ne.height===Ae,"must be square")):"height"in Ne&&(Ae=Ne.height|0);("color"in Ne||"colors"in Ne)&&(Oe=Ne.color||Ne.colors,Array.isArray(Oe)&&i(Oe.length===1||a.webgl_draw_buffers,"multiple render targets not supported")),Oe||("colorCount"in Ne&&(We=Ne.colorCount|0,i(We>0,"invalid color buffer count")),"colorType"in Ne&&(i.oneOf(Ne.colorType,X,"invalid color type"),Xe=Ne.colorType),"colorFormat"in Ne&&(De=Ne.colorFormat,i.oneOf(Ne.colorFormat,$,"invalid color format for texture"))),"depth"in Ne&&(oe.depth=Ne.depth),"stencil"in Ne&&(oe.stencil=Ne.stencil),"depthStencil"in Ne&&(oe.depthStencil=Ne.depthStencil)}var qe;if(Oe)if(Array.isArray(Oe))for(qe=[],ie=0;ie<Oe.length;++ie)qe[ie]=Oe[ie];else qe=[Oe];else{qe=Array(We);var er={radius:Ae,format:De,type:Xe};for(ie=0;ie<We;++ie)qe[ie]=w.createCube(er)}for(oe.color=Array(qe.length),ie=0;ie<qe.length;++ie){var nr=qe[ie];i(typeof nr=="function"&&nr._reglType==="textureCube","invalid cube map"),Ae=Ae||nr.width,i(nr.width===Ae&&nr.height===Ae,"invalid cube map shape"),oe.color[ie]={target:on,data:qe[ie]}}for(ie=0;ie<6;++ie){for(var ar=0;ar<qe.length;++ar)oe.color[ar].target=on+ie;ie>0&&(oe.depth=re[0].depth,oe.stencil=re[0].stencil,oe.depthStencil=re[0].depthStencil),re[ie]?re[ie](oe):re[ie]=I(oe)}return x(te,{width:Ae,height:Ae,color:qe})}function Ce(Le){var ie,oe=Le|0;if(i(oe>0&&oe<=u.maxCubeMapSize,"invalid radius for cube fbo"),oe===te.width)return te;var Ae=te.color;for(ie=0;ie<Ae.length;++ie)Ae[ie].resize(oe);for(ie=0;ie<6;++ie)re[ie].resize(oe);return te.width=te.height=oe,te}return te(q),x(te,{faces:re,resize:Ce,_reglType:"framebufferCube",destroy:function(){re.forEach(function(Le){Le.destroy()})}})}function ee(){P.cur=null,P.next=null,P.dirty=!0,Er(z).forEach(function(q){q.framebuffer=r.createFramebuffer(),k(q)})}return x(P,{getFramebuffer:function(q){if(typeof q=="function"&&q._reglType==="framebuffer"){var re=q._framebuffer;if(re instanceof fe)return re}return null},create:I,createCube:ue,clear:function(){Er(z).forEach(_e)},restore:ee})}var Kl=5126,Nf=34962,cn=34963,kf=["attributes","elements","offset","count","primitive","instances"];function na(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Kl,this.offset=0,this.stride=0,this.divisor=0}function Jl(r,a,u,w,N,S,P){for(var $=u.maxAttributes,U=new Array($),X=0;X<$;++X)U[X]=new na;var Q=0,W={},J={Record:na,scope:{},state:U,currentVAO:null,targetVAO:null,restore:H()?ae:function(){},createVAO:_e,getVAO:O,destroyBuffer:V,setVAO:H()?j:se,clear:H()?z:function(){}};function V(k){for(var I=0;I<U.length;++I){var ue=U[I];ue.buffer===k&&(r.disableVertexAttribArray(I),ue.buffer=null)}}function H(){return a.oes_vertex_array_object}function y(){return a.angle_instanced_arrays}function O(k){return typeof k=="function"&&k._vao?k._vao:null}function j(k){if(k!==J.currentVAO){var I=H();k?I.bindVertexArrayOES(k.vao):I.bindVertexArrayOES(null),J.currentVAO=k}}function se(k){if(k!==J.currentVAO){if(k)k.bindAttrs();else{for(var I=y(),ue=0;ue<U.length;++ue){var ee=U[ue];ee.buffer?(r.enableVertexAttribArray(ue),ee.buffer.bind(),r.vertexAttribPointer(ue,ee.size,ee.type,ee.normalized,ee.stride,ee.offfset),I&&ee.divisor&&I.vertexAttribDivisorANGLE(ue,ee.divisor)):(r.disableVertexAttribArray(ue),r.vertexAttrib4f(ue,ee.x,ee.y,ee.z,ee.w))}P.elements?r.bindBuffer(cn,P.elements.buffer.buffer):r.bindBuffer(cn,null)}J.currentVAO=k}}function z(){Er(W).forEach(function(k){k.destroy()})}function fe(){this.id=++Q,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var k=H();k?this.vao=k.createVertexArrayOES():this.vao=null,W[this.id]=this,this.buffers=[]}fe.prototype.bindAttrs=function(){for(var k=y(),I=this.attributes,ue=0;ue<I.length;++ue){var ee=I[ue];ee.buffer?(r.enableVertexAttribArray(ue),r.bindBuffer(Nf,ee.buffer.buffer),r.vertexAttribPointer(ue,ee.size,ee.type,ee.normalized,ee.stride,ee.offset),k&&ee.divisor&&k.vertexAttribDivisorANGLE(ue,ee.divisor)):(r.disableVertexAttribArray(ue),r.vertexAttrib4f(ue,ee.x,ee.y,ee.z,ee.w))}for(var q=I.length;q<$;++q)r.disableVertexAttribArray(q);var re=S.getElements(this.elements);re?r.bindBuffer(cn,re.buffer.buffer):r.bindBuffer(cn,null)},fe.prototype.refresh=function(){var k=H();k&&(k.bindVertexArrayOES(this.vao),this.bindAttrs(),J.currentVAO=null,k.bindVertexArrayOES(null))},fe.prototype.destroy=function(){if(this.vao){var k=H();this===J.currentVAO&&(J.currentVAO=null,k.bindVertexArrayOES(null)),k.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),W[this.id]&&(delete W[this.id],w.vaoCount-=1)};function ae(){var k=H();k&&Er(W).forEach(function(I){I.refresh()})}function _e(k){var I=new fe;w.vaoCount+=1;function ue(ee){var q;if(Array.isArray(ee))q=ee,I.elements&&I.ownsElements&&I.elements.destroy(),I.elements=null,I.ownsElements=!1,I.offset=0,I.count=0,I.instances=-1,I.primitive=4;else{if(i(typeof ee=="object","invalid arguments for create vao"),i("attributes"in ee,"must specify attributes for vao"),ee.elements){var re=ee.elements;I.ownsElements?typeof re=="function"&&re._reglType==="elements"?(I.elements.destroy(),I.ownsElements=!1):(I.elements(re),I.ownsElements=!1):S.getElements(ee.elements)?(I.elements=ee.elements,I.ownsElements=!1):(I.elements=S.create(ee.elements),I.ownsElements=!0)}else I.elements=null,I.ownsElements=!1;q=ee.attributes,I.offset=0,I.count=-1,I.instances=-1,I.primitive=4,I.elements&&(I.count=I.elements._elements.vertCount,I.primitive=I.elements._elements.primType),"offset"in ee&&(I.offset=ee.offset|0),"count"in ee&&(I.count=ee.count|0),"instances"in ee&&(I.instances=ee.instances|0),"primitive"in ee&&(i(ee.primitive in Br,"bad primitive type: "+ee.primitive),I.primitive=Br[ee.primitive]),i.optional(()=>{for(var Xe=Object.keys(ee),We=0;We<Xe.length;++We)i(kf.indexOf(Xe[We])>=0,'invalid option for vao: "'+Xe[We]+'" valid options are '+kf)}),i(Array.isArray(q),"attributes must be an array")}i(q.length<$,"too many attributes"),i(q.length>0,"must specify at least one attribute");var te={},Ce=I.attributes;Ce.length=q.length;for(var Le=0;Le<q.length;++Le){var ie=q[Le],oe=Ce[Le]=new na,Ae=ie.data||ie;if(Array.isArray(Ae)||t(Ae)||wr(Ae)){var Oe;I.buffers[Le]&&(Oe=I.buffers[Le],t(Ae)&&Oe._buffer.byteLength>=Ae.byteLength?Oe.subdata(Ae):(Oe.destroy(),I.buffers[Le]=null)),I.buffers[Le]||(Oe=I.buffers[Le]=N.create(ie,Nf,!1,!0)),oe.buffer=N.getBuffer(Oe),oe.size=oe.buffer.dimension|0,oe.normalized=!1,oe.type=oe.buffer.dtype,oe.offset=0,oe.stride=0,oe.divisor=0,oe.state=1,te[Le]=1}else N.getBuffer(ie)?(oe.buffer=N.getBuffer(ie),oe.size=oe.buffer.dimension|0,oe.normalized=!1,oe.type=oe.buffer.dtype,oe.offset=0,oe.stride=0,oe.divisor=0,oe.state=1):N.getBuffer(ie.buffer)?(oe.buffer=N.getBuffer(ie.buffer),oe.size=(+ie.size||oe.buffer.dimension)|0,oe.normalized=!!ie.normalized||!1,"type"in ie?(i.parameter(ie.type,Xr,"invalid buffer type"),oe.type=Xr[ie.type]):oe.type=oe.buffer.dtype,oe.offset=(ie.offset||0)|0,oe.stride=(ie.stride||0)|0,oe.divisor=(ie.divisor||0)|0,oe.state=1,i(oe.size>=1&&oe.size<=4,"size must be between 1 and 4"),i(oe.offset>=0,"invalid offset"),i(oe.stride>=0&&oe.stride<=255,"stride must be between 0 and 255"),i(oe.divisor>=0,"divisor must be positive"),i(!oe.divisor||!!a.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ie?(i(Le>0,"first attribute must not be a constant"),oe.x=+ie.x||0,oe.y=+ie.y||0,oe.z=+ie.z||0,oe.w=+ie.w||0,oe.state=2):i(!1,"invalid attribute spec for location "+Le)}for(var De=0;De<I.buffers.length;++De)!te[De]&&I.buffers[De]&&(I.buffers[De].destroy(),I.buffers[De]=null);return I.refresh(),ue}return ue.destroy=function(){for(var ee=0;ee<I.buffers.length;++ee)I.buffers[ee]&&I.buffers[ee].destroy();I.buffers.length=0,I.ownsElements&&(I.elements.destroy(),I.elements=null,I.ownsElements=!1),I.destroy()},ue._vao=I,ue._reglType="vao",ue(k)}return J}var Bf=35632,eu=35633,ru=35718,tu=35721;function nu(r,a,u,w){var N={},S={};function P(y,O,j,se){this.name=y,this.id=O,this.location=j,this.info=se}function $(y,O){for(var j=0;j<y.length;++j)if(y[j].id===O.id){y[j].location=O.location;return}y.push(O)}function U(y,O,j){var se=y===Bf?N:S,z=se[O];if(!z){var fe=a.str(O);z=r.createShader(y),r.shaderSource(z,fe),r.compileShader(z),i.shaderError(r,z,fe,y,j),se[O]=z}return z}var X={},Q=[],W=0;function J(y,O){this.id=W++,this.fragId=y,this.vertId=O,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,w.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function V(y,O,j){var se,z,fe=U(Bf,y.fragId),ae=U(eu,y.vertId),_e=y.program=r.createProgram();if(r.attachShader(_e,fe),r.attachShader(_e,ae),j)for(se=0;se<j.length;++se){var k=j[se];r.bindAttribLocation(_e,k[0],k[1])}r.linkProgram(_e),i.linkError(r,_e,a.str(y.fragId),a.str(y.vertId),O);var I=r.getProgramParameter(_e,ru);w.profile&&(y.stats.uniformsCount=I);var ue=y.uniforms;for(se=0;se<I;++se)if(z=r.getActiveUniform(_e,se),z){if(z.size>1)for(var ee=0;ee<z.size;++ee){var q=z.name.replace("[0]","["+ee+"]");$(ue,new P(q,a.id(q),r.getUniformLocation(_e,q),z))}var re=z.name;z.size>1&&(re=re.replace("[0]","")),$(ue,new P(re,a.id(re),r.getUniformLocation(_e,re),z))}var te=r.getProgramParameter(_e,tu);w.profile&&(y.stats.attributesCount=te);var Ce=y.attributes;for(se=0;se<te;++se)z=r.getActiveAttrib(_e,se),z&&$(Ce,new P(z.name,a.id(z.name),r.getAttribLocation(_e,z.name),z))}w.profile&&(u.getMaxUniformsCount=function(){var y=0;return Q.forEach(function(O){O.stats.uniformsCount>y&&(y=O.stats.uniformsCount)}),y},u.getMaxAttributesCount=function(){var y=0;return Q.forEach(function(O){O.stats.attributesCount>y&&(y=O.stats.attributesCount)}),y});function H(){N={},S={};for(var y=0;y<Q.length;++y)V(Q[y],null,Q[y].attributes.map(function(O){return[O.location,O.name]}))}return{clear:function(){var y=r.deleteShader.bind(r);Er(N).forEach(y),N={},Er(S).forEach(y),S={},Q.forEach(function(O){r.deleteProgram(O.program)}),Q.length=0,X={},u.shaderCount=0},program:function(y,O,j,se){i.command(y>=0,"missing vertex shader",j),i.command(O>=0,"missing fragment shader",j);var z=X[O];z||(z=X[O]={});var fe=z[y];if(fe&&(fe.refCount++,!se))return fe;var ae=new J(O,y);return u.shaderCount++,V(ae,j,se),fe||(z[y]=ae),Q.push(ae),x(ae,{destroy:function(){if(ae.refCount--,ae.refCount<=0){r.deleteProgram(ae.program);var _e=Q.indexOf(ae);Q.splice(_e,1),u.shaderCount--}z[ae.vertId].refCount<=0&&(r.deleteShader(S[ae.vertId]),delete S[ae.vertId],delete X[ae.fragId][ae.vertId]),Object.keys(X[ae.fragId]).length||(r.deleteShader(N[ae.fragId]),delete N[ae.fragId],delete X[ae.fragId])}})},restore:H,shader:U,frag:-1,vert:-1}}var au=6408,Ft=5121,iu=3333,ln=5126;function fu(r,a,u,w,N,S,P){function $(Q){var W;a.next===null?(i(N.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),W=Ft):(i(a.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),W=a.next.colorAttachments[0].texture._texture.type,i.optional(function(){S.oes_texture_float?(i(W===Ft||W===ln,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),W===ln&&i(P.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):i(W===Ft,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var J=0,V=0,H=w.framebufferWidth,y=w.framebufferHeight,O=null;t(Q)?O=Q:Q&&(i.type(Q,"object","invalid arguments to regl.read()"),J=Q.x|0,V=Q.y|0,i(J>=0&&J<w.framebufferWidth,"invalid x offset for regl.read"),i(V>=0&&V<w.framebufferHeight,"invalid y offset for regl.read"),H=(Q.width||w.framebufferWidth-J)|0,y=(Q.height||w.framebufferHeight-V)|0,O=Q.data||null),O&&(W===Ft?i(O instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):W===ln&&i(O instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),i(H>0&&H+J<=w.framebufferWidth,"invalid width for read pixels"),i(y>0&&y+V<=w.framebufferHeight,"invalid height for read pixels"),u();var j=H*y*4;return O||(W===Ft?O=new Uint8Array(j):W===ln&&(O=O||new Float32Array(j))),i.isTypedArray(O,"data buffer for regl.read() must be a typedarray"),i(O.byteLength>=j,"data buffer for regl.read() too small"),r.pixelStorei(iu,4),r.readPixels(J,V,H,y,au,W,O),O}function U(Q){var W;return a.setFBO({framebuffer:Q.framebuffer},function(){W=$(Q)}),W}function X(Q){return!Q||!("framebuffer"in Q)?$(Q):U(Q)}return X}function pt(r){return Array.prototype.slice.call(r)}function yt(r){return pt(r).join("")}function ou(){var r=0,a=[],u=[];function w(W){for(var J=0;J<u.length;++J)if(u[J]===W)return a[J];var V="g"+r++;return a.push(V),u.push(W),V}function N(){var W=[];function J(){W.push.apply(W,pt(arguments))}var V=[];function H(){var y="v"+r++;return V.push(y),arguments.length>0&&(W.push(y,"="),W.push.apply(W,pt(arguments)),W.push(";")),y}return x(J,{def:H,toString:function(){return yt([V.length>0?"var "+V.join(",")+";":"",yt(W)])}})}function S(){var W=N(),J=N(),V=W.toString,H=J.toString;function y(O,j){J(O,j,"=",W.def(O,j),";")}return x(function(){W.apply(W,pt(arguments))},{def:W.def,entry:W,exit:J,save:y,set:function(O,j,se){y(O,j),W(O,j,"=",se,";")},toString:function(){return V()+H()}})}function P(){var W=yt(arguments),J=S(),V=S(),H=J.toString,y=V.toString;return x(J,{then:function(){return J.apply(J,pt(arguments)),this},else:function(){return V.apply(V,pt(arguments)),this},toString:function(){var O=y();return O&&(O="else{"+O+"}"),yt(["if(",W,"){",H(),"}",O])}})}var $=N(),U={};function X(W,J){var V=[];function H(){var z="a"+V.length;return V.push(z),z}J=J||0;for(var y=0;y<J;++y)H();var O=S(),j=O.toString,se=U[W]=x(O,{arg:H,toString:function(){return yt(["function(",V.join(),"){",j(),"}"])}});return se}function Q(){var W=['"use strict";',$,"return {"];Object.keys(U).forEach(function(H){W.push('"',H,'":',U[H].toString(),",")}),W.push("}");var J=yt(W).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),V=Function.apply(null,a.concat(J));return V.apply(null,u)}return{global:$,link:w,block:N,proc:X,scope:S,cond:P,compile:Q}}var bt="xyzw".split(""),Mf=5121,gt=1,aa=2,ia=0,fa=1,oa=2,sa=3,un=4,zf=5,Uf=6,$f="dither",Vf="blend.enable",qf="blend.color",ca="blend.equation",la="blend.func",jf="depth.enable",Hf="depth.func",Xf="depth.range",Wf="depth.mask",ua="colorMask",Yf="cull.enable",Qf="cull.face",da="frontFace",ma="lineWidth",Zf="polygonOffset.enable",va="polygonOffset.offset",Kf="sample.alpha",Jf="sample.enable",ha="sample.coverage",eo="stencil.enable",ro="stencil.mask",pa="stencil.func",ya="stencil.opFront",Gt="stencil.opBack",to="scissor.enable",dn="scissor.box",Ir="viewport",Dt="profile",Kr="framebuffer",It="vert",Nt="frag",Jr="elements",et="primitive",rt="count",mn="offset",vn="instances",kt="vao",ba="Width",ga="Height",_t=Kr+ba,xt=Kr+ga,su=Ir+ba,cu=Ir+ga,no="drawingBuffer",ao=no+ba,io=no+ga,lu=[la,ca,pa,ya,Gt,ha,Ir,dn,va],Et=34962,_a=34963,uu=35632,du=35633,fo=3553,mu=34067,vu=2884,hu=3042,pu=3024,yu=2960,bu=2929,gu=3089,_u=32823,xu=32926,Eu=32928,xa=5126,hn=35664,pn=35665,yn=35666,Ea=5124,bn=35667,gn=35668,_n=35669,Aa=35670,xn=35671,En=35672,An=35673,Bt=35674,Mt=35675,zt=35676,Ut=35678,$t=35680,Ta=4,Vt=1028,tt=1029,oo=2304,Sa=2305,Au=32775,Tu=32776,Su=519,zr=7680,so=0,co=1,lo=32774,wu=513,uo=36160,Ru=36064,Or={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},mo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],At={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ur={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},vo={frag:uu,vert:du},wa={cw:oo,ccw:Sa};function Tn(r){return Array.isArray(r)||t(r)||wr(r)}function ho(r){return r.sort(function(a,u){return a===Ir?-1:u===Ir?1:a<u?-1:1})}function ir(r,a,u,w){this.thisDep=r,this.contextDep=a,this.propDep=u,this.append=w}function $r(r){return r&&!(r.thisDep||r.contextDep||r.propDep)}function Je(r){return new ir(!1,!1,!1,r)}function yr(r,a){var u=r.type;if(u===ia){var w=r.data.length;return new ir(!0,w>=1,w>=2,a)}else if(u===un){var N=r.data;return new ir(N.thisDep,N.contextDep,N.propDep,a)}else{if(u===zf)return new ir(!1,!1,!1,a);if(u===Uf){for(var S=!1,P=!1,$=!1,U=0;U<r.data.length;++U){var X=r.data[U];if(X.type===fa)$=!0;else if(X.type===oa)P=!0;else if(X.type===sa)S=!0;else if(X.type===ia){S=!0;var Q=X.data;Q>=1&&(P=!0),Q>=2&&($=!0)}else X.type===un&&(S=S||X.data.thisDep,P=P||X.data.contextDep,$=$||X.data.propDep)}return new ir(S,P,$,a)}else return new ir(u===sa,u===oa,u===fa,a)}}var po=new ir(!1,!1,!1,function(){});function Lu(r,a,u,w,N,S,P,$,U,X,Q,W,J,V,H){var y=X.Record,O={add:32774,subtract:32778,"reverse subtract":32779};u.ext_blend_minmax&&(O.min=Au,O.max=Tu);var j=u.angle_instanced_arrays,se=u.webgl_draw_buffers,z=u.oes_vertex_array_object,fe={dirty:!0,profile:H.profile},ae={},_e=[],k={},I={};function ue(f){return f.replace(".","_")}function ee(f,n,d){var p=ue(f);_e.push(f),ae[p]=fe[p]=!!d,k[p]=n}function q(f,n,d){var p=ue(f);_e.push(f),Array.isArray(d)?(fe[p]=d.slice(),ae[p]=d.slice()):fe[p]=ae[p]=d,I[p]=n}ee($f,pu),ee(Vf,hu),q(qf,"blendColor",[0,0,0,0]),q(ca,"blendEquationSeparate",[lo,lo]),q(la,"blendFuncSeparate",[co,so,co,so]),ee(jf,bu,!0),q(Hf,"depthFunc",wu),q(Xf,"depthRange",[0,1]),q(Wf,"depthMask",!0),q(ua,ua,[!0,!0,!0,!0]),ee(Yf,vu),q(Qf,"cullFace",tt),q(da,da,Sa),q(ma,ma,1),ee(Zf,_u),q(va,"polygonOffset",[0,0]),ee(Kf,xu),ee(Jf,Eu),q(ha,"sampleCoverage",[1,!1]),ee(eo,yu),q(ro,"stencilMask",-1),q(pa,"stencilFunc",[Su,0,-1]),q(ya,"stencilOpSeparate",[Vt,zr,zr,zr]),q(Gt,"stencilOpSeparate",[tt,zr,zr,zr]),ee(to,gu),q(dn,"scissor",[0,0,r.drawingBufferWidth,r.drawingBufferHeight]),q(Ir,Ir,[0,0,r.drawingBufferWidth,r.drawingBufferHeight]);var re={gl:r,context:J,strings:a,next:ae,current:fe,draw:W,elements:S,buffer:N,shader:Q,attributes:X.state,vao:X,uniforms:U,framebuffer:$,extensions:u,timer:V,isBufferArgs:Tn},te={primTypes:Br,compareFuncs:At,blendFuncs:Or,blendEquations:O,stencilOps:Ur,glTypes:Xr,orientationType:wa};i.optional(function(){re.isArrayLike=He}),se&&(te.backBuffer=[tt],te.drawBuffer=xr(w.maxDrawbuffers,function(f){return f===0?[0]:xr(f,function(n){return Ru+n})}));var Ce=0;function Le(){var f=ou(),n=f.link,d=f.global;f.id=Ce++,f.batchId="0";var p=n(re),b=f.shared={props:"a0"};Object.keys(re).forEach(function(l){b[l]=d.def(p,".",l)}),i.optional(function(){f.CHECK=n(i),f.commandStr=i.guessCommand(),f.command=n(f.commandStr),f.assert=function(l,s,E){l("if(!(",s,"))",this.CHECK,".commandRaise(",n(E),",",this.command,");")},te.invalidBlendCombinations=mo});var v=f.next={},m=f.current={};Object.keys(I).forEach(function(l){Array.isArray(fe[l])&&(v[l]=d.def(b.next,".",l),m[l]=d.def(b.current,".",l))});var h=f.constants={};Object.keys(te).forEach(function(l){h[l]=d.def(JSON.stringify(te[l]))}),f.invoke=function(l,s){switch(s.type){case ia:var E=["this",b.context,b.props,f.batchId];return l.def(n(s.data),".call(",E.slice(0,Math.max(s.data.length+1,4)),")");case fa:return l.def(b.props,s.data);case oa:return l.def(b.context,s.data);case sa:return l.def("this",s.data);case un:return s.data.append(f,l),s.data.ref;case zf:return s.data.toString();case Uf:return s.data.map(function(g){return f.invoke(l,g)})}},f.attribCache={};var o={};return f.scopeAttrib=function(l){var s=a.id(l);if(s in o)return o[s];var E=X.scope[s];E||(E=X.scope[s]=new y);var g=o[s]=n(E);return g},f}function ie(f){var n=f.static,d=f.dynamic,p;if(Dt in n){var b=!!n[Dt];p=Je(function(m,h){return b}),p.enable=b}else if(Dt in d){var v=d[Dt];p=yr(v,function(m,h){return m.invoke(h,v)})}return p}function oe(f,n){var d=f.static,p=f.dynamic;if(Kr in d){var b=d[Kr];return b?(b=$.getFramebuffer(b),i.command(b,"invalid framebuffer object"),Je(function(m,h){var o=m.link(b),l=m.shared;h.set(l.framebuffer,".next",o);var s=l.context;return h.set(s,"."+_t,o+".width"),h.set(s,"."+xt,o+".height"),o})):Je(function(m,h){var o=m.shared;h.set(o.framebuffer,".next","null");var l=o.context;return h.set(l,"."+_t,l+"."+ao),h.set(l,"."+xt,l+"."+io),"null"})}else if(Kr in p){var v=p[Kr];return yr(v,function(m,h){var o=m.invoke(h,v),l=m.shared,s=l.framebuffer,E=h.def(s,".getFramebuffer(",o,")");i.optional(function(){m.assert(h,"!"+o+"||"+E,"invalid framebuffer object")}),h.set(s,".next",E);var g=l.context;return h.set(g,"."+_t,E+"?"+E+".width:"+g+"."+ao),h.set(g,"."+xt,E+"?"+E+".height:"+g+"."+io),E})}else return null}function Ae(f,n,d){var p=f.static,b=f.dynamic;function v(o){if(o in p){var l=p[o];i.commandType(l,"object","invalid "+o,d.commandStr);var s=!0,E=l.x|0,g=l.y|0,G,B;return"width"in l?(G=l.width|0,i.command(G>=0,"invalid "+o,d.commandStr)):s=!1,"height"in l?(B=l.height|0,i.command(B>=0,"invalid "+o,d.commandStr)):s=!1,new ir(!s&&n&&n.thisDep,!s&&n&&n.contextDep,!s&&n&&n.propDep,function(ge,ce){var M=ge.shared.context,F=G;"width"in l||(F=ce.def(M,".",_t,"-",E));var ve=B;return"height"in l||(ve=ce.def(M,".",xt,"-",g)),[E,g,F,ve]})}else if(o in b){var K=b[o],we=yr(K,function(ge,ce){var M=ge.invoke(ce,K);i.optional(function(){ge.assert(ce,M+"&&typeof "+M+'==="object"',"invalid "+o)});var F=ge.shared.context,ve=ce.def(M,".x|0"),de=ce.def(M,".y|0"),Te=ce.def('"width" in ',M,"?",M,".width|0:","(",F,".",_t,"-",ve,")"),$e=ce.def('"height" in ',M,"?",M,".height|0:","(",F,".",xt,"-",de,")");return i.optional(function(){ge.assert(ce,Te+">=0&&"+$e+">=0","invalid "+o)}),[ve,de,Te,$e]});return n&&(we.thisDep=we.thisDep||n.thisDep,we.contextDep=we.contextDep||n.contextDep,we.propDep=we.propDep||n.propDep),we}else return n?new ir(n.thisDep,n.contextDep,n.propDep,function(ge,ce){var M=ge.shared.context;return[0,0,ce.def(M,".",_t),ce.def(M,".",xt)]}):null}var m=v(Ir);if(m){var h=m;m=new ir(m.thisDep,m.contextDep,m.propDep,function(o,l){var s=h.append(o,l),E=o.shared.context;return l.set(E,"."+su,s[2]),l.set(E,"."+cu,s[3]),s})}return{viewport:m,scissor_box:v(dn)}}function Oe(f,n){var d=f.static,p=typeof d[Nt]=="string"&&typeof d[It]=="string";if(p){if(Object.keys(n.dynamic).length>0)return null;var b=n.static,v=Object.keys(b);if(v.length>0&&typeof b[v[0]]=="number"){for(var m=[],h=0;h<v.length;++h)i(typeof b[v[h]]=="number","must specify all vertex attribute locations when using vaos"),m.push([b[v[h]]|0,v[h]]);return m}}return null}function De(f,n,d){var p=f.static,b=f.dynamic;function v(s){if(s in p){var E=a.id(p[s]);i.optional(function(){Q.shader(vo[s],E,i.guessCommand())});var g=Je(function(){return E});return g.id=E,g}else if(s in b){var G=b[s];return yr(G,function(B,K){var we=B.invoke(K,G),ge=K.def(B.shared.strings,".id(",we,")");return i.optional(function(){K(B.shared.shader,".shader(",vo[s],",",ge,",",B.command,");")}),ge})}return null}var m=v(Nt),h=v(It),o=null,l;return $r(m)&&$r(h)?(o=Q.program(h.id,m.id,null,d),l=Je(function(s,E){return s.link(o)})):l=new ir(m&&m.thisDep||h&&h.thisDep,m&&m.contextDep||h&&h.contextDep,m&&m.propDep||h&&h.propDep,function(s,E){var g=s.shared.shader,G;m?G=m.append(s,E):G=E.def(g,".",Nt);var B;h?B=h.append(s,E):B=E.def(g,".",It);var K=g+".program("+B+","+G;return i.optional(function(){K+=","+s.command}),E.def(K+")")}),{frag:m,vert:h,progVar:l,program:o}}function Xe(f,n){var d=f.static,p=f.dynamic,b={},v=!1;function m(){if(kt in d){var ce=d[kt];return ce!==null&&X.getVAO(ce)===null&&(ce=X.createVAO(ce)),v=!0,b.vao=ce,Je(function(F){var ve=X.getVAO(ce);return ve?F.link(ve):"null"})}else if(kt in p){v=!0;var M=p[kt];return yr(M,function(F,ve){var de=F.invoke(ve,M);return ve.def(F.shared.vao+".getVAO("+de+")")})}return null}var h=m(),o=!1;function l(){if(Jr in d){var ce=d[Jr];if(b.elements=ce,Tn(ce)){var M=b.elements=S.create(ce,!0);ce=S.getElements(M),o=!0}else ce&&(ce=S.getElements(ce),o=!0,i.command(ce,"invalid elements",n.commandStr));var F=Je(function(de,Te){if(ce){var $e=de.link(ce);return de.ELEMENTS=$e,$e}return de.ELEMENTS=null,null});return F.value=ce,F}else if(Jr in p){o=!0;var ve=p[Jr];return yr(ve,function(de,Te){var $e=de.shared,ur=$e.isBufferArgs,at=$e.elements,Nr=de.invoke(Te,ve),Fr=Te.def("null"),Vr=Te.def(ur,"(",Nr,")"),it=de.cond(Vr).then(Fr,"=",at,".createStream(",Nr,");").else(Fr,"=",at,".getElements(",Nr,");");return i.optional(function(){de.assert(it.else,"!"+Nr+"||"+Fr,"invalid elements")}),Te.entry(it),Te.exit(de.cond(Vr).then(at,".destroyStream(",Fr,");")),de.ELEMENTS=Fr,Fr})}else if(v)return new ir(h.thisDep,h.contextDep,h.propDep,function(de,Te){return Te.def(de.shared.vao+".currentVAO?"+de.shared.elements+".getElements("+de.shared.vao+".currentVAO.elements):null")});return null}var s=l();function E(){if(et in d){var ce=d[et];return b.primitive=ce,i.commandParameter(ce,Br,"invalid primitve",n.commandStr),Je(function(F,ve){return Br[ce]})}else if(et in p){var M=p[et];return yr(M,function(F,ve){var de=F.constants.primTypes,Te=F.invoke(ve,M);return i.optional(function(){F.assert(ve,Te+" in "+de,"invalid primitive, must be one of "+Object.keys(Br))}),ve.def(de,"[",Te,"]")})}else{if(o)return $r(s)?s.value?Je(function(F,ve){return ve.def(F.ELEMENTS,".primType")}):Je(function(){return Ta}):new ir(s.thisDep,s.contextDep,s.propDep,function(F,ve){var de=F.ELEMENTS;return ve.def(de,"?",de,".primType:",Ta)});if(v)return new ir(h.thisDep,h.contextDep,h.propDep,function(F,ve){return ve.def(F.shared.vao+".currentVAO?"+F.shared.vao+".currentVAO.primitive:"+Ta)})}return null}function g(ce,M){if(ce in d){var F=d[ce]|0;return M?b.offset=F:b.instances=F,i.command(!M||F>=0,"invalid "+ce,n.commandStr),Je(function(de,Te){return M&&(de.OFFSET=F),F})}else if(ce in p){var ve=p[ce];return yr(ve,function(de,Te){var $e=de.invoke(Te,ve);return M&&(de.OFFSET=$e,i.optional(function(){de.assert(Te,$e+">=0","invalid "+ce)})),$e})}else if(M){if(o)return Je(function(de,Te){return de.OFFSET=0,0});if(v)return new ir(h.thisDep,h.contextDep,h.propDep,function(de,Te){return Te.def(de.shared.vao+".currentVAO?"+de.shared.vao+".currentVAO.offset:0")})}else if(v)return new ir(h.thisDep,h.contextDep,h.propDep,function(de,Te){return Te.def(de.shared.vao+".currentVAO?"+de.shared.vao+".currentVAO.instances:-1")});return null}var G=g(mn,!0);function B(){if(rt in d){var ce=d[rt]|0;return b.count=ce,i.command(typeof ce=="number"&&ce>=0,"invalid vertex count",n.commandStr),Je(function(){return ce})}else if(rt in p){var M=p[rt];return yr(M,function(Te,$e){var ur=Te.invoke($e,M);return i.optional(function(){Te.assert($e,"typeof "+ur+'==="number"&&'+ur+">=0&&"+ur+"===("+ur+"|0)","invalid vertex count")}),ur})}else if(o)if($r(s)){if(s)return G?new ir(G.thisDep,G.contextDep,G.propDep,function(Te,$e){var ur=$e.def(Te.ELEMENTS,".vertCount-",Te.OFFSET);return i.optional(function(){Te.assert($e,ur+">=0","invalid vertex offset/element buffer too small")}),ur}):Je(function(Te,$e){return $e.def(Te.ELEMENTS,".vertCount")});var F=Je(function(){return-1});return i.optional(function(){F.MISSING=!0}),F}else{var ve=new ir(s.thisDep||G.thisDep,s.contextDep||G.contextDep,s.propDep||G.propDep,function(Te,$e){var ur=Te.ELEMENTS;return Te.OFFSET?$e.def(ur,"?",ur,".vertCount-",Te.OFFSET,":-1"):$e.def(ur,"?",ur,".vertCount:-1")});return i.optional(function(){ve.DYNAMIC=!0}),ve}else if(v){var de=new ir(h.thisDep,h.contextDep,h.propDep,function(Te,$e){return $e.def(Te.shared.vao,".currentVAO?",Te.shared.vao,".currentVAO.count:-1")});return de}return null}var K=E(),we=B(),ge=g(vn,!1);return{elements:s,primitive:K,count:we,instances:ge,offset:G,vao:h,vaoActive:v,elementsActive:o,static:b}}function We(f,n){var d=f.static,p=f.dynamic,b={};return _e.forEach(function(v){var m=ue(v);function h(o,l){if(v in d){var s=o(d[v]);b[m]=Je(function(){return s})}else if(v in p){var E=p[v];b[m]=yr(E,function(g,G){return l(g,G,g.invoke(G,E))})}}switch(v){case Yf:case Vf:case $f:case eo:case jf:case to:case Zf:case Kf:case Jf:case Wf:return h(function(o){return i.commandType(o,"boolean",v,n.commandStr),o},function(o,l,s){return i.optional(function(){o.assert(l,"typeof "+s+'==="boolean"',"invalid flag "+v,o.commandStr)}),s});case Hf:return h(function(o){return i.commandParameter(o,At,"invalid "+v,n.commandStr),At[o]},function(o,l,s){var E=o.constants.compareFuncs;return i.optional(function(){o.assert(l,s+" in "+E,"invalid "+v+", must be one of "+Object.keys(At))}),l.def(E,"[",s,"]")});case Xf:return h(function(o){return i.command(He(o)&&o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number"&&o[0]<=o[1],"depth range is 2d array",n.commandStr),o},function(o,l,s){i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+s+")&&"+s+".length===2&&typeof "+s+'[0]==="number"&&typeof '+s+'[1]==="number"&&'+s+"[0]<="+s+"[1]","depth range must be a 2d array")});var E=l.def("+",s,"[0]"),g=l.def("+",s,"[1]");return[E,g]});case la:return h(function(o){i.commandType(o,"object","blend.func",n.commandStr);var l="srcRGB"in o?o.srcRGB:o.src,s="srcAlpha"in o?o.srcAlpha:o.src,E="dstRGB"in o?o.dstRGB:o.dst,g="dstAlpha"in o?o.dstAlpha:o.dst;return i.commandParameter(l,Or,m+".srcRGB",n.commandStr),i.commandParameter(s,Or,m+".srcAlpha",n.commandStr),i.commandParameter(E,Or,m+".dstRGB",n.commandStr),i.commandParameter(g,Or,m+".dstAlpha",n.commandStr),i.command(mo.indexOf(l+", "+E)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+l+", "+E+")",n.commandStr),[Or[l],Or[E],Or[s],Or[g]]},function(o,l,s){var E=o.constants.blendFuncs;i.optional(function(){o.assert(l,s+"&&typeof "+s+'==="object"',"invalid blend func, must be an object")});function g(M,F){var ve=l.def('"',M,F,'" in ',s,"?",s,".",M,F,":",s,".",M);return i.optional(function(){o.assert(l,ve+" in "+E,"invalid "+v+"."+M+F+", must be one of "+Object.keys(Or))}),ve}var G=g("src","RGB"),B=g("dst","RGB");i.optional(function(){var M=o.constants.invalidBlendCombinations;o.assert(l,M+".indexOf("+G+'+", "+'+B+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var K=l.def(E,"[",G,"]"),we=l.def(E,"[",g("src","Alpha"),"]"),ge=l.def(E,"[",B,"]"),ce=l.def(E,"[",g("dst","Alpha"),"]");return[K,ge,we,ce]});case ca:return h(function(o){if(typeof o=="string")return i.commandParameter(o,O,"invalid "+v,n.commandStr),[O[o],O[o]];if(typeof o=="object")return i.commandParameter(o.rgb,O,v+".rgb",n.commandStr),i.commandParameter(o.alpha,O,v+".alpha",n.commandStr),[O[o.rgb],O[o.alpha]];i.commandRaise("invalid blend.equation",n.commandStr)},function(o,l,s){var E=o.constants.blendEquations,g=l.def(),G=l.def(),B=o.cond("typeof ",s,'==="string"');return i.optional(function(){function K(we,ge,ce){o.assert(we,ce+" in "+E,"invalid "+ge+", must be one of "+Object.keys(O))}K(B.then,v,s),o.assert(B.else,s+"&&typeof "+s+'==="object"',"invalid "+v),K(B.else,v+".rgb",s+".rgb"),K(B.else,v+".alpha",s+".alpha")}),B.then(g,"=",G,"=",E,"[",s,"];"),B.else(g,"=",E,"[",s,".rgb];",G,"=",E,"[",s,".alpha];"),l(B),[g,G]});case qf:return h(function(o){return i.command(He(o)&&o.length===4,"blend.color must be a 4d array",n.commandStr),xr(4,function(l){return+o[l]})},function(o,l,s){return i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+s+")&&"+s+".length===4","blend.color must be a 4d array")}),xr(4,function(E){return l.def("+",s,"[",E,"]")})});case ro:return h(function(o){return i.commandType(o,"number",m,n.commandStr),o|0},function(o,l,s){return i.optional(function(){o.assert(l,"typeof "+s+'==="number"',"invalid stencil.mask")}),l.def(s,"|0")});case pa:return h(function(o){i.commandType(o,"object",m,n.commandStr);var l=o.cmp||"keep",s=o.ref||0,E="mask"in o?o.mask:-1;return i.commandParameter(l,At,v+".cmp",n.commandStr),i.commandType(s,"number",v+".ref",n.commandStr),i.commandType(E,"number",v+".mask",n.commandStr),[At[l],s,E]},function(o,l,s){var E=o.constants.compareFuncs;i.optional(function(){function K(){o.assert(l,Array.prototype.join.call(arguments,""),"invalid stencil.func")}K(s+"&&typeof ",s,'==="object"'),K('!("cmp" in ',s,")||(",s,".cmp in ",E,")")});var g=l.def('"cmp" in ',s,"?",E,"[",s,".cmp]",":",zr),G=l.def(s,".ref|0"),B=l.def('"mask" in ',s,"?",s,".mask|0:-1");return[g,G,B]});case ya:case Gt:return h(function(o){i.commandType(o,"object",m,n.commandStr);var l=o.fail||"keep",s=o.zfail||"keep",E=o.zpass||"keep";return i.commandParameter(l,Ur,v+".fail",n.commandStr),i.commandParameter(s,Ur,v+".zfail",n.commandStr),i.commandParameter(E,Ur,v+".zpass",n.commandStr),[v===Gt?tt:Vt,Ur[l],Ur[s],Ur[E]]},function(o,l,s){var E=o.constants.stencilOps;i.optional(function(){o.assert(l,s+"&&typeof "+s+'==="object"',"invalid "+v)});function g(G){return i.optional(function(){o.assert(l,'!("'+G+'" in '+s+")||("+s+"."+G+" in "+E+")","invalid "+v+"."+G+", must be one of "+Object.keys(Ur))}),l.def('"',G,'" in ',s,"?",E,"[",s,".",G,"]:",zr)}return[v===Gt?tt:Vt,g("fail"),g("zfail"),g("zpass")]});case va:return h(function(o){i.commandType(o,"object",m,n.commandStr);var l=o.factor|0,s=o.units|0;return i.commandType(l,"number",m+".factor",n.commandStr),i.commandType(s,"number",m+".units",n.commandStr),[l,s]},function(o,l,s){i.optional(function(){o.assert(l,s+"&&typeof "+s+'==="object"',"invalid "+v)});var E=l.def(s,".factor|0"),g=l.def(s,".units|0");return[E,g]});case Qf:return h(function(o){var l=0;return o==="front"?l=Vt:o==="back"&&(l=tt),i.command(!!l,m,n.commandStr),l},function(o,l,s){return i.optional(function(){o.assert(l,s+'==="front"||'+s+'==="back"',"invalid cull.face")}),l.def(s,'==="front"?',Vt,":",tt)});case ma:return h(function(o){return i.command(typeof o=="number"&&o>=w.lineWidthDims[0]&&o<=w.lineWidthDims[1],"invalid line width, must be a positive number between "+w.lineWidthDims[0]+" and "+w.lineWidthDims[1],n.commandStr),o},function(o,l,s){return i.optional(function(){o.assert(l,"typeof "+s+'==="number"&&'+s+">="+w.lineWidthDims[0]+"&&"+s+"<="+w.lineWidthDims[1],"invalid line width")}),s});case da:return h(function(o){return i.commandParameter(o,wa,m,n.commandStr),wa[o]},function(o,l,s){return i.optional(function(){o.assert(l,s+'==="cw"||'+s+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),l.def(s+'==="cw"?'+oo+":"+Sa)});case ua:return h(function(o){return i.command(He(o)&&o.length===4,"color.mask must be length 4 array",n.commandStr),o.map(function(l){return!!l})},function(o,l,s){return i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+s+")&&"+s+".length===4","invalid color.mask")}),xr(4,function(E){return"!!"+s+"["+E+"]"})});case ha:return h(function(o){i.command(typeof o=="object"&&o,m,n.commandStr);var l="value"in o?o.value:1,s=!!o.invert;return i.command(typeof l=="number"&&l>=0&&l<=1,"sample.coverage.value must be a number between 0 and 1",n.commandStr),[l,s]},function(o,l,s){i.optional(function(){o.assert(l,s+"&&typeof "+s+'==="object"',"invalid sample.coverage")});var E=l.def('"value" in ',s,"?+",s,".value:1"),g=l.def("!!",s,".invert");return[E,g]})}}),b}function Ne(f,n){var d=f.static,p=f.dynamic,b={};return Object.keys(d).forEach(function(v){var m=d[v],h;if(typeof m=="number"||typeof m=="boolean")h=Je(function(){return m});else if(typeof m=="function"){var o=m._reglType;o==="texture2d"||o==="textureCube"?h=Je(function(l){return l.link(m)}):o==="framebuffer"||o==="framebufferCube"?(i.command(m.color.length>0,'missing color attachment for framebuffer sent to uniform "'+v+'"',n.commandStr),h=Je(function(l){return l.link(m.color[0])})):i.commandRaise('invalid data for uniform "'+v+'"',n.commandStr)}else He(m)?h=Je(function(l){var s=l.global.def("[",xr(m.length,function(E){return i.command(typeof m[E]=="number"||typeof m[E]=="boolean","invalid uniform "+v,l.commandStr),m[E]}),"]");return s}):i.commandRaise('invalid or missing data for uniform "'+v+'"',n.commandStr);h.value=m,b[v]=h}),Object.keys(p).forEach(function(v){var m=p[v];b[v]=yr(m,function(h,o){return h.invoke(o,m)})}),b}function tr(f,n){var d=f.static,p=f.dynamic,b={};return Object.keys(d).forEach(function(v){var m=d[v],h=a.id(v),o=new y;if(Tn(m))o.state=gt,o.buffer=N.getBuffer(N.create(m,Et,!1,!0)),o.type=0;else{var l=N.getBuffer(m);if(l)o.state=gt,o.buffer=l,o.type=0;else if(i.command(typeof m=="object"&&m,"invalid data for attribute "+v,n.commandStr),"constant"in m){var s=m.constant;o.buffer="null",o.state=aa,typeof s=="number"?o.x=s:(i.command(He(s)&&s.length>0&&s.length<=4,"invalid constant for attribute "+v,n.commandStr),bt.forEach(function(ge,ce){ce<s.length&&(o[ge]=s[ce])}))}else{Tn(m.buffer)?l=N.getBuffer(N.create(m.buffer,Et,!1,!0)):l=N.getBuffer(m.buffer),i.command(!!l,'missing buffer for attribute "'+v+'"',n.commandStr);var E=m.offset|0;i.command(E>=0,'invalid offset for attribute "'+v+'"',n.commandStr);var g=m.stride|0;i.command(g>=0&&g<256,'invalid stride for attribute "'+v+'", must be integer betweeen [0, 255]',n.commandStr);var G=m.size|0;i.command(!("size"in m)||G>0&&G<=4,'invalid size for attribute "'+v+'", must be 1,2,3,4',n.commandStr);var B=!!m.normalized,K=0;"type"in m&&(i.commandParameter(m.type,Xr,"invalid type for attribute "+v,n.commandStr),K=Xr[m.type]);var we=m.divisor|0;i.optional(function(){"divisor"in m&&(i.command(we===0||j,'cannot specify divisor for attribute "'+v+'", instancing not supported',n.commandStr),i.command(we>=0,'invalid divisor for attribute "'+v+'"',n.commandStr));var ge=n.commandStr,ce=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(m).forEach(function(M){i.command(ce.indexOf(M)>=0,'unknown parameter "'+M+'" for attribute pointer "'+v+'" (valid parameters are '+ce+")",ge)})}),o.buffer=l,o.state=gt,o.size=G,o.normalized=B,o.type=K||l.dtype,o.offset=E,o.stride=g,o.divisor=we}}b[v]=Je(function(ge,ce){var M=ge.attribCache;if(h in M)return M[h];var F={isStream:!1};return Object.keys(o).forEach(function(ve){F[ve]=o[ve]}),o.buffer&&(F.buffer=ge.link(o.buffer),F.type=F.type||F.buffer+".dtype"),M[h]=F,F})}),Object.keys(p).forEach(function(v){var m=p[v];function h(o,l){var s=o.invoke(l,m),E=o.shared,g=o.constants,G=E.isBufferArgs,B=E.buffer;i.optional(function(){o.assert(l,s+"&&(typeof "+s+'==="object"||typeof '+s+'==="function")&&('+G+"("+s+")||"+B+".getBuffer("+s+")||"+B+".getBuffer("+s+".buffer)||"+G+"("+s+'.buffer)||("constant" in '+s+"&&(typeof "+s+'.constant==="number"||'+E.isArrayLike+"("+s+".constant))))",'invalid dynamic attribute "'+v+'"')});var K={isStream:l.def(!1)},we=new y;we.state=gt,Object.keys(we).forEach(function(F){K[F]=l.def(""+we[F])});var ge=K.buffer,ce=K.type;l("if(",G,"(",s,")){",K.isStream,"=true;",ge,"=",B,".createStream(",Et,",",s,");",ce,"=",ge,".dtype;","}else{",ge,"=",B,".getBuffer(",s,");","if(",ge,"){",ce,"=",ge,".dtype;",'}else if("constant" in ',s,"){",K.state,"=",aa,";","if(typeof "+s+'.constant === "number"){',K[bt[0]],"=",s,".constant;",bt.slice(1).map(function(F){return K[F]}).join("="),"=0;","}else{",bt.map(function(F,ve){return K[F]+"="+s+".constant.length>"+ve+"?"+s+".constant["+ve+"]:0;"}).join(""),"}}else{","if(",G,"(",s,".buffer)){",ge,"=",B,".createStream(",Et,",",s,".buffer);","}else{",ge,"=",B,".getBuffer(",s,".buffer);","}",ce,'="type" in ',s,"?",g.glTypes,"[",s,".type]:",ge,".dtype;",K.normalized,"=!!",s,".normalized;");function M(F){l(K[F],"=",s,".",F,"|0;")}return M("size"),M("offset"),M("stride"),M("divisor"),l("}}"),l.exit("if(",K.isStream,"){",B,".destroyStream(",ge,");","}"),K}b[v]=yr(m,h)}),b}function qe(f){var n=f.static,d=f.dynamic,p={};return Object.keys(n).forEach(function(b){var v=n[b];p[b]=Je(function(m,h){return typeof v=="number"||typeof v=="boolean"?""+v:m.link(v)})}),Object.keys(d).forEach(function(b){var v=d[b];p[b]=yr(v,function(m,h){return m.invoke(h,v)})}),p}function er(f,n,d,p,b){var v=f.static,m=f.dynamic;i.optional(function(){var M=[Kr,It,Nt,Jr,et,mn,rt,vn,Dt,kt].concat(_e);function F(ve){Object.keys(ve).forEach(function(de){i.command(M.indexOf(de)>=0,'unknown parameter "'+de+'"',b.commandStr)})}F(v),F(m)});var h=Oe(f,n),o=oe(f),l=Ae(f,o,b),s=Xe(f,b),E=We(f,b),g=De(f,b,h);function G(M){var F=l[M];F&&(E[M]=F)}G(Ir),G(ue(dn));var B=Object.keys(E).length>0,K={framebuffer:o,draw:s,shader:g,state:E,dirty:B,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(K.profile=ie(f),K.uniforms=Ne(d,b),K.drawVAO=K.scopeVAO=s.vao,!K.drawVAO&&g.program&&!h&&u.angle_instanced_arrays&&s.static.elements){var we=!0,ge=g.program.attributes.map(function(M){var F=n.static[M];return we=we&&!!F,F});if(we&&ge.length>0){var ce=X.getVAO(X.createVAO({attributes:ge,elements:s.static.elements}));K.drawVAO=new ir(null,null,null,function(M,F){return M.link(ce)}),K.useVAO=!0}}return h?K.useVAO=!0:K.attributes=tr(n,b),K.context=qe(p),K}function nr(f,n,d){var p=f.shared,b=p.context,v=f.scope();Object.keys(d).forEach(function(m){n.save(b,"."+m);var h=d[m],o=h.append(f,n);Array.isArray(o)?v(b,".",m,"=[",o.join(),"];"):v(b,".",m,"=",o,";")}),n(v)}function ar(f,n,d,p){var b=f.shared,v=b.gl,m=b.framebuffer,h;se&&(h=n.def(b.extensions,".webgl_draw_buffers"));var o=f.constants,l=o.drawBuffer,s=o.backBuffer,E;d?E=d.append(f,n):E=n.def(m,".next"),p||n("if(",E,"!==",m,".cur){"),n("if(",E,"){",v,".bindFramebuffer(",uo,",",E,".framebuffer);"),se&&n(h,".drawBuffersWEBGL(",l,"[",E,".colorAttachments.length]);"),n("}else{",v,".bindFramebuffer(",uo,",null);"),se&&n(h,".drawBuffersWEBGL(",s,");"),n("}",m,".cur=",E,";"),p||n("}")}function fr(f,n,d){var p=f.shared,b=p.gl,v=f.current,m=f.next,h=p.current,o=p.next,l=f.cond(h,".dirty");_e.forEach(function(s){var E=ue(s);if(!(E in d.state)){var g,G;if(E in m){g=m[E],G=v[E];var B=xr(fe[E].length,function(we){return l.def(g,"[",we,"]")});l(f.cond(B.map(function(we,ge){return we+"!=="+G+"["+ge+"]"}).join("||")).then(b,".",I[E],"(",B,");",B.map(function(we,ge){return G+"["+ge+"]="+we}).join(";"),";"))}else{g=l.def(o,".",E);var K=f.cond(g,"!==",h,".",E);l(K),E in k?K(f.cond(g).then(b,".enable(",k[E],");").else(b,".disable(",k[E],");"),h,".",E,"=",g,";"):K(b,".",I[E],"(",g,");",h,".",E,"=",g,";")}}}),Object.keys(d.state).length===0&&l(h,".dirty=false;"),n(l)}function cr(f,n,d,p){var b=f.shared,v=f.current,m=b.current,h=b.gl;ho(Object.keys(d)).forEach(function(o){var l=d[o];if(!(p&&!p(l))){var s=l.append(f,n);if(k[o]){var E=k[o];$r(l)?s?n(h,".enable(",E,");"):n(h,".disable(",E,");"):n(f.cond(s).then(h,".enable(",E,");").else(h,".disable(",E,");")),n(m,".",o,"=",s,";")}else if(He(s)){var g=v[o];n(h,".",I[o],"(",s,");",s.map(function(G,B){return g+"["+B+"]="+G}).join(";"),";")}else n(h,".",I[o],"(",s,");",m,".",o,"=",s,";")}})}function Qe(f,n){j&&(f.instancing=n.def(f.shared.extensions,".angle_instanced_arrays"))}function Pe(f,n,d,p,b){var v=f.shared,m=f.stats,h=v.current,o=v.timer,l=d.profile;function s(){return typeof performance>"u"?"Date.now()":"performance.now()"}var E,g;function G(M){E=n.def(),M(E,"=",s(),";"),typeof b=="string"?M(m,".count+=",b,";"):M(m,".count++;"),V&&(p?(g=n.def(),M(g,"=",o,".getNumPendingQueries();")):M(o,".beginQuery(",m,");"))}function B(M){M(m,".cpuTime+=",s(),"-",E,";"),V&&(p?M(o,".pushScopeStats(",g,",",o,".getNumPendingQueries(),",m,");"):M(o,".endQuery();"))}function K(M){var F=n.def(h,".profile");n(h,".profile=",M,";"),n.exit(h,".profile=",F,";")}var we;if(l){if($r(l)){l.enable?(G(n),B(n.exit),K("true")):K("false");return}we=l.append(f,n),K(we)}else we=n.def(h,".profile");var ge=f.block();G(ge),n("if(",we,"){",ge,"}");var ce=f.block();B(ce),n.exit("if(",we,"){",ce,"}")}function lr(f,n,d,p,b){var v=f.shared;function m(o){switch(o){case hn:case bn:case xn:return 2;case pn:case gn:case En:return 3;case yn:case _n:case An:return 4;default:return 1}}function h(o,l,s){var E=v.gl,g=n.def(o,".location"),G=n.def(v.attributes,"[",g,"]"),B=s.state,K=s.buffer,we=[s.x,s.y,s.z,s.w],ge=["buffer","normalized","offset","stride"];function ce(){n("if(!",G,".buffer){",E,".enableVertexAttribArray(",g,");}");var F=s.type,ve;if(s.size?ve=n.def(s.size,"||",l):ve=l,n("if(",G,".type!==",F,"||",G,".size!==",ve,"||",ge.map(function(Te){return G+"."+Te+"!=="+s[Te]}).join("||"),"){",E,".bindBuffer(",Et,",",K,".buffer);",E,".vertexAttribPointer(",[g,ve,F,s.normalized,s.stride,s.offset],");",G,".type=",F,";",G,".size=",ve,";",ge.map(function(Te){return G+"."+Te+"="+s[Te]+";"}).join(""),"}"),j){var de=s.divisor;n("if(",G,".divisor!==",de,"){",f.instancing,".vertexAttribDivisorANGLE(",[g,de],");",G,".divisor=",de,";}")}}function M(){n("if(",G,".buffer){",E,".disableVertexAttribArray(",g,");",G,".buffer=null;","}if(",bt.map(function(F,ve){return G+"."+F+"!=="+we[ve]}).join("||"),"){",E,".vertexAttrib4f(",g,",",we,");",bt.map(function(F,ve){return G+"."+F+"="+we[ve]+";"}).join(""),"}")}B===gt?ce():B===aa?M():(n("if(",B,"===",gt,"){"),ce(),n("}else{"),M(),n("}"))}p.forEach(function(o){var l=o.name,s=d.attributes[l],E;if(s){if(!b(s))return;E=s.append(f,n)}else{if(!b(po))return;var g=f.scopeAttrib(l);i.optional(function(){f.assert(n,g+".state","missing attribute "+l)}),E={},Object.keys(new y).forEach(function(G){E[G]=n.def(g,".",G)})}h(f.link(o),m(o.info.type),E)})}function Ue(f,n,d,p,b,v){for(var m=f.shared,h=m.gl,o={},l,s=0;s<p.length;++s){var E=p[s],g=E.name,G=E.info.type,B=E.info.size,K=d.uniforms[g];if(B>1){if(!K)continue;var we=g.replace("[0]","");if(o[we])continue;o[we]=1}var ge=f.link(E),ce=ge+".location",M;if(K){if(!b(K))continue;if($r(K)){var F=K.value;if(i.command(F!==null&&typeof F<"u",'missing uniform "'+g+'"',f.commandStr),G===Ut||G===$t){i.command(typeof F=="function"&&(G===Ut&&(F._reglType==="texture2d"||F._reglType==="framebuffer")||G===$t&&(F._reglType==="textureCube"||F._reglType==="framebufferCube")),"invalid texture for uniform "+g,f.commandStr);var ve=f.link(F._texture||F.color[0]._texture);n(h,".uniform1i(",ce,",",ve+".bind());"),n.exit(ve,".unbind();")}else if(G===Bt||G===Mt||G===zt){i.optional(function(){i.command(He(F),"invalid matrix for uniform "+g,f.commandStr),i.command(G===Bt&&F.length===4||G===Mt&&F.length===9||G===zt&&F.length===16,"invalid length for matrix uniform "+g,f.commandStr)});var de=f.global.def("new Float32Array(["+Array.prototype.slice.call(F)+"])"),Te=2;G===Mt?Te=3:G===zt&&(Te=4),n(h,".uniformMatrix",Te,"fv(",ce,",false,",de,");")}else{switch(G){case xa:B===1?i.commandType(F,"number","uniform "+g,f.commandStr):i.command(He(F)&&F.length===B,"uniform "+g,f.commandStr),l="1f";break;case hn:i.command(He(F)&&F.length&&F.length%2===0&&F.length<=B*2,"uniform "+g,f.commandStr),l="2f";break;case pn:i.command(He(F)&&F.length&&F.length%3===0&&F.length<=B*3,"uniform "+g,f.commandStr),l="3f";break;case yn:i.command(He(F)&&F.length&&F.length%4===0&&F.length<=B*4,"uniform "+g,f.commandStr),l="4f";break;case Aa:B===1?i.commandType(F,"boolean","uniform "+g,f.commandStr):i.command(He(F)&&F.length===B,"uniform "+g,f.commandStr),l="1i";break;case Ea:B===1?i.commandType(F,"number","uniform "+g,f.commandStr):i.command(He(F)&&F.length===B,"uniform "+g,f.commandStr),l="1i";break;case xn:i.command(He(F)&&F.length&&F.length%2===0&&F.length<=B*2,"uniform "+g,f.commandStr),l="2i";break;case bn:i.command(He(F)&&F.length&&F.length%2===0&&F.length<=B*2,"uniform "+g,f.commandStr),l="2i";break;case En:i.command(He(F)&&F.length&&F.length%3===0&&F.length<=B*3,"uniform "+g,f.commandStr),l="3i";break;case gn:i.command(He(F)&&F.length&&F.length%3===0&&F.length<=B*3,"uniform "+g,f.commandStr),l="3i";break;case An:i.command(He(F)&&F.length&&F.length%4===0&&F.length<=B*4,"uniform "+g,f.commandStr),l="4i";break;case _n:i.command(He(F)&&F.length&&F.length%4===0&&F.length<=B*4,"uniform "+g,f.commandStr),l="4i";break}B>1?(l+="v",F=f.global.def("["+Array.prototype.slice.call(F)+"]")):F=He(F)?Array.prototype.slice.call(F):F,n(h,".uniform",l,"(",ce,",",F,");")}continue}else M=K.append(f,n)}else{if(!b(po))continue;M=n.def(m.uniforms,"[",a.id(g),"]")}G===Ut?(i(!Array.isArray(M),"must specify a scalar prop for textures"),n("if(",M,"&&",M,'._reglType==="framebuffer"){',M,"=",M,".color[0];","}")):G===$t&&(i(!Array.isArray(M),"must specify a scalar prop for cube maps"),n("if(",M,"&&",M,'._reglType==="framebufferCube"){',M,"=",M,".color[0];","}")),i.optional(function(){function Ar(br,Sn){f.assert(n,br,'bad data or missing for uniform "'+g+'".  '+Sn)}function ft(br,Sn){Sn===1&&i(!Array.isArray(M),"must not specify an array type for uniform"),Ar("Array.isArray("+M+") && typeof "+M+'[0]===" '+br+'" || typeof '+M+'==="'+br+'"',"invalid type, expected "+br)}function Sr(br,Sn,wn){Array.isArray(M)?i(M.length&&M.length%br===0&&M.length<=br*wn,"must have length of "+(wn===1?"":"n * ")+br):Ar(m.isArrayLike+"("+M+")&&"+M+".length && "+M+".length % "+br+" === 0 && "+M+".length<="+br*wn,"invalid vector, should have length of "+(wn===1?"":"n * ")+br,f.commandStr)}function Ao(br){i(!Array.isArray(M),"must not specify a value type"),Ar("typeof "+M+'==="function"&&'+M+'._reglType==="texture'+(br===fo?"2d":"Cube")+'"',"invalid texture type",f.commandStr)}switch(G){case Ea:ft("number",B);break;case bn:Sr(2,"number",B);break;case gn:Sr(3,"number",B);break;case _n:Sr(4,"number",B);break;case xa:ft("number",B);break;case hn:Sr(2,"number",B);break;case pn:Sr(3,"number",B);break;case yn:Sr(4,"number",B);break;case Aa:ft("boolean",B);break;case xn:Sr(2,"boolean",B);break;case En:Sr(3,"boolean",B);break;case An:Sr(4,"boolean",B);break;case Bt:Sr(4,"number",B);break;case Mt:Sr(9,"number",B);break;case zt:Sr(16,"number",B);break;case Ut:Ao(fo);break;case $t:Ao(mu);break}});var $e=1;switch(G){case Ut:case $t:var ur=n.def(M,"._texture");n(h,".uniform1i(",ce,",",ur,".bind());"),n.exit(ur,".unbind();");continue;case Ea:case Aa:l="1i";break;case bn:case xn:l="2i",$e=2;break;case gn:case En:l="3i",$e=3;break;case _n:case An:l="4i",$e=4;break;case xa:l="1f";break;case hn:l="2f",$e=2;break;case pn:l="3f",$e=3;break;case yn:l="4f",$e=4;break;case Bt:l="Matrix2fv";break;case Mt:l="Matrix3fv";break;case zt:l="Matrix4fv";break}if(l.indexOf("Matrix")===-1&&B>1&&(l+="v",$e=1),l.charAt(0)==="M"){n(h,".uniform",l,"(",ce,",");var at=Math.pow(G-Bt+2,2),Nr=f.global.def("new Float32Array(",at,")");Array.isArray(M)?n("false,(",xr(at,function(Ar){return Nr+"["+Ar+"]="+M[Ar]}),",",Nr,")"):n("false,(Array.isArray(",M,")||",M," instanceof Float32Array)?",M,":(",xr(at,function(Ar){return Nr+"["+Ar+"]="+M+"["+Ar+"]"}),",",Nr,")"),n(");")}else if($e>1){for(var Fr=[],Vr=[],it=0;it<$e;++it)Array.isArray(M)?Vr.push(M[it]):Vr.push(n.def(M+"["+it+"]")),v&&Fr.push(n.def());v&&n("if(!",f.batchId,"||",Fr.map(function(Ar,ft){return Ar+"!=="+Vr[ft]}).join("||"),"){",Fr.map(function(Ar,ft){return Ar+"="+Vr[ft]+";"}).join("")),n(h,".uniform",l,"(",ce,",",Vr.join(","),");"),v&&n("}")}else{if(i(!Array.isArray(M),"uniform value must not be an array"),v){var Eo=n.def();n("if(!",f.batchId,"||",Eo,"!==",M,"){",Eo,"=",M,";")}n(h,".uniform",l,"(",ce,",",M,");"),v&&n("}")}}}function Ee(f,n,d,p){var b=f.shared,v=b.gl,m=b.draw,h=p.draw;function o(){var ve=h.elements,de,Te=n;return ve?((ve.contextDep&&p.contextDynamic||ve.propDep)&&(Te=d),de=ve.append(f,Te),h.elementsActive&&Te("if("+de+")"+v+".bindBuffer("+_a+","+de+".buffer.buffer);")):(de=Te.def(),Te(de,"=",m,".",Jr,";","if(",de,"){",v,".bindBuffer(",_a,",",de,".buffer.buffer);}","else if(",b.vao,".currentVAO){",de,"=",f.shared.elements+".getElements("+b.vao,".currentVAO.elements);",z?"":"if("+de+")"+v+".bindBuffer("+_a+","+de+".buffer.buffer);","}")),de}function l(){var ve=h.count,de,Te=n;return ve?((ve.contextDep&&p.contextDynamic||ve.propDep)&&(Te=d),de=ve.append(f,Te),i.optional(function(){ve.MISSING&&f.assert(n,"false","missing vertex count"),ve.DYNAMIC&&f.assert(Te,de+">=0","missing vertex count")})):(de=Te.def(m,".",rt),i.optional(function(){f.assert(Te,de+">=0","missing vertex count")})),de}var s=o();function E(ve){var de=h[ve];return de?de.contextDep&&p.contextDynamic||de.propDep?de.append(f,d):de.append(f,n):n.def(m,".",ve)}var g=E(et),G=E(mn),B=l();if(typeof B=="number"){if(B===0)return}else d("if(",B,"){"),d.exit("}");var K,we;j&&(K=E(vn),we=f.instancing);var ge=s+".type",ce=h.elements&&$r(h.elements)&&!h.vaoActive;function M(){function ve(){d(we,".drawElementsInstancedANGLE(",[g,B,ge,G+"<<(("+ge+"-"+Mf+")>>1)",K],");")}function de(){d(we,".drawArraysInstancedANGLE(",[g,G,B,K],");")}s&&s!=="null"?ce?ve():(d("if(",s,"){"),ve(),d("}else{"),de(),d("}")):de()}function F(){function ve(){d(v+".drawElements("+[g,B,ge,G+"<<(("+ge+"-"+Mf+")>>1)"]+");")}function de(){d(v+".drawArrays("+[g,G,B]+");")}s&&s!=="null"?ce?ve():(d("if(",s,"){"),ve(),d("}else{"),de(),d("}")):de()}j&&(typeof K!="number"||K>=0)?typeof K=="string"?(d("if(",K,">0){"),M(),d("}else if(",K,"<0){"),F(),d("}")):M():F()}function Ie(f,n,d,p,b){var v=Le(),m=v.proc("body",b);return i.optional(function(){v.commandStr=n.commandStr,v.command=v.link(n.commandStr)}),j&&(v.instancing=m.def(v.shared.extensions,".angle_instanced_arrays")),f(v,m,d,p),v.compile().body}function ze(f,n,d,p){Qe(f,n),d.useVAO?d.drawVAO?n(f.shared.vao,".setVAO(",d.drawVAO.append(f,n),");"):n(f.shared.vao,".setVAO(",f.shared.vao,".targetVAO);"):(n(f.shared.vao,".setVAO(null);"),lr(f,n,d,p.attributes,function(){return!0})),Ue(f,n,d,p.uniforms,function(){return!0},!1),Ee(f,n,n,d)}function Ze(f,n){var d=f.proc("draw",1);Qe(f,d),nr(f,d,n.context),ar(f,d,n.framebuffer),fr(f,d,n),cr(f,d,n.state),Pe(f,d,n,!1,!0);var p=n.shader.progVar.append(f,d);if(d(f.shared.gl,".useProgram(",p,".program);"),n.shader.program)ze(f,d,n,n.shader.program);else{d(f.shared.vao,".setVAO(null);");var b=f.global.def("{}"),v=d.def(p,".id"),m=d.def(b,"[",v,"]");d(f.cond(m).then(m,".call(this,a0);").else(m,"=",b,"[",v,"]=",f.link(function(h){return Ie(ze,f,n,h,1)}),"(",p,");",m,".call(this,a0);"))}Object.keys(n.state).length>0&&d(f.shared.current,".dirty=true;"),f.shared.vao&&d(f.shared.vao,".setVAO(null);")}function Pr(f,n,d,p){f.batchId="a1",Qe(f,n);function b(){return!0}lr(f,n,d,p.attributes,b),Ue(f,n,d,p.uniforms,b,!1),Ee(f,n,n,d)}function nt(f,n,d,p){Qe(f,n);var b=d.contextDep,v=n.def(),m="a0",h="a1",o=n.def();f.shared.props=o,f.batchId=v;var l=f.scope(),s=f.scope();n(l.entry,"for(",v,"=0;",v,"<",h,";++",v,"){",o,"=",m,"[",v,"];",s,"}",l.exit);function E(ge){return ge.contextDep&&b||ge.propDep}function g(ge){return!E(ge)}if(d.needsContext&&nr(f,s,d.context),d.needsFramebuffer&&ar(f,s,d.framebuffer),cr(f,s,d.state,E),d.profile&&E(d.profile)&&Pe(f,s,d,!1,!0),p)d.useVAO?d.drawVAO?E(d.drawVAO)?s(f.shared.vao,".setVAO(",d.drawVAO.append(f,s),");"):l(f.shared.vao,".setVAO(",d.drawVAO.append(f,l),");"):l(f.shared.vao,".setVAO(",f.shared.vao,".targetVAO);"):(l(f.shared.vao,".setVAO(null);"),lr(f,l,d,p.attributes,g),lr(f,s,d,p.attributes,E)),Ue(f,l,d,p.uniforms,g,!1),Ue(f,s,d,p.uniforms,E,!0),Ee(f,l,s,d);else{var G=f.global.def("{}"),B=d.shader.progVar.append(f,s),K=s.def(B,".id"),we=s.def(G,"[",K,"]");s(f.shared.gl,".useProgram(",B,".program);","if(!",we,"){",we,"=",G,"[",K,"]=",f.link(function(ge){return Ie(Pr,f,d,ge,2)}),"(",B,");}",we,".call(this,a0[",v,"],",v,");")}}function c(f,n){var d=f.proc("batch",2);f.batchId="0",Qe(f,d);var p=!1,b=!0;Object.keys(n.context).forEach(function(G){p=p||n.context[G].propDep}),p||(nr(f,d,n.context),b=!1);var v=n.framebuffer,m=!1;v?(v.propDep?p=m=!0:v.contextDep&&p&&(m=!0),m||ar(f,d,v)):ar(f,d,null),n.state.viewport&&n.state.viewport.propDep&&(p=!0);function h(G){return G.contextDep&&p||G.propDep}fr(f,d,n),cr(f,d,n.state,function(G){return!h(G)}),(!n.profile||!h(n.profile))&&Pe(f,d,n,!1,"a1"),n.contextDep=p,n.needsContext=b,n.needsFramebuffer=m;var o=n.shader.progVar;if(o.contextDep&&p||o.propDep)nt(f,d,n,null);else{var l=o.append(f,d);if(d(f.shared.gl,".useProgram(",l,".program);"),n.shader.program)nt(f,d,n,n.shader.program);else{d(f.shared.vao,".setVAO(null);");var s=f.global.def("{}"),E=d.def(l,".id"),g=d.def(s,"[",E,"]");d(f.cond(g).then(g,".call(this,a0,a1);").else(g,"=",s,"[",E,"]=",f.link(function(G){return Ie(nt,f,n,G,2)}),"(",l,");",g,".call(this,a0,a1);"))}}Object.keys(n.state).length>0&&d(f.shared.current,".dirty=true;"),f.shared.vao&&d(f.shared.vao,".setVAO(null);")}function R(f,n){var d=f.proc("scope",3);f.batchId="a2";var p=f.shared,b=p.current;nr(f,d,n.context),n.framebuffer&&n.framebuffer.append(f,d),ho(Object.keys(n.state)).forEach(function(m){var h=n.state[m],o=h.append(f,d);He(o)?o.forEach(function(l,s){d.set(f.next[m],"["+s+"]",l)}):d.set(p.next,"."+m,o)}),Pe(f,d,n,!0,!0),[Jr,mn,rt,vn,et].forEach(function(m){var h=n.draw[m];h&&d.set(p.draw,"."+m,""+h.append(f,d))}),Object.keys(n.uniforms).forEach(function(m){var h=n.uniforms[m].append(f,d);Array.isArray(h)&&(h="["+h.join()+"]"),d.set(p.uniforms,"["+a.id(m)+"]",h)}),Object.keys(n.attributes).forEach(function(m){var h=n.attributes[m].append(f,d),o=f.scopeAttrib(m);Object.keys(new y).forEach(function(l){d.set(o,"."+l,h[l])})}),n.scopeVAO&&d.set(p.vao,".targetVAO",n.scopeVAO.append(f,d));function v(m){var h=n.shader[m];h&&d.set(p.shader,"."+m,h.append(f,d))}v(It),v(Nt),Object.keys(n.state).length>0&&(d(b,".dirty=true;"),d.exit(b,".dirty=true;")),d("a1(",f.shared.context,",a0,",f.batchId,");")}function A(f){if(!(typeof f!="object"||He(f))){for(var n=Object.keys(f),d=0;d<n.length;++d)if(_r.isDynamic(f[n[d]]))return!0;return!1}}function le(f,n,d){var p=n.static[d];if(!p||!A(p))return;var b=f.global,v=Object.keys(p),m=!1,h=!1,o=!1,l=f.global.def("{}");v.forEach(function(E){var g=p[E];if(_r.isDynamic(g)){typeof g=="function"&&(g=p[E]=_r.unbox(g));var G=yr(g,null);m=m||G.thisDep,o=o||G.propDep,h=h||G.contextDep}else{switch(b(l,".",E,"="),typeof g){case"number":b(g);break;case"string":b('"',g,'"');break;case"object":Array.isArray(g)&&b("[",g.join(),"]");break;default:b(f.link(g));break}b(";")}});function s(E,g){v.forEach(function(G){var B=p[G];if(_r.isDynamic(B)){var K=E.invoke(g,B);g(l,".",G,"=",K,";")}})}n.dynamic[d]=new _r.DynamicVariable(un,{thisDep:m,contextDep:h,propDep:o,ref:l,append:s}),delete n.static[d]}function Ge(f,n,d,p,b){var v=Le();v.stats=v.link(b),Object.keys(n.static).forEach(function(h){le(v,n,h)}),lu.forEach(function(h){le(v,f,h)});var m=er(f,n,d,p,v);return Ze(v,m),R(v,m),c(v,m),x(v.compile(),{destroy:function(){m.shader.program.destroy()}})}return{next:ae,current:fe,procs:function(){var f=Le(),n=f.proc("poll"),d=f.proc("refresh"),p=f.block();n(p),d(p);var b=f.shared,v=b.gl,m=b.next,h=b.current;p(h,".dirty=false;"),ar(f,n),ar(f,d,null,!0);var o;j&&(o=f.link(j)),u.oes_vertex_array_object&&d(f.link(u.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var l=0;l<w.maxAttributes;++l){var s=d.def(b.attributes,"[",l,"]"),E=f.cond(s,".buffer");E.then(v,".enableVertexAttribArray(",l,");",v,".bindBuffer(",Et,",",s,".buffer.buffer);",v,".vertexAttribPointer(",l,",",s,".size,",s,".type,",s,".normalized,",s,".stride,",s,".offset);").else(v,".disableVertexAttribArray(",l,");",v,".vertexAttrib4f(",l,",",s,".x,",s,".y,",s,".z,",s,".w);",s,".buffer=null;"),d(E),j&&d(o,".vertexAttribDivisorANGLE(",l,",",s,".divisor);")}return d(f.shared.vao,".currentVAO=null;",f.shared.vao,".setVAO(",f.shared.vao,".targetVAO);"),Object.keys(k).forEach(function(g){var G=k[g],B=p.def(m,".",g),K=f.block();K("if(",B,"){",v,".enable(",G,")}else{",v,".disable(",G,")}",h,".",g,"=",B,";"),d(K),n("if(",B,"!==",h,".",g,"){",K,"}")}),Object.keys(I).forEach(function(g){var G=I[g],B=fe[g],K,we,ge=f.block();if(ge(v,".",G,"("),He(B)){var ce=B.length;K=f.global.def(m,".",g),we=f.global.def(h,".",g),ge(xr(ce,function(M){return K+"["+M+"]"}),");",xr(ce,function(M){return we+"["+M+"]="+K+"["+M+"];"}).join("")),n("if(",xr(ce,function(M){return K+"["+M+"]!=="+we+"["+M+"]"}).join("||"),"){",ge,"}")}else K=p.def(m,".",g),we=p.def(h,".",g),ge(K,");",h,".",g,"=",K,";"),n("if(",K,"!==",we,"){",ge,"}");d(ge)}),f.compile()}(),compile:Ge}}function Cu(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ou=34918,Pu=34919,yo=35007,Fu=function(r,a){if(!a.ext_disjoint_timer_query)return null;var u=[];function w(){return u.pop()||a.ext_disjoint_timer_query.createQueryEXT()}function N(j){u.push(j)}var S=[];function P(j){var se=w();a.ext_disjoint_timer_query.beginQueryEXT(yo,se),S.push(se),V(S.length-1,S.length,j)}function $(){a.ext_disjoint_timer_query.endQueryEXT(yo)}function U(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var X=[];function Q(){return X.pop()||new U}function W(j){X.push(j)}var J=[];function V(j,se,z){var fe=Q();fe.startQueryIndex=j,fe.endQueryIndex=se,fe.sum=0,fe.stats=z,J.push(fe)}var H=[],y=[];function O(){var j,se,z=S.length;if(z!==0){y.length=Math.max(y.length,z+1),H.length=Math.max(H.length,z+1),H[0]=0,y[0]=0;var fe=0;for(j=0,se=0;se<S.length;++se){var ae=S[se];a.ext_disjoint_timer_query.getQueryObjectEXT(ae,Pu)?(fe+=a.ext_disjoint_timer_query.getQueryObjectEXT(ae,Ou),N(ae)):S[j++]=ae,H[se+1]=fe,y[se+1]=j}for(S.length=j,j=0,se=0;se<J.length;++se){var _e=J[se],k=_e.startQueryIndex,I=_e.endQueryIndex;_e.sum+=H[I]-H[k];var ue=y[k],ee=y[I];ee===ue?(_e.stats.gpuTime+=_e.sum/1e6,W(_e)):(_e.startQueryIndex=ue,_e.endQueryIndex=ee,J[j++]=_e)}J.length=j}}return{beginQuery:P,endQuery:$,pushScopeStats:V,update:O,getNumPendingQueries:function(){return S.length},clear:function(){u.push.apply(u,S);for(var j=0;j<u.length;j++)a.ext_disjoint_timer_query.deleteQueryEXT(u[j]);S.length=0,u.length=0},restore:function(){S.length=0,u.length=0}}},Gu=16384,Du=256,Iu=1024,Nu=34962,bo="webglcontextlost",go="webglcontextrestored",_o=1,ku=2,Bu=3;function xo(r,a){for(var u=0;u<r.length;++u)if(r[u]===a)return u;return-1}function Mu(r){var a=ks(r);if(!a)return null;var u=a.gl,w=u.getContextAttributes(),N=u.isContextLost(),S=Bs(u,a);if(!S)return null;var P=Fs(),$=Cu(),U=S.extensions,X=Fu(u,U),Q=Ri(),W=u.drawingBufferWidth,J=u.drawingBufferHeight,V={tick:0,time:0,viewportWidth:W,viewportHeight:J,framebufferWidth:W,framebufferHeight:J,drawingBufferWidth:W,drawingBufferHeight:J,pixelRatio:a.pixelRatio},H={},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},O=Sc(u,U),j=Uc(u,$,a,fe),se=Jc(u,U,j,$),z=Jl(u,U,O,$,j,se,y);function fe(Ee){return z.destroyBuffer(Ee)}var ae=nu(u,P,$,a),_e=Ol(u,U,O,function(){ue.procs.poll()},V,$,a),k=Pl(u,U,O,$,a),I=Zl(u,U,O,_e,k,$),ue=Lu(u,P,U,O,j,se,_e,I,H,z,ae,y,V,X,a),ee=fu(u,I,ue.procs.poll,V,w,U,O),q=ue.next,re=u.canvas,te=[],Ce=[],Le=[],ie=[a.onDestroy],oe=null;function Ae(){if(te.length===0){X&&X.update(),oe=null;return}oe=On.next(Ae),cr();for(var Ee=te.length-1;Ee>=0;--Ee){var Ie=te[Ee];Ie&&Ie(V,null,0)}u.flush(),X&&X.update()}function Oe(){!oe&&te.length>0&&(oe=On.next(Ae))}function De(){oe&&(On.cancel(Ae),oe=null)}function Xe(Ee){Ee.preventDefault(),N=!0,De(),Ce.forEach(function(Ie){Ie()})}function We(Ee){u.getError(),N=!1,S.restore(),ae.restore(),j.restore(),_e.restore(),k.restore(),I.restore(),z.restore(),X&&X.restore(),ue.procs.refresh(),Oe(),Le.forEach(function(Ie){Ie()})}re&&(re.addEventListener(bo,Xe,!1),re.addEventListener(go,We,!1));function Ne(){te.length=0,De(),re&&(re.removeEventListener(bo,Xe),re.removeEventListener(go,We)),ae.clear(),I.clear(),k.clear(),z.clear(),_e.clear(),se.clear(),j.clear(),X&&X.clear(),ie.forEach(function(Ee){Ee()})}function tr(Ee){i(!!Ee,"invalid args to regl({...})"),i.type(Ee,"object","invalid args to regl({...})");function Ie(b){var v=x({},b);delete v.uniforms,delete v.attributes,delete v.context,delete v.vao,"stencil"in v&&v.stencil.op&&(v.stencil.opBack=v.stencil.opFront=v.stencil.op,delete v.stencil.op);function m(h){if(h in v){var o=v[h];delete v[h],Object.keys(o).forEach(function(l){v[h+"."+l]=o[l]})}}return m("blend"),m("depth"),m("cull"),m("stencil"),m("polygonOffset"),m("scissor"),m("sample"),"vao"in b&&(v.vao=b.vao),v}function ze(b,v){var m={},h={};return Object.keys(b).forEach(function(o){var l=b[o];if(_r.isDynamic(l)){h[o]=_r.unbox(l,o);return}else if(v&&Array.isArray(l)){for(var s=0;s<l.length;++s)if(_r.isDynamic(l[s])){h[o]=_r.unbox(l,o);return}}m[o]=l}),{dynamic:h,static:m}}var Ze=ze(Ee.context||{},!0),Pr=ze(Ee.uniforms||{},!0),nt=ze(Ee.attributes||{},!1),c=ze(Ie(Ee),!1),R={gpuTime:0,cpuTime:0,count:0},A=ue.compile(c,nt,Pr,Ze,R),le=A.draw,Ge=A.batch,f=A.scope,n=[];function d(b){for(;n.length<b;)n.push(null);return n}function p(b,v){var m;if(N&&i.raise("context lost"),typeof b=="function")return f.call(this,null,b,0);if(typeof v=="function")if(typeof b=="number")for(m=0;m<b;++m)f.call(this,null,v,m);else if(Array.isArray(b))for(m=0;m<b.length;++m)f.call(this,b[m],v,m);else return f.call(this,b,v,0);else if(typeof b=="number"){if(b>0)return Ge.call(this,d(b|0),b|0)}else if(Array.isArray(b)){if(b.length)return Ge.call(this,b,b.length)}else return le.call(this,b)}return x(p,{stats:R,destroy:function(){A.destroy()}})}var qe=I.setFBO=tr({framebuffer:_r.define.call(null,_o,"framebuffer")});function er(Ee,Ie){var ze=0;ue.procs.poll();var Ze=Ie.color;Ze&&(u.clearColor(+Ze[0]||0,+Ze[1]||0,+Ze[2]||0,+Ze[3]||0),ze|=Gu),"depth"in Ie&&(u.clearDepth(+Ie.depth),ze|=Du),"stencil"in Ie&&(u.clearStencil(Ie.stencil|0),ze|=Iu),i(!!ze,"called regl.clear with no buffer specified"),u.clear(ze)}function nr(Ee){if(i(typeof Ee=="object"&&Ee,"regl.clear() takes an object as input"),"framebuffer"in Ee)if(Ee.framebuffer&&Ee.framebuffer_reglType==="framebufferCube")for(var Ie=0;Ie<6;++Ie)qe(x({framebuffer:Ee.framebuffer.faces[Ie]},Ee),er);else qe(Ee,er);else er(null,Ee)}function ar(Ee){i.type(Ee,"function","regl.frame() callback must be a function"),te.push(Ee);function Ie(){var ze=xo(te,Ee);i(ze>=0,"cannot cancel a frame twice");function Ze(){var Pr=xo(te,Ze);te[Pr]=te[te.length-1],te.length-=1,te.length<=0&&De()}te[ze]=Ze}return Oe(),{cancel:Ie}}function fr(){var Ee=q.viewport,Ie=q.scissor_box;Ee[0]=Ee[1]=Ie[0]=Ie[1]=0,V.viewportWidth=V.framebufferWidth=V.drawingBufferWidth=Ee[2]=Ie[2]=u.drawingBufferWidth,V.viewportHeight=V.framebufferHeight=V.drawingBufferHeight=Ee[3]=Ie[3]=u.drawingBufferHeight}function cr(){V.tick+=1,V.time=Pe(),fr(),ue.procs.poll()}function Qe(){_e.refresh(),fr(),ue.procs.refresh(),X&&X.update()}function Pe(){return(Ri()-Q)/1e3}Qe();function lr(Ee,Ie){i.type(Ie,"function","listener callback must be a function");var ze;switch(Ee){case"frame":return ar(Ie);case"lost":ze=Ce;break;case"restore":ze=Le;break;case"destroy":ze=ie;break;default:i.raise("invalid event, must be one of frame,lost,restore,destroy")}return ze.push(Ie),{cancel:function(){for(var Ze=0;Ze<ze.length;++Ze)if(ze[Ze]===Ie){ze[Ze]=ze[ze.length-1],ze.pop();return}}}}var Ue=x(tr,{clear:nr,prop:_r.define.bind(null,_o),context:_r.define.bind(null,ku),this:_r.define.bind(null,Bu),draw:tr({}),buffer:function(Ee){return j.create(Ee,Nu,!1,!1)},elements:function(Ee){return se.create(Ee,!1)},texture:_e.create2D,cube:_e.createCube,renderbuffer:k.create,framebuffer:I.create,framebufferCube:I.createCube,vao:z.createVAO,attributes:w,frame:ar,on:lr,limits:O,hasExtension:function(Ee){return O.extensions.indexOf(Ee.toLowerCase())>=0},read:ee,destroy:Ne,_gl:u,_refresh:Qe,poll:function(){cr(),X&&X.update()},now:Pe,stats:$});return a.onDone(null,Ue),Ue}return Mu})}(Ln)),Ln.exports}var $u=Uu();const Vu=jt($u),qu=L=>{const e=L({frag:`
      precision mediump float;
      uniform vec2 resolution;
      uniform vec2 u_position;
      uniform float scale;
      uniform float time;
      uniform sampler2D texture;
      uniform float rotationSpeed;
      uniform float displacementSpeed;
      uniform float displacementAmount;
      uniform float displacementFrequency;
      uniform float sphereActivity;

      float rand(vec2 n) { 
        return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);
      }
        
      float noise(vec2 n) {
        const vec2 d = vec2(0.0, 1.0);
        vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));
        return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);
      }

      void main() {
        vec2 uv = (gl_FragCoord.xy - resolution * u_position) / min(resolution.x, resolution.y); //   

        uv *= 1. / scale;
        
        float dist = length(uv);
        float angle = atan(uv.y,uv.x);
        
        vec2 ruv = uv;

        float rotationTime = time * rotationSpeed;
        float displacementTime = time * displacementSpeed;

        float noiseAmount = displacementAmount * sphereActivity;
        float noiseFreq = displacementFrequency * sphereActivity;
        float n = noise(vec2(abs(angle) * 2.0, dist * noiseFreq)) * noiseAmount;

        uv = vec2(
          cos(angle - rotationTime + (sin(displacementTime) * n)) * dist,
          sin(angle - rotationTime + (sin(displacementTime) * n)) * dist
        );

        uv += 0.5;

        vec4 textureColor = texture2D(texture, uv);
        vec4 backgroundColor = vec4(0.0, 0.0, 0.0, 1.0);
        vec4 finalColor = mix(textureColor, backgroundColor, dist * 1.8);

        gl_FragColor = finalColor;
      }
    `,vert:`
      precision mediump float;
      attribute vec2 position;
  
      void main() {
        gl_Position = vec4(position, 0, 1);
      }
    `,attributes:{position:[[-1,-1],[1,-1],[1,1],[-1,-1],[1,1],[-1,1]]},uniforms:{resolution:L.prop("resolution"),u_position:L.prop("u_position"),scale:L.prop("scale"),texture:L.prop("texture"),time:()=>performance.now()*.001,rotationSpeed:L.prop("rotationSpeed"),displacementSpeed:L.prop("displacementSpeed"),displacementAmount:L.prop("displacementAmount"),displacementFrequency:L.prop("displacementFrequency"),sphereActivity:L.prop("sphereActivity")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},count:6});return t=>{e(t),L.clear({depth:1}),L({depth:{enable:!0,mask:!0}})}},ju=L=>{const e=L({frag:`
      precision mediump float;
      uniform vec2 resolution;
      uniform vec2 u_position;
      uniform float scale;

      void main() {
        vec2 uv = (gl_FragCoord.xy - resolution * u_position) / resolution.y; //   
        float d = length(uv) / scale; // 

        float inner = smoothstep(0.1, 0.15, d);  //  
        float outer = smoothstep(0.2, 0.25, d);  //  
        float a = pow(1.0 - (distance(d, 0.423)), 15.0); //     

        vec3 lightColor = vec3(0.99);

        gl_FragColor = vec4(lightColor, a * 0.5);
      }
    `,vert:`
      precision mediump float;
      attribute vec2 position;
  
      void main() {
        gl_Position = vec4(position, 0, 1);
      }
    `,attributes:{position:[[-1,-1],[1,-1],[1,1],[-1,-1],[1,1],[-1,1]]},uniforms:{resolution:L.prop("resolution"),u_position:L.prop("u_position"),scale:L.prop("scale")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},count:6});return t=>{e(t),L.clear({depth:1}),L({depth:{enable:!0,mask:!0}})}};var Ra,So;function Hu(){return So||(So=1,Ra={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),Ra}var Xu=Hu();const Wu=jt(Xu);var La,wo;function Yu(){if(wo)return La;wo=1;const L="a-f\\d",e=`#?[${L}]{3}[${L}]?`,t=`#?[${L}]{6}([${L}]{2})?`,x=new RegExp(`[^#${L}]`,"gi"),_=new RegExp(`^${e}$|^${t}$`,"i");return La=(T,C={})=>{if(typeof T!="string"||x.test(T)||!_.test(T))throw new TypeError("Expected a valid hex string");T=T.replace(/^#/,"");let D=1;T.length===8&&(D=Number.parseInt(T.slice(6,8),16)/255,T=T.slice(0,6)),T.length===4&&(D=Number.parseInt(T.slice(3,4).repeat(2),16)/255,T=T.slice(0,3)),T.length===3&&(T=T[0]+T[0]+T[1]+T[1]+T[2]+T[2]);const Z=Number.parseInt(T,16),Y=Z>>16,ne=Z>>8&255,he=Z&255,me=typeof C.alpha=="number"?C.alpha:D;if(C.format==="array")return[Y,ne,he,me];if(C.format==="css"){const pe=me===1?"":` / ${Number((me*100).toFixed(2))}%`;return`rgb(${Y} ${ne} ${he}${pe})`}return{red:Y,green:ne,blue:he,alpha:me}},La}var Qu=Yu();const Zu=jt(Qu),Ku=/^#([a-f0-9]{3,4}|[a-f0-9]{4}(?:[a-f0-9]{2}){1,2})\b$/;var Ju=new RegExp(Ku,"i");const ui="-?\\d*(?:\\.\\d+)",Tt=`(${ui}?)`,Gr=`(${ui}?%)`,St=`(${ui}?%?)`,e0=`^
  hsla?\\(
    \\s*(-?\\d*(?:\\.\\d+)?(?:deg|rad|turn)?)\\s*,
    \\s*${Gr}\\s*,
    \\s*${Gr}\\s*
    (?:,\\s*${St}\\s*)?
  \\)
  $
`.replace(/\n|\s/g,"");var r0=new RegExp(e0);const t0=`^
  hsla?\\(
    \\s*(-?\\d*(?:\\.\\d+)?(?:deg|rad|turn)?)\\s*
    \\s+${Gr}
    \\s+${Gr}
    \\s*(?:\\s*\\/\\s*${St}\\s*)?
  \\)
  $
`.replace(/\n|\s/g,"");var n0=new RegExp(t0);const a0=`^
  rgba?\\(
    \\s*${Tt}\\s*,
    \\s*${Tt}\\s*,
    \\s*${Tt}\\s*
    (?:,\\s*${St}\\s*)?
  \\)
  $
`.replace(/\n|\s/g,"");var i0=new RegExp(a0);const f0=`^
  rgba?\\(
    \\s*${Gr}\\s*,
    \\s*${Gr}\\s*,
    \\s*${Gr}\\s*
    (?:,\\s*${St}\\s*)?
  \\)
  $
`.replace(/\n|\s/g,"");var o0=new RegExp(f0);const s0=`^
  rgba?\\(
    \\s*${Tt}
    \\s+${Tt}
    \\s+${Tt}
    \\s*(?:\\s*\\/\\s*${St}\\s*)?
  \\)
$
`.replace(/\n|\s/g,"");var c0=new RegExp(s0);const l0=`^
  rgba?\\(
    \\s*${Gr}
    \\s+${Gr}
    \\s+${Gr}
    \\s*(?:\\s*\\/\\s*${St}\\s*)?
  \\)
$
`.replace(/\n|\s/g,"");var u0=new RegExp(l0);const d0=/^transparent$/;var m0=new RegExp(d0,"i");const di=(L,e,t)=>Math.min(Math.max(e,L),t),v0=L=>{let e=L;return typeof e!="number"&&(e=e.endsWith("%")?parseFloat(e)*255/100:parseFloat(e)),di(Math.round(e),0,255)},Ro=L=>di(parseFloat(L),0,100);function ss(L){let e=L;return typeof e!="number"&&(e=e.endsWith("%")?parseFloat(e)/100:parseFloat(e)),di(e,0,1)}function h0(L){const[e,t,x,_]=Zu(L,{format:"array"});return Cn([null,e,t,x,_])}function p0([,L,e,t,x=1]){let _=L;return _.endsWith("turn")?_=parseFloat(_)*360/1:_.endsWith("rad")?_=Math.round(parseFloat(_)*180/Math.PI):_=parseFloat(_),{type:"hsl",values:[_,Ro(e),Ro(t)],alpha:ss(x===null?1:x)}}function Cn([,L,e,t,x=1]){return{type:"rgb",values:[L,e,t].map(v0),alpha:ss(x===null?1:x)}}/**
 * parse-css-color
 * @version v0.2.1
 * @link http://github.com/noeldelgado/parse-css-color/
 * @license MIT
 */const y0=L=>{const e=Ju.exec(L);if(e)return h0(e[0]);const t=n0.exec(L)||r0.exec(L);if(t)return p0(t);const x=c0.exec(L)||u0.exec(L)||i0.exec(L)||o0.exec(L);if(x)return Cn(x);if(m0.exec(L))return Cn([null,0,0,0,0]);const _=Wu[L.toLowerCase()];return _?Cn([null,_[0],_[1],_[2],1]):null};function b0(L){const e=y0(L);if(!e)throw new Error("Invalid color");return e.values.map(t=>t/255)}var Ca,Lo;function g0(){if(Lo)return Ca;Lo=1,Ca=L;function L(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return Ca}var Oa,Co;function _0(){if(Co)return Oa;Co=1,Oa=L;function L(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}return Oa}var Pa,Oo;function x0(){if(Oo)return Pa;Oo=1,Pa=L;function L(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}return Pa}var Fa,Po;function mi(){if(Po)return Fa;Po=1,Fa=L;function L(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return Fa}var Ga,Fo;function E0(){if(Fo)return Ga;Fo=1,Ga=L;function L(e,t){if(e===t){var x=t[1],_=t[2],T=t[3],C=t[6],D=t[7],Z=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=x,e[6]=t[9],e[7]=t[13],e[8]=_,e[9]=C,e[11]=t[14],e[12]=T,e[13]=D,e[14]=Z}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}return Ga}var Da,Go;function A0(){if(Go)return Da;Go=1,Da=L;function L(e,t){var x=t[0],_=t[1],T=t[2],C=t[3],D=t[4],Z=t[5],Y=t[6],ne=t[7],he=t[8],me=t[9],pe=t[10],be=t[11],ye=t[12],Re=t[13],xe=t[14],Se=t[15],Ve=x*Z-_*D,ke=x*Y-T*D,Fe=x*ne-C*D,Me=_*Y-T*Z,Be=_*ne-C*Z,rr=T*ne-C*Y,dr=he*Re-me*ye,or=he*xe-pe*ye,Ye=he*Se-be*ye,mr=me*xe-pe*Re,hr=me*Se-be*Re,vr=pe*Se-be*xe,je=Ve*vr-ke*hr+Fe*mr+Me*Ye-Be*or+rr*dr;return je?(je=1/je,e[0]=(Z*vr-Y*hr+ne*mr)*je,e[1]=(T*hr-_*vr-C*mr)*je,e[2]=(Re*rr-xe*Be+Se*Me)*je,e[3]=(pe*Be-me*rr-be*Me)*je,e[4]=(Y*Ye-D*vr-ne*or)*je,e[5]=(x*vr-T*Ye+C*or)*je,e[6]=(xe*Fe-ye*rr-Se*ke)*je,e[7]=(he*rr-pe*Fe+be*ke)*je,e[8]=(D*hr-Z*Ye+ne*dr)*je,e[9]=(_*Ye-x*hr-C*dr)*je,e[10]=(ye*Be-Re*Fe+Se*Ve)*je,e[11]=(me*Fe-he*Be-be*Ve)*je,e[12]=(Z*or-D*mr-Y*dr)*je,e[13]=(x*mr-_*or+T*dr)*je,e[14]=(Re*ke-ye*Me-xe*Ve)*je,e[15]=(he*Me-me*ke+pe*Ve)*je,e):null}return Da}var Ia,Do;function T0(){if(Do)return Ia;Do=1,Ia=L;function L(e,t){var x=t[0],_=t[1],T=t[2],C=t[3],D=t[4],Z=t[5],Y=t[6],ne=t[7],he=t[8],me=t[9],pe=t[10],be=t[11],ye=t[12],Re=t[13],xe=t[14],Se=t[15];return e[0]=Z*(pe*Se-be*xe)-me*(Y*Se-ne*xe)+Re*(Y*be-ne*pe),e[1]=-(_*(pe*Se-be*xe)-me*(T*Se-C*xe)+Re*(T*be-C*pe)),e[2]=_*(Y*Se-ne*xe)-Z*(T*Se-C*xe)+Re*(T*ne-C*Y),e[3]=-(_*(Y*be-ne*pe)-Z*(T*be-C*pe)+me*(T*ne-C*Y)),e[4]=-(D*(pe*Se-be*xe)-he*(Y*Se-ne*xe)+ye*(Y*be-ne*pe)),e[5]=x*(pe*Se-be*xe)-he*(T*Se-C*xe)+ye*(T*be-C*pe),e[6]=-(x*(Y*Se-ne*xe)-D*(T*Se-C*xe)+ye*(T*ne-C*Y)),e[7]=x*(Y*be-ne*pe)-D*(T*be-C*pe)+he*(T*ne-C*Y),e[8]=D*(me*Se-be*Re)-he*(Z*Se-ne*Re)+ye*(Z*be-ne*me),e[9]=-(x*(me*Se-be*Re)-he*(_*Se-C*Re)+ye*(_*be-C*me)),e[10]=x*(Z*Se-ne*Re)-D*(_*Se-C*Re)+ye*(_*ne-C*Z),e[11]=-(x*(Z*be-ne*me)-D*(_*be-C*me)+he*(_*ne-C*Z)),e[12]=-(D*(me*xe-pe*Re)-he*(Z*xe-Y*Re)+ye*(Z*pe-Y*me)),e[13]=x*(me*xe-pe*Re)-he*(_*xe-T*Re)+ye*(_*pe-T*me),e[14]=-(x*(Z*xe-Y*Re)-D*(_*xe-T*Re)+ye*(_*Y-T*Z)),e[15]=x*(Z*pe-Y*me)-D*(_*pe-T*me)+he*(_*Y-T*Z),e}return Ia}var Na,Io;function S0(){if(Io)return Na;Io=1,Na=L;function L(e){var t=e[0],x=e[1],_=e[2],T=e[3],C=e[4],D=e[5],Z=e[6],Y=e[7],ne=e[8],he=e[9],me=e[10],pe=e[11],be=e[12],ye=e[13],Re=e[14],xe=e[15],Se=t*D-x*C,Ve=t*Z-_*C,ke=t*Y-T*C,Fe=x*Z-_*D,Me=x*Y-T*D,Be=_*Y-T*Z,rr=ne*ye-he*be,dr=ne*Re-me*be,or=ne*xe-pe*be,Ye=he*Re-me*ye,mr=he*xe-pe*ye,hr=me*xe-pe*Re;return Se*hr-Ve*mr+ke*Ye+Fe*or-Me*dr+Be*rr}return Na}var ka,No;function w0(){if(No)return ka;No=1,ka=L;function L(e,t,x){var _=t[0],T=t[1],C=t[2],D=t[3],Z=t[4],Y=t[5],ne=t[6],he=t[7],me=t[8],pe=t[9],be=t[10],ye=t[11],Re=t[12],xe=t[13],Se=t[14],Ve=t[15],ke=x[0],Fe=x[1],Me=x[2],Be=x[3];return e[0]=ke*_+Fe*Z+Me*me+Be*Re,e[1]=ke*T+Fe*Y+Me*pe+Be*xe,e[2]=ke*C+Fe*ne+Me*be+Be*Se,e[3]=ke*D+Fe*he+Me*ye+Be*Ve,ke=x[4],Fe=x[5],Me=x[6],Be=x[7],e[4]=ke*_+Fe*Z+Me*me+Be*Re,e[5]=ke*T+Fe*Y+Me*pe+Be*xe,e[6]=ke*C+Fe*ne+Me*be+Be*Se,e[7]=ke*D+Fe*he+Me*ye+Be*Ve,ke=x[8],Fe=x[9],Me=x[10],Be=x[11],e[8]=ke*_+Fe*Z+Me*me+Be*Re,e[9]=ke*T+Fe*Y+Me*pe+Be*xe,e[10]=ke*C+Fe*ne+Me*be+Be*Se,e[11]=ke*D+Fe*he+Me*ye+Be*Ve,ke=x[12],Fe=x[13],Me=x[14],Be=x[15],e[12]=ke*_+Fe*Z+Me*me+Be*Re,e[13]=ke*T+Fe*Y+Me*pe+Be*xe,e[14]=ke*C+Fe*ne+Me*be+Be*Se,e[15]=ke*D+Fe*he+Me*ye+Be*Ve,e}return ka}var Ba,ko;function R0(){if(ko)return Ba;ko=1,Ba=L;function L(e,t,x){var _=x[0],T=x[1],C=x[2],D,Z,Y,ne,he,me,pe,be,ye,Re,xe,Se;return t===e?(e[12]=t[0]*_+t[4]*T+t[8]*C+t[12],e[13]=t[1]*_+t[5]*T+t[9]*C+t[13],e[14]=t[2]*_+t[6]*T+t[10]*C+t[14],e[15]=t[3]*_+t[7]*T+t[11]*C+t[15]):(D=t[0],Z=t[1],Y=t[2],ne=t[3],he=t[4],me=t[5],pe=t[6],be=t[7],ye=t[8],Re=t[9],xe=t[10],Se=t[11],e[0]=D,e[1]=Z,e[2]=Y,e[3]=ne,e[4]=he,e[5]=me,e[6]=pe,e[7]=be,e[8]=ye,e[9]=Re,e[10]=xe,e[11]=Se,e[12]=D*_+he*T+ye*C+t[12],e[13]=Z*_+me*T+Re*C+t[13],e[14]=Y*_+pe*T+xe*C+t[14],e[15]=ne*_+be*T+Se*C+t[15]),e}return Ba}var Ma,Bo;function L0(){if(Bo)return Ma;Bo=1,Ma=L;function L(e,t,x){var _=x[0],T=x[1],C=x[2];return e[0]=t[0]*_,e[1]=t[1]*_,e[2]=t[2]*_,e[3]=t[3]*_,e[4]=t[4]*T,e[5]=t[5]*T,e[6]=t[6]*T,e[7]=t[7]*T,e[8]=t[8]*C,e[9]=t[9]*C,e[10]=t[10]*C,e[11]=t[11]*C,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}return Ma}var za,Mo;function C0(){if(Mo)return za;Mo=1,za=L;function L(e,t,x,_){var T=_[0],C=_[1],D=_[2],Z=Math.sqrt(T*T+C*C+D*D),Y,ne,he,me,pe,be,ye,Re,xe,Se,Ve,ke,Fe,Me,Be,rr,dr,or,Ye,mr,hr,vr,je,jr;return Math.abs(Z)<1e-6?null:(Z=1/Z,T*=Z,C*=Z,D*=Z,Y=Math.sin(x),ne=Math.cos(x),he=1-ne,me=t[0],pe=t[1],be=t[2],ye=t[3],Re=t[4],xe=t[5],Se=t[6],Ve=t[7],ke=t[8],Fe=t[9],Me=t[10],Be=t[11],rr=T*T*he+ne,dr=C*T*he+D*Y,or=D*T*he-C*Y,Ye=T*C*he-D*Y,mr=C*C*he+ne,hr=D*C*he+T*Y,vr=T*D*he+C*Y,je=C*D*he-T*Y,jr=D*D*he+ne,e[0]=me*rr+Re*dr+ke*or,e[1]=pe*rr+xe*dr+Fe*or,e[2]=be*rr+Se*dr+Me*or,e[3]=ye*rr+Ve*dr+Be*or,e[4]=me*Ye+Re*mr+ke*hr,e[5]=pe*Ye+xe*mr+Fe*hr,e[6]=be*Ye+Se*mr+Me*hr,e[7]=ye*Ye+Ve*mr+Be*hr,e[8]=me*vr+Re*je+ke*jr,e[9]=pe*vr+xe*je+Fe*jr,e[10]=be*vr+Se*je+Me*jr,e[11]=ye*vr+Ve*je+Be*jr,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}return za}var Ua,zo;function O0(){if(zo)return Ua;zo=1,Ua=L;function L(e,t,x){var _=Math.sin(x),T=Math.cos(x),C=t[4],D=t[5],Z=t[6],Y=t[7],ne=t[8],he=t[9],me=t[10],pe=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=C*T+ne*_,e[5]=D*T+he*_,e[6]=Z*T+me*_,e[7]=Y*T+pe*_,e[8]=ne*T-C*_,e[9]=he*T-D*_,e[10]=me*T-Z*_,e[11]=pe*T-Y*_,e}return Ua}var $a,Uo;function cs(){if(Uo)return $a;Uo=1,$a=L;function L(e,t,x){var _=Math.sin(x),T=Math.cos(x),C=t[0],D=t[1],Z=t[2],Y=t[3],ne=t[8],he=t[9],me=t[10],pe=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=C*T-ne*_,e[1]=D*T-he*_,e[2]=Z*T-me*_,e[3]=Y*T-pe*_,e[8]=C*_+ne*T,e[9]=D*_+he*T,e[10]=Z*_+me*T,e[11]=Y*_+pe*T,e}return $a}var Va,$o;function ls(){if($o)return Va;$o=1,Va=L;function L(e,t,x){var _=Math.sin(x),T=Math.cos(x),C=t[0],D=t[1],Z=t[2],Y=t[3],ne=t[4],he=t[5],me=t[6],pe=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=C*T+ne*_,e[1]=D*T+he*_,e[2]=Z*T+me*_,e[3]=Y*T+pe*_,e[4]=ne*T-C*_,e[5]=he*T-D*_,e[6]=me*T-Z*_,e[7]=pe*T-Y*_,e}return Va}var qa,Vo;function P0(){if(Vo)return qa;Vo=1,qa=L;function L(e,t,x){var _,T,C,D=x[0],Z=x[1],Y=x[2],ne=Math.sqrt(D*D+Z*Z+Y*Y);return Math.abs(ne)<1e-6?null:(ne=1/ne,D*=ne,Z*=ne,Y*=ne,_=Math.sin(t),T=Math.cos(t),C=1-T,e[0]=D*D*C+T,e[1]=Z*D*C+Y*_,e[2]=Y*D*C-Z*_,e[3]=0,e[4]=D*Z*C-Y*_,e[5]=Z*Z*C+T,e[6]=Y*Z*C+D*_,e[7]=0,e[8]=D*Y*C+Z*_,e[9]=Z*Y*C-D*_,e[10]=Y*Y*C+T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}return qa}var ja,qo;function F0(){if(qo)return ja;qo=1,ja=L;function L(e,t,x){var _=t[0],T=t[1],C=t[2],D=t[3],Z=_+_,Y=T+T,ne=C+C,he=_*Z,me=_*Y,pe=_*ne,be=T*Y,ye=T*ne,Re=C*ne,xe=D*Z,Se=D*Y,Ve=D*ne;return e[0]=1-(be+Re),e[1]=me+Ve,e[2]=pe-Se,e[3]=0,e[4]=me-Ve,e[5]=1-(he+Re),e[6]=ye+xe,e[7]=0,e[8]=pe+Se,e[9]=ye-xe,e[10]=1-(he+be),e[11]=0,e[12]=x[0],e[13]=x[1],e[14]=x[2],e[15]=1,e}return ja}var Ha,jo;function G0(){if(jo)return Ha;jo=1,Ha=L;function L(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return Ha}var Xa,Ho;function D0(){if(Ho)return Xa;Ho=1,Xa=L;function L(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}return Xa}var Wa,Xo;function I0(){if(Xo)return Wa;Xo=1,Wa=L;function L(e,t){var x=Math.sin(t),_=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=_,e[6]=x,e[7]=0,e[8]=0,e[9]=-x,e[10]=_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return Wa}var Ya,Wo;function N0(){if(Wo)return Ya;Wo=1,Ya=L;function L(e,t){var x=Math.sin(t),_=Math.cos(t);return e[0]=_,e[1]=0,e[2]=-x,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=x,e[9]=0,e[10]=_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return Ya}var Qa,Yo;function k0(){if(Yo)return Qa;Yo=1,Qa=L;function L(e,t){var x=Math.sin(t),_=Math.cos(t);return e[0]=_,e[1]=x,e[2]=0,e[3]=0,e[4]=-x,e[5]=_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return Qa}var Za,Qo;function B0(){if(Qo)return Za;Qo=1,Za=L;function L(e,t){var x=t[0],_=t[1],T=t[2],C=t[3],D=x+x,Z=_+_,Y=T+T,ne=x*D,he=_*D,me=_*Z,pe=T*D,be=T*Z,ye=T*Y,Re=C*D,xe=C*Z,Se=C*Y;return e[0]=1-me-ye,e[1]=he+Se,e[2]=pe-xe,e[3]=0,e[4]=he-Se,e[5]=1-ne-ye,e[6]=be+Re,e[7]=0,e[8]=pe+xe,e[9]=be-Re,e[10]=1-ne-me,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return Za}var Ka,Zo;function M0(){if(Zo)return Ka;Zo=1,Ka=L;function L(e,t,x,_,T,C,D){var Z=1/(x-t),Y=1/(T-_),ne=1/(C-D);return e[0]=C*2*Z,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=C*2*Y,e[6]=0,e[7]=0,e[8]=(x+t)*Z,e[9]=(T+_)*Y,e[10]=(D+C)*ne,e[11]=-1,e[12]=0,e[13]=0,e[14]=D*C*2*ne,e[15]=0,e}return Ka}var Ja,Ko;function z0(){if(Ko)return Ja;Ko=1,Ja=L;function L(e,t,x,_,T){var C=1/Math.tan(t/2),D=1/(_-T);return e[0]=C/x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=C,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(T+_)*D,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*T*_*D,e[15]=0,e}return Ja}var ei,Jo;function U0(){if(Jo)return ei;Jo=1,ei=L;function L(e,t,x,_){var T=Math.tan(t.upDegrees*Math.PI/180),C=Math.tan(t.downDegrees*Math.PI/180),D=Math.tan(t.leftDegrees*Math.PI/180),Z=Math.tan(t.rightDegrees*Math.PI/180),Y=2/(D+Z),ne=2/(T+C);return e[0]=Y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=ne,e[6]=0,e[7]=0,e[8]=-((D-Z)*Y*.5),e[9]=(T-C)*ne*.5,e[10]=_/(x-_),e[11]=-1,e[12]=0,e[13]=0,e[14]=_*x/(x-_),e[15]=0,e}return ei}var ri,es;function $0(){if(es)return ri;es=1,ri=L;function L(e,t,x,_,T,C,D){var Z=1/(t-x),Y=1/(_-T),ne=1/(C-D);return e[0]=-2*Z,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*Y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*ne,e[11]=0,e[12]=(t+x)*Z,e[13]=(T+_)*Y,e[14]=(D+C)*ne,e[15]=1,e}return ri}var ti,rs;function V0(){if(rs)return ti;rs=1;var L=mi();ti=e;function e(t,x,_,T){var C,D,Z,Y,ne,he,me,pe,be,ye,Re=x[0],xe=x[1],Se=x[2],Ve=T[0],ke=T[1],Fe=T[2],Me=_[0],Be=_[1],rr=_[2];return Math.abs(Re-Me)<1e-6&&Math.abs(xe-Be)<1e-6&&Math.abs(Se-rr)<1e-6?L(t):(me=Re-Me,pe=xe-Be,be=Se-rr,ye=1/Math.sqrt(me*me+pe*pe+be*be),me*=ye,pe*=ye,be*=ye,C=ke*be-Fe*pe,D=Fe*me-Ve*be,Z=Ve*pe-ke*me,ye=Math.sqrt(C*C+D*D+Z*Z),ye?(ye=1/ye,C*=ye,D*=ye,Z*=ye):(C=0,D=0,Z=0),Y=pe*Z-be*D,ne=be*C-me*Z,he=me*D-pe*C,ye=Math.sqrt(Y*Y+ne*ne+he*he),ye?(ye=1/ye,Y*=ye,ne*=ye,he*=ye):(Y=0,ne=0,he=0),t[0]=C,t[1]=Y,t[2]=me,t[3]=0,t[4]=D,t[5]=ne,t[6]=pe,t[7]=0,t[8]=Z,t[9]=he,t[10]=be,t[11]=0,t[12]=-(C*Re+D*xe+Z*Se),t[13]=-(Y*Re+ne*xe+he*Se),t[14]=-(me*Re+pe*xe+be*Se),t[15]=1,t)}return ti}var ni,ts;function q0(){if(ts)return ni;ts=1,ni=L;function L(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}return ni}var ai,ns;function j0(){return ns||(ns=1,ai={create:g0(),clone:_0(),copy:x0(),identity:mi(),transpose:E0(),invert:A0(),adjoint:T0(),determinant:S0(),multiply:w0(),translate:R0(),scale:L0(),rotate:C0(),rotateX:O0(),rotateY:cs(),rotateZ:ls(),fromRotation:P0(),fromRotationTranslation:F0(),fromScaling:G0(),fromTranslation:D0(),fromXRotation:I0(),fromYRotation:N0(),fromZRotation:k0(),fromQuat:B0(),frustum:M0(),perspective:z0(),perspectiveFromFieldOfView:U0(),ortho:$0(),lookAt:V0(),str:q0()}),ai}var H0=j0();const ot=jt(H0);var ii,as;function X0(){if(as)return ii;as=1,ii=L;function L(e,t,x){return e[0]=t[0]*x,e[1]=t[1]*x,e[2]=t[2]*x,e}return ii}var fi,is;function W0(){if(is)return fi;is=1,fi=L;function L(e,t,x){var _=t[0],T=t[1],C=t[2],D=x[3]*_+x[7]*T+x[11]*C+x[15];return D=D||1,e[0]=(x[0]*_+x[4]*T+x[8]*C+x[12])/D,e[1]=(x[1]*_+x[5]*T+x[9]*C+x[13])/D,e[2]=(x[2]*_+x[6]*T+x[10]*C+x[14])/D,e}return fi}var oi,fs;function Y0(){if(fs)return oi;fs=1,oi=L;function L(e,t){var x=t[0],_=t[1],T=t[2],C=x*x+_*_+T*T;return C>0&&(C=1/Math.sqrt(C),e[0]=t[0]*C,e[1]=t[1]*C,e[2]=t[2]*C),e}return oi}var si,os;function Q0(){if(os)return si;os=1;var L=mi(),e=cs(),t=ls(),x=X0(),_=W0(),T=Y0(),C=L([]),D=L([]),Z=[0,1,0],Y=[0,0,0];si=ne;function ne(he,me){me=me||{},he=typeof he<"u"?he:1;for(var pe=typeof me.segments<"u"?me.segments:32,be=2+pe,ye=2*be,Re=[],xe=[],Se=[],Ve=[],ke=0;ke<=be;ke++){for(var Fe=ke/be,Me=Fe*Math.PI,Be=0;Be<=ye;Be++){var rr=Be/ye,dr=rr*Math.PI*2;L(D),t(D,D,-Me),L(C),e(C,C,dr),_(Y,Z,D),_(Y,Y,C),x(Y,Y,-he),xe.push(Y.slice()),T(Y,Y),Se.push(Y.slice()),Ve.push([rr,Fe])}if(ke>0)for(var or=xe.length,Ye=or-2*(ye+1);Ye+ye+2<or;Ye++)Re.push([Ye,Ye+1,Ye+ye+1]),Re.push([Ye+ye+1,Ye+1,Ye+ye+2])}return{cells:Re,positions:xe,normals:Se,uvs:Ve}}return si}var Z0=Q0();const K0=jt(Z0),J0=`precision mediump float;
varying vec3 vNormal;
varying vec3 vLightDir;
varying vec3 vPosition;
varying vec3 vWorldPosition;
varying vec2 vUv;
varying float vLight;
varying vec3 vViewDir;

uniform vec3 baseColor;
uniform vec3 glossColor;
uniform vec3 specularColor;
uniform float metalness;
uniform float glossiness;

uniform vec4 color;

#define COLOR_CORRECTION 0.00392156862745098

vec3 getColor(vec3 c) {
  return c * COLOR_CORRECTION;
}

void main() {
  //   
  vec3 reflected = normalize(reflect(vViewDir, vNormal));
  vec2 uv = 1.0 - (0.5 + 0.5 * reflected.xy);

  //  
  vec3 metalColor = mix(color.rgb, getColor(specularColor), metalness);

    //  
  vec3 lighting = metalColor * vLight;

    //   
  float fresnel = pow((1.0 - dot(vNormal, vViewDir)), 3.0);

  //     
  float edgeFactor = pow(abs(dot(vNormal, vec3(0.0, 1.0, 0.0))), 0.001); //   
  float glossSpecular = pow(max(dot(reflected, vViewDir), 0.0), 3.0) * glossiness * edgeFactor;
  vec3 glossEffect = getColor(glossColor) * glossSpecular;

  gl_FragColor = vec4(
    vec3(getColor(baseColor) * metalness)
    + lighting * metalness
    + vec3(1.0) * glossEffect
    + vec3(0.9) * fresnel
    ,
    1.0
  );
}
`,ed=`precision mediump float;
attribute vec3 position;
attribute vec3 normal;
attribute vec2 uv;  //  

uniform mat4 projection, view, model;
uniform vec3 lightPosition;
uniform float time;
uniform float frequency;
uniform float amplitude;
uniform vec3 modelCenter;
uniform vec3 scale;
// uniform vec2 mouseStack[5];

uniform float noiseDensity;
uniform float timeScale;
uniform float noiseAmplitude;
uniform float noiseDensity2;
uniform float noiseAmplitude2;

varying vec3 vNormal;
varying vec3 vLightDir;
varying vec3 vWorldPosition;
varying vec3 vPosition;
varying vec2 vUv;
varying float vLight;
varying vec3 vViewDir;

#define PI 3.14159265358979323846

float getLight(vec3 lightPosition, vec3 position, vec3 normal) {
  vec3 lightDir = normalize(lightPosition - position + modelCenter);

  //   (Lambert)
  float diff = max(dot(normal, lightDir), 0.0);
  return diff;
}

float wave(float wavePosition, float step) {
    float waveStep = 1.0 - smoothstep(0.1, 0.27, abs(mod(wavePosition, step)));

    return sin(frequency * wavePosition) * (amplitude * waveStep);
}

// float getWavePosition(int index, vec3 position) {
//     vec2 cursor = vec2(mouseStack[index]);
//     vec3 waveCenter = normalize(vec3(cursor.x, 1.0, -cursor.y)); //    

//     return dot(position.xyz * 1.5, waveCenter);
// }

//	Classic Perlin 3D Noise 
//	by Stefan Gustavson
//
vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
vec4 fade(vec4 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}

float cnoise(vec4 P){
  vec4 Pi0 = floor(P); // Integer part for indexing
  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1
  Pi0 = mod(Pi0, 289.0);
  Pi1 = mod(Pi1, 289.0);
  vec4 Pf0 = fract(P); // Fractional part for interpolation
  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = vec4(Pi0.zzzz);
  vec4 iz1 = vec4(Pi1.zzzz);
  vec4 iw0 = vec4(Pi0.wwww);
  vec4 iw1 = vec4(Pi1.wwww);

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);
  vec4 ixy00 = permute(ixy0 + iw0);
  vec4 ixy01 = permute(ixy0 + iw1);
  vec4 ixy10 = permute(ixy1 + iw0);
  vec4 ixy11 = permute(ixy1 + iw1);

  vec4 gx00 = ixy00 / 7.0;
  vec4 gy00 = floor(gx00) / 7.0;
  vec4 gz00 = floor(gy00) / 6.0;
  gx00 = fract(gx00) - 0.5;
  gy00 = fract(gy00) - 0.5;
  gz00 = fract(gz00) - 0.5;
  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);
  vec4 sw00 = step(gw00, vec4(0.0));
  gx00 -= sw00 * (step(0.0, gx00) - 0.5);
  gy00 -= sw00 * (step(0.0, gy00) - 0.5);

  vec4 gx01 = ixy01 / 7.0;
  vec4 gy01 = floor(gx01) / 7.0;
  vec4 gz01 = floor(gy01) / 6.0;
  gx01 = fract(gx01) - 0.5;
  gy01 = fract(gy01) - 0.5;
  gz01 = fract(gz01) - 0.5;
  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);
  vec4 sw01 = step(gw01, vec4(0.0));
  gx01 -= sw01 * (step(0.0, gx01) - 0.5);
  gy01 -= sw01 * (step(0.0, gy01) - 0.5);

  vec4 gx10 = ixy10 / 7.0;
  vec4 gy10 = floor(gx10) / 7.0;
  vec4 gz10 = floor(gy10) / 6.0;
  gx10 = fract(gx10) - 0.5;
  gy10 = fract(gy10) - 0.5;
  gz10 = fract(gz10) - 0.5;
  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);
  vec4 sw10 = step(gw10, vec4(0.0));
  gx10 -= sw10 * (step(0.0, gx10) - 0.5);
  gy10 -= sw10 * (step(0.0, gy10) - 0.5);

  vec4 gx11 = ixy11 / 7.0;
  vec4 gy11 = floor(gx11) / 7.0;
  vec4 gz11 = floor(gy11) / 6.0;
  gx11 = fract(gx11) - 0.5;
  gy11 = fract(gy11) - 0.5;
  gz11 = fract(gz11) - 0.5;
  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);
  vec4 sw11 = step(gw11, vec4(0.0));
  gx11 -= sw11 * (step(0.0, gx11) - 0.5);
  gy11 -= sw11 * (step(0.0, gy11) - 0.5);

  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);
  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);
  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);
  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);
  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);
  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);
  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);
  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);
  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);
  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);
  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);
  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);
  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);
  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);
  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);
  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);

  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));
  g0000 *= norm00.x;
  g0100 *= norm00.y;
  g1000 *= norm00.z;
  g1100 *= norm00.w;

  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));
  g0001 *= norm01.x;
  g0101 *= norm01.y;
  g1001 *= norm01.z;
  g1101 *= norm01.w;

  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));
  g0010 *= norm10.x;
  g0110 *= norm10.y;
  g1010 *= norm10.z;
  g1110 *= norm10.w;

  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));
  g0011 *= norm11.x;
  g0111 *= norm11.y;
  g1011 *= norm11.z;
  g1111 *= norm11.w;

  float n0000 = dot(g0000, Pf0);
  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));
  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));
  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));
  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));
  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));
  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));
  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));
  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));
  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));
  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));
  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));
  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));
  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));
  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));
  float n1111 = dot(g1111, Pf1);

  vec4 fade_xyzw = fade(Pf0);
  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);
  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);
  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);
  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);
  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);
  return 2.2 * n_xyzw;
}

const float radius = 1.0;

float noise(vec3 p, float noiseDensity){
    return cnoise(vec4(p * noiseDensity, time * timeScale));
}

vec3 getPos(vec3 p) {
    float n1 = noise(p, noiseDensity) * noiseAmplitude;
    float n2 = noise(p, noiseDensity2) * noiseAmplitude2;

    return p * (radius + n1 - n2);
}

void main() {
    //    
    vec4 worldPos = model * vec4(position, 1.0);
    vec3 displacedPosition = getPos(position);
    vec4 morphedLocalPos = vec4(displacedPosition, 1.0);

    //   model-,  
    vec4 morphedWorldPos = model * morphedLocalPos;

    float theta = .1; 
    vec3 vecTangent = normalize(cross(displacedPosition, vec3(1.0, 0.0, 0.0)) + cross(displacedPosition, vec3(0.0, 1.0, 0.0)));
    vec3 vecBitangent = normalize(cross(vecTangent, displacedPosition));
    vec3 ptTangentSample = getPos(normalize(displacedPosition + theta * normalize(vecTangent)));
    vec3 ptBitangentSample = getPos(normalize(displacedPosition + theta * normalize(vecBitangent)));

    vec3 sphereNormal = normalize(cross(ptBitangentSample - displacedPosition, ptTangentSample - displacedPosition));

    //   
    vNormal = normalize(mat3(model) * sphereNormal);
    vWorldPosition = morphedWorldPos.xyz;
    vPosition = morphedLocalPos.xyz;
    vUv = uv;

    vLight = 0.0;
    vLightDir = normalize(lightPosition - morphedWorldPos.xyz);
    float lightZ = -0.25 + scale.z;

    for(float angle = 0.0; angle < PI * 1.99; angle+=PI * 0.25) {
        vec3 lightPosition = vec3(cos(angle), sin(angle), lightZ);
        vLight += getLight(lightPosition, morphedWorldPos.xyz, vNormal);
    }

    vViewDir = normalize(vec3(0.0, 0.0, 3.0) - vPosition);

    gl_Position = projection * view * morphedWorldPos;
}`,rd=L=>{const e=K0(1,{segments:128});return L({depth:{},vert:ed,frag:J0,attributes:{position:e.positions,normal:e.normals,uv:e.uvs},elements:e.cells,uniforms:{projection:({viewportWidth:t,viewportHeight:x})=>ot.perspective([],Math.PI/4,t/x,.01,10),view:()=>ot.lookAt([],[0,0,3],[0,0,0],[0,1,0]),model:({},t)=>{const x=ot.identity([]);return ot.translate(x,x,t.modelCenter),ot.rotateY(x,x,t.rotation[1]),ot.rotateX(x,x,Math.PI*.5+t.rotation[0]),ot.scale(x,x,t.scale),x},time:({},t)=>performance.now()*.001+t.tickOffset,color:L.prop("color"),modelCenter:L.prop("modelCenter"),lightPosition:L.prop("lightPosition"),scale:L.prop("scale"),frequency:L.prop("frequency"),amplitude:L.prop("amplitude"),diffuseMap:L.prop("diffuseMap"),mouseStack:L.prop("mouseStack"),noiseDensity:L.prop("noiseDensity"),noiseDensity2:L.prop("noiseDensity2"),timeScale:L.prop("timeScale"),noiseAmplitude:L.prop("noiseAmplitude"),noiseAmplitude2:L.prop("noiseAmplitude2"),baseColor:L.prop("baseColor"),glossColor:L.prop("glossColor"),specularColor:L.prop("specularColor"),metalness:L.prop("metalness"),glossiness:L.prop("glossiness")}})};class td{spherePresets=[{noiseDensity:6.15,timeScale:1.3,noiseAmplitude:.01,noiseDensity2:5.18,noiseAmplitude2:.005,metalness:.52,glossiness:.06},{noiseDensity:2.54,timeScale:1.3,noiseAmplitude:.093,noiseDensity2:1.52,noiseAmplitude2:.02,metalness:.46,glossiness:0},{noiseDensity:2.54,timeScale:1.3,noiseAmplitude:.093,noiseDensity2:8.2,noiseAmplitude2:.02,metalness:.46,glossiness:0},{noiseDensity:4.2,timeScale:1.3,noiseAmplitude:.093,noiseDensity2:2.54,noiseAmplitude2:.02,metalness:.46,glossiness:0}];sphereState={presetIndex:0,targetPresetIndex:0};sphereProps={rotation:[0,0,0],scale:[1,1,1],color:[...b0("rgb(28, 28, 29)"),1],tickOffset:.1,modelCenter:[0,0,0],lightPosition:[0,0,0],frequency:5,amplitude:.09,baseColor:[0,0,0],glossColor:[255,255,255],specularColor:[80,80,80],...this.spherePresets[this.sphereState.presetIndex]};drawLiquidSphere;regl;constructor(e){this.regl=e,this.drawLiquidSphere=rd(e)}setScale(e){this.sphereProps.scale=[e,e,e]}presetChangeInterval=null;animationStartTime=null;setPresetIndex(e,t=3e3){if(this.presetChangeInterval&&(clearInterval(this.presetChangeInterval),this.presetChangeInterval=null),this.sphereState.targetPresetIndex===e)return;this.sphereState.targetPresetIndex=e;const x={noiseDensity:this.sphereProps.noiseDensity,timeScale:this.sphereProps.timeScale,noiseAmplitude:this.sphereProps.noiseAmplitude,noiseDensity2:this.sphereProps.noiseDensity2,noiseAmplitude2:this.sphereProps.noiseAmplitude2,metalness:this.sphereProps.metalness,glossiness:this.sphereProps.glossiness},_=this.spherePresets[e],T=C=>C;this.animationStartTime=performance.now(),this.presetChangeInterval=setInterval(()=>{if(!this.animationStartTime){clearInterval(this.presetChangeInterval),this.presetChangeInterval=null;return}const C=Math.min((performance.now()-this.animationStartTime)/t,1);Object.entries(x).forEach(([D,Z])=>{const Y=_[D];this.sphereProps[D]=Z+(Y-Z)*T(C)}),C===1&&(clearInterval(this.presetChangeInterval),this.presetChangeInterval=null,this.animationStartTime=null,this.sphereState.presetIndex=e)},40)}setOpacity(e){this.sphereProps.color=[...this.sphereProps.color.slice(0,3),e]}setPosition(e){this.sphereProps.modelCenter=e}destroy(){this.presetChangeInterval&&(clearInterval(this.presetChangeInterval),this.presetChangeInterval=null),this.animationStartTime=null}render(){this.drawLiquidSphere(this.sphereProps)}}const vi={},ci={},nd=(L,e)=>(ci[e]||(ci[e]=L?.texture({data:vi[e],premultiplyAlpha:!0,wrapS:"repeat",wrapT:"repeat"})),ci[e]),ad=L=>{const e=[];let t=L.length;return new Promise(x=>{L.forEach((_,T)=>{const C=new Image;C.crossOrigin="anonymous",C.onload=()=>{e[T]=C,t--,t===0&&x(e)},C.src=_})})},pr=document.querySelector("#app"),qt=Vu({container:pr,pixelRatio:Math.min(1,globalThis.devicePixelRatio),extensions:["ANGLE_instanced_arrays"]}),id="https://static.tildacdn.com/tild3362-3062-4763-a637-666663313038/background_vo89io.jpeg";ad([id]).then(([L])=>{vi.background=L});const fd=ju(qt),od=qu(qt),Lr=new td(qt);let qr=null;const Rn=15e3/4,hi=L=>{Lr.setPresetIndex(0,L),qr=setTimeout(()=>{Lr.setPresetIndex(1),qr=setTimeout(()=>{Lr.setPresetIndex(2),qr=setTimeout(()=>{Lr.setPresetIndex(3),qr=setTimeout(()=>{hi()},Rn)},Rn)},Rn)},Rn)};hi();document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{const L=document.querySelector(".hero-button"),e=document.querySelector(".uc-innovations"),t=pr.parentElement;e&&new IntersectionObserver(_=>{_.forEach(T=>{pr&&(T.isIntersecting?(pr.parentNode!==e&&e.appendChild(pr),t&&pr.parentNode===t&&t.removeChild(pr)):(t&&pr.parentNode!==t&&t.appendChild(pr),pr.parentNode===e&&e.removeChild(pr)))})}).observe(e),L?.addEventListener("mouseenter",()=>{Lr.sphereState.targetPresetIndex!==3&&(qr&&clearTimeout(qr),Lr.setPresetIndex(3,2e3))}),L?.addEventListener("mouseleave",()=>{Lr.sphereState.targetPresetIndex===3&&(qr&&clearTimeout(qr),hi(1e3))})},500)});const sd={rotationSpeed:.3,displacementSpeed:.23,displacementAmount:.3,displacementFrequency:20,sphereActivity:1};let li=.5,cd=1,st=[0,0,0];qt.frame(()=>{vi.background&&od({texture:nd(qt,"background"),scale:li+.3,resolution:[pr.clientWidth,pr.clientHeight],u_position:[st[0]+.5,st[1]*.4+.5],...sd}),fd({scale:li*.9,resolution:[pr.clientWidth,pr.clientHeight],u_position:[st[0]+.5,st[1]*.4+.5]}),Lr.setScale(li),Lr.setOpacity(cd),Lr.setPosition([st[0],st[1],st[2]]),Lr.render()});
